<!DOCTYPE html>
<!-- Generated by Cython 3.1.6 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: ppu.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { color: #000000; margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 3.1.6</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="ppu.c">ppu.c</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: # import pyximport; pyximport.install()</pre>
<pre class='cython code score-8 '>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_mstate_global-&gt;__pyx_d, __pyx_mstate_global-&gt;__pyx_n_u_test, __pyx_t_5) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: # important to cimport these rather than import them because that makes them have a lot less python interaction</pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: from .bitwise cimport bit_high, bit_low, set_bit, clear_bit, set_high_byte, set_low_byte</pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: from .memory cimport NESVRAM, PALETTE_START, NAMETABLE_START, NAMETABLE_LENGTH_BYTES, ATTRIBUTE_TABLE_OFFSET</pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: # A NES rgb palette mapping from NES color values to RGB; others are possible.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">008</span>: cdef int[64][3] DEFAULT_NES_PALETTE = [</pre>
<pre class='cython code score-0 '>  memcpy(&amp;(__pyx_t_74[0]), __pyx_t_10, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[1]), __pyx_t_11, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[2]), __pyx_t_12, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[3]), __pyx_t_13, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[4]), __pyx_t_14, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[5]), __pyx_t_15, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[6]), __pyx_t_16, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[7]), __pyx_t_17, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[8]), __pyx_t_18, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[9]), __pyx_t_19, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[10]), __pyx_t_20, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[11]), __pyx_t_21, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[12]), __pyx_t_22, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[13]), __pyx_t_23, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[14]), __pyx_t_24, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[15]), __pyx_t_25, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[16]), __pyx_t_26, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[17]), __pyx_t_27, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[18]), __pyx_t_28, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[19]), __pyx_t_29, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[20]), __pyx_t_30, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[21]), __pyx_t_31, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[22]), __pyx_t_32, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[23]), __pyx_t_33, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[24]), __pyx_t_34, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[25]), __pyx_t_35, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[26]), __pyx_t_36, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[27]), __pyx_t_37, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[28]), __pyx_t_38, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[29]), __pyx_t_39, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[30]), __pyx_t_40, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[31]), __pyx_t_41, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[32]), __pyx_t_42, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[33]), __pyx_t_43, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[34]), __pyx_t_44, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[35]), __pyx_t_45, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[36]), __pyx_t_46, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[37]), __pyx_t_47, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[38]), __pyx_t_48, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[39]), __pyx_t_49, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[40]), __pyx_t_50, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[41]), __pyx_t_51, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[42]), __pyx_t_52, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[43]), __pyx_t_53, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[44]), __pyx_t_54, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[45]), __pyx_t_55, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[46]), __pyx_t_56, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[47]), __pyx_t_57, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[48]), __pyx_t_58, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[49]), __pyx_t_59, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[50]), __pyx_t_60, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[51]), __pyx_t_61, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[52]), __pyx_t_62, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[53]), __pyx_t_63, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[54]), __pyx_t_64, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[55]), __pyx_t_65, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[56]), __pyx_t_66, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[57]), __pyx_t_67, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[58]), __pyx_t_68, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[59]), __pyx_t_69, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[60]), __pyx_t_70, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[61]), __pyx_t_71, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[62]), __pyx_t_72, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_t_74[63]), __pyx_t_73, sizeof(__pyx_t_74[0]));
  memcpy(&amp;(__pyx_v_3nes_6cycore_3ppu_DEFAULT_NES_PALETTE[0]), __pyx_t_74, sizeof(__pyx_v_3nes_6cycore_3ppu_DEFAULT_NES_PALETTE[0]) * (64));
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">009</span>:     ( 82,  82,  82), (  1,  26,  81), ( 15,  15, 101), ( 35,   6,  99),</pre>
<pre class='cython code score-20 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[3], __pyx_t_10, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 9, __pyx_L1_error)</span>
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[3] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_82, __pyx_mstate_global-&gt;__pyx_int_82, __pyx_mstate_global-&gt;__pyx_int_82); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[3])) <span class='error_goto'>__PYX_ERR(0, 9, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[3]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[3]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[4], __pyx_t_11, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 9, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[4] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_1, __pyx_mstate_global-&gt;__pyx_int_26, __pyx_mstate_global-&gt;__pyx_int_81); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[4])) <span class='error_goto'>__PYX_ERR(0, 9, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[4]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[4]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[5], __pyx_t_12, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 9, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[5] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_15, __pyx_mstate_global-&gt;__pyx_int_15, __pyx_mstate_global-&gt;__pyx_int_101); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[5])) <span class='error_goto'>__PYX_ERR(0, 9, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[5]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[5]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[6], __pyx_t_13, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 9, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[6] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_35, __pyx_mstate_global-&gt;__pyx_int_6, __pyx_mstate_global-&gt;__pyx_int_99); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[6])) <span class='error_goto'>__PYX_ERR(0, 9, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[6]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[6]);
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">010</span>:     ( 54,   3,  75), ( 64,   4,  38), ( 63,   9,   4), ( 50,  19,   0),</pre>
<pre class='cython code score-20 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[7], __pyx_t_14, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 10, __pyx_L1_error)</span>
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[7] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_54, __pyx_mstate_global-&gt;__pyx_int_3, __pyx_mstate_global-&gt;__pyx_int_75); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[7])) <span class='error_goto'>__PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[7]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[7]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[8], __pyx_t_15, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 10, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[8] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_64, __pyx_mstate_global-&gt;__pyx_int_4, __pyx_mstate_global-&gt;__pyx_int_38); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[8])) <span class='error_goto'>__PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[8]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[8]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[9], __pyx_t_16, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 10, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[9] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_63, __pyx_mstate_global-&gt;__pyx_int_9, __pyx_mstate_global-&gt;__pyx_int_4); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[9])) <span class='error_goto'>__PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[9]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[9]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[10], __pyx_t_17, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 10, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[10] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_50, __pyx_mstate_global-&gt;__pyx_int_19, __pyx_mstate_global-&gt;__pyx_int_0); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[10])) <span class='error_goto'>__PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[10]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[10]);
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">011</span>:     ( 31,  32,   0), ( 11,  42,   0), (  0,  47,   0), (  0,  46,  10),</pre>
<pre class='cython code score-20 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[11], __pyx_t_18, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 11, __pyx_L1_error)</span>
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[11] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_31, __pyx_mstate_global-&gt;__pyx_int_32, __pyx_mstate_global-&gt;__pyx_int_0); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[11])) <span class='error_goto'>__PYX_ERR(0, 11, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[11]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[11]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[12], __pyx_t_19, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 11, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[12] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_11, __pyx_mstate_global-&gt;__pyx_int_42, __pyx_mstate_global-&gt;__pyx_int_0); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[12])) <span class='error_goto'>__PYX_ERR(0, 11, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[12]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[12]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[13], __pyx_t_20, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 11, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[13] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_0, __pyx_mstate_global-&gt;__pyx_int_47, __pyx_mstate_global-&gt;__pyx_int_0); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[13])) <span class='error_goto'>__PYX_ERR(0, 11, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[13]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[13]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[14], __pyx_t_21, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 11, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[14] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_0, __pyx_mstate_global-&gt;__pyx_int_46, __pyx_mstate_global-&gt;__pyx_int_10); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[14])) <span class='error_goto'>__PYX_ERR(0, 11, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[14]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[14]);
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">012</span>:     (  0,  38,  45), (  0,   0,   0), (  0,   0,   0), (  0,   0,   0),</pre>
<pre class='cython code score-10 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[15], __pyx_t_22, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L1_error)</span>
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[15] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_0, __pyx_mstate_global-&gt;__pyx_int_38, __pyx_mstate_global-&gt;__pyx_int_45); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[15])) <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[15]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[15]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[16], __pyx_t_23, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L1_error)</span>
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[16], __pyx_t_24, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L1_error)</span>
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[16], __pyx_t_25, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[16] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_0, __pyx_mstate_global-&gt;__pyx_int_0, __pyx_mstate_global-&gt;__pyx_int_0); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[16])) <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[16]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[16]);
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">013</span>:     (160, 160, 160), ( 30,  74, 157), ( 56,  55, 188), ( 88,  40, 184),</pre>
<pre class='cython code score-20 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[17], __pyx_t_26, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 13, __pyx_L1_error)</span>
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[17] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_160, __pyx_mstate_global-&gt;__pyx_int_160, __pyx_mstate_global-&gt;__pyx_int_160); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[17])) <span class='error_goto'>__PYX_ERR(0, 13, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[17]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[17]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[18], __pyx_t_27, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 13, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[18] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_30, __pyx_mstate_global-&gt;__pyx_int_74, __pyx_mstate_global-&gt;__pyx_int_157); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[18])) <span class='error_goto'>__PYX_ERR(0, 13, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[18]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[18]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[19], __pyx_t_28, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 13, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[19] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_56, __pyx_mstate_global-&gt;__pyx_int_55, __pyx_mstate_global-&gt;__pyx_int_188); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[19])) <span class='error_goto'>__PYX_ERR(0, 13, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[19]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[19]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[20], __pyx_t_29, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 13, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[20] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_88, __pyx_mstate_global-&gt;__pyx_int_40, __pyx_mstate_global-&gt;__pyx_int_184); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[20])) <span class='error_goto'>__PYX_ERR(0, 13, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[20]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[20]);
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">014</span>:     (117,  33, 148), (132,  35,  92), (130,  46,  36), (111,  63,   0),</pre>
<pre class='cython code score-20 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[21], __pyx_t_30, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 14, __pyx_L1_error)</span>
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[21] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_117, __pyx_mstate_global-&gt;__pyx_int_33, __pyx_mstate_global-&gt;__pyx_int_148); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[21])) <span class='error_goto'>__PYX_ERR(0, 14, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[21]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[21]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[22], __pyx_t_31, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 14, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[22] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_132, __pyx_mstate_global-&gt;__pyx_int_35, __pyx_mstate_global-&gt;__pyx_int_92); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[22])) <span class='error_goto'>__PYX_ERR(0, 14, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[22]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[22]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[23], __pyx_t_32, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 14, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[23] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_130, __pyx_mstate_global-&gt;__pyx_int_46, __pyx_mstate_global-&gt;__pyx_int_36); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[23])) <span class='error_goto'>__PYX_ERR(0, 14, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[23]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[23]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[24], __pyx_t_33, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 14, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[24] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_111, __pyx_mstate_global-&gt;__pyx_int_63, __pyx_mstate_global-&gt;__pyx_int_0); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[24])) <span class='error_goto'>__PYX_ERR(0, 14, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[24]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[24]);
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">015</span>:     ( 81,  82,   0), ( 49,  99,   0), ( 26, 107,   5), ( 14, 105,  46),</pre>
<pre class='cython code score-20 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[25], __pyx_t_34, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 15, __pyx_L1_error)</span>
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[25] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_81, __pyx_mstate_global-&gt;__pyx_int_82, __pyx_mstate_global-&gt;__pyx_int_0); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[25])) <span class='error_goto'>__PYX_ERR(0, 15, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[25]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[25]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[26], __pyx_t_35, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 15, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[26] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_49, __pyx_mstate_global-&gt;__pyx_int_99, __pyx_mstate_global-&gt;__pyx_int_0); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[26])) <span class='error_goto'>__PYX_ERR(0, 15, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[26]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[26]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[27], __pyx_t_36, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 15, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[27] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_26, __pyx_mstate_global-&gt;__pyx_int_107, __pyx_mstate_global-&gt;__pyx_int_5); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[27])) <span class='error_goto'>__PYX_ERR(0, 15, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[27]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[27]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[28], __pyx_t_37, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 15, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[28] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_14, __pyx_mstate_global-&gt;__pyx_int_105, __pyx_mstate_global-&gt;__pyx_int_46); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[28])) <span class='error_goto'>__PYX_ERR(0, 15, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[28]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[28]);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">016</span>:     ( 16,  92, 104), (  0,   0,   0), (  0,   0,   0), (  0,   0,   0),</pre>
<pre class='cython code score-5 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[29], __pyx_t_38, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L1_error)</span>
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[16], __pyx_t_39, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L1_error)</span>
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[16], __pyx_t_40, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L1_error)</span>
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[16], __pyx_t_41, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L1_error)</span>
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[29] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_16, __pyx_mstate_global-&gt;__pyx_int_92, __pyx_mstate_global-&gt;__pyx_int_104); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[29])) <span class='error_goto'>__PYX_ERR(0, 16, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[29]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[29]);
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">017</span>:     (254, 255, 255), (105, 158, 252), (137, 135, 255), (174, 118, 255),</pre>
<pre class='cython code score-20 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[30], __pyx_t_42, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 17, __pyx_L1_error)</span>
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[30] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_254, __pyx_mstate_global-&gt;__pyx_int_255, __pyx_mstate_global-&gt;__pyx_int_255); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[30])) <span class='error_goto'>__PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[30]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[30]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[31], __pyx_t_43, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 17, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[31] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_105, __pyx_mstate_global-&gt;__pyx_int_158, __pyx_mstate_global-&gt;__pyx_int_252); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[31])) <span class='error_goto'>__PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[31]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[31]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[32], __pyx_t_44, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 17, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[32] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_137, __pyx_mstate_global-&gt;__pyx_int_135, __pyx_mstate_global-&gt;__pyx_int_255); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[32])) <span class='error_goto'>__PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[32]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[32]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[33], __pyx_t_45, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 17, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[33] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_174, __pyx_mstate_global-&gt;__pyx_int_118, __pyx_mstate_global-&gt;__pyx_int_255); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[33])) <span class='error_goto'>__PYX_ERR(0, 17, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[33]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[33]);
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">018</span>:     (206, 109, 241), (224, 112, 178), (222, 124, 112), (200, 145,  62),</pre>
<pre class='cython code score-20 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[34], __pyx_t_46, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 18, __pyx_L1_error)</span>
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[34] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_206, __pyx_mstate_global-&gt;__pyx_int_109, __pyx_mstate_global-&gt;__pyx_int_241); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[34])) <span class='error_goto'>__PYX_ERR(0, 18, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[34]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[34]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[35], __pyx_t_47, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 18, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[35] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_224, __pyx_mstate_global-&gt;__pyx_int_112, __pyx_mstate_global-&gt;__pyx_int_178); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[35])) <span class='error_goto'>__PYX_ERR(0, 18, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[35]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[35]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[36], __pyx_t_48, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 18, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[36] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_222, __pyx_mstate_global-&gt;__pyx_int_124, __pyx_mstate_global-&gt;__pyx_int_112); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[36])) <span class='error_goto'>__PYX_ERR(0, 18, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[36]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[36]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[37], __pyx_t_49, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 18, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[37] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_200, __pyx_mstate_global-&gt;__pyx_int_145, __pyx_mstate_global-&gt;__pyx_int_62); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[37])) <span class='error_goto'>__PYX_ERR(0, 18, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[37]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[37]);
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">019</span>:     (166, 167,  37), (129, 186,  40), ( 99, 196,  70), ( 84, 193, 125),</pre>
<pre class='cython code score-20 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[38], __pyx_t_50, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L1_error)</span>
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[38] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_166, __pyx_mstate_global-&gt;__pyx_int_167, __pyx_mstate_global-&gt;__pyx_int_37); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[38])) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[38]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[38]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[39], __pyx_t_51, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[39] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_129, __pyx_mstate_global-&gt;__pyx_int_186, __pyx_mstate_global-&gt;__pyx_int_40); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[39])) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[39]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[39]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[40], __pyx_t_52, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[40] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_99, __pyx_mstate_global-&gt;__pyx_int_196, __pyx_mstate_global-&gt;__pyx_int_70); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[40])) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[40]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[40]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[41], __pyx_t_53, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[41] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_84, __pyx_mstate_global-&gt;__pyx_int_193, __pyx_mstate_global-&gt;__pyx_int_125); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[41])) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[41]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[41]);
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">020</span>:     ( 86, 179, 192), ( 60,  60,  60), (  0,   0,   0), (  0,   0,   0),</pre>
<pre class='cython code score-10 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[42], __pyx_t_54, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L1_error)</span>
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[42] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_86, __pyx_mstate_global-&gt;__pyx_int_179, __pyx_mstate_global-&gt;__pyx_int_192); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[42])) <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[42]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[42]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[43], __pyx_t_55, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L1_error)</span>
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[16], __pyx_t_56, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L1_error)</span>
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[16], __pyx_t_57, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[43] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_60, __pyx_mstate_global-&gt;__pyx_int_60, __pyx_mstate_global-&gt;__pyx_int_60); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[43])) <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[43]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[43]);
</pre><pre class="cython line score-15" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">021</span>:     (254, 255, 255), (190, 214, 253), (204, 204, 255), (221, 196, 255),</pre>
<pre class='cython code score-15 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[30], __pyx_t_58, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 21, __pyx_L1_error)</span>
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[44], __pyx_t_59, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 21, __pyx_L1_error)</span>
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[44] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_190, __pyx_mstate_global-&gt;__pyx_int_214, __pyx_mstate_global-&gt;__pyx_int_253); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[44])) <span class='error_goto'>__PYX_ERR(0, 21, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[44]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[44]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[45], __pyx_t_60, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 21, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[45] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_204, __pyx_mstate_global-&gt;__pyx_int_204, __pyx_mstate_global-&gt;__pyx_int_255); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[45])) <span class='error_goto'>__PYX_ERR(0, 21, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[45]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[45]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[46], __pyx_t_61, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 21, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[46] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_221, __pyx_mstate_global-&gt;__pyx_int_196, __pyx_mstate_global-&gt;__pyx_int_255); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[46])) <span class='error_goto'>__PYX_ERR(0, 21, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[46]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[46]);
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">022</span>:     (234, 192, 249), (242, 193, 223), (241, 199, 194), (232, 208, 170),</pre>
<pre class='cython code score-20 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[47], __pyx_t_62, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 22, __pyx_L1_error)</span>
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[47] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_234, __pyx_mstate_global-&gt;__pyx_int_192, __pyx_mstate_global-&gt;__pyx_int_249); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[47])) <span class='error_goto'>__PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[47]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[47]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[48], __pyx_t_63, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 22, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[48] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_242, __pyx_mstate_global-&gt;__pyx_int_193, __pyx_mstate_global-&gt;__pyx_int_223); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[48])) <span class='error_goto'>__PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[48]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[48]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[49], __pyx_t_64, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 22, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[49] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_241, __pyx_mstate_global-&gt;__pyx_int_199, __pyx_mstate_global-&gt;__pyx_int_194); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[49])) <span class='error_goto'>__PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[49]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[49]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[50], __pyx_t_65, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 22, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[50] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_232, __pyx_mstate_global-&gt;__pyx_int_208, __pyx_mstate_global-&gt;__pyx_int_170); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[50])) <span class='error_goto'>__PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[50]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[50]);
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">023</span>:     (217, 218, 157), (201, 226, 158), (188, 230, 174), (180, 229, 199),</pre>
<pre class='cython code score-20 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[51], __pyx_t_66, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[51] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_217, __pyx_mstate_global-&gt;__pyx_int_218, __pyx_mstate_global-&gt;__pyx_int_157); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[51])) <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[51]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[51]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[52], __pyx_t_67, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[52] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_201, __pyx_mstate_global-&gt;__pyx_int_226, __pyx_mstate_global-&gt;__pyx_int_158); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[52])) <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[52]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[52]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[53], __pyx_t_68, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[53] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_188, __pyx_mstate_global-&gt;__pyx_int_230, __pyx_mstate_global-&gt;__pyx_int_174); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[53])) <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[53]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[53]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[54], __pyx_t_69, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[54] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_180, __pyx_mstate_global-&gt;__pyx_int_229, __pyx_mstate_global-&gt;__pyx_int_199); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[54])) <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[54]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[54]);
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">024</span>:     (181, 223, 228), (169, 169, 169), (  0,   0,   0), (  0,   0,   0),</pre>
<pre class='cython code score-10 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[55], __pyx_t_70, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L1_error)</span>
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[55] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_181, __pyx_mstate_global-&gt;__pyx_int_223, __pyx_mstate_global-&gt;__pyx_int_228); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[55])) <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[55]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[55]);
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[56], __pyx_t_71, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L1_error)</span>
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[16], __pyx_t_72, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L1_error)</span>
  if (unlikely((__Pyx_carray_from_py_int(__pyx_mstate_global-&gt;__pyx_tuple[16], __pyx_t_73, 3) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L1_error)</span>
  __pyx_mstate_global-&gt;__pyx_tuple[56] = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_mstate_global-&gt;__pyx_int_169, __pyx_mstate_global-&gt;__pyx_int_169, __pyx_mstate_global-&gt;__pyx_int_169); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[56])) <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[56]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[56]);
</pre><pre class="cython line score-0">&#xA0;<span class="">025</span>: ]</pre>
<pre class="cython line score-0">&#xA0;<span class="">026</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">027</span>: cdef class NESPPU:</pre>
<pre class='cython code score-0 '>struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU {
  void (*write_oam)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *, unsigned char *);
  int (*get_background_color)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *);
  void (*copy_screen_buffer_to)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *, __Pyx_memviewslice, int __pyx_skip_dispatch, struct __pyx_opt_args_3nes_6cycore_3ppu_6NESPPU_copy_screen_buffer_to *__pyx_optional_args);
  void (*_clear_to_bkg)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *);
  unsigned char (*read_register)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *, int);
  void (*write_register)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *, int, unsigned char);
  unsigned char (*ppu_status)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *);
  int (*run_cycles)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *, int);
  void (*prerender_scanline)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *);
  void (*render_visible_scanline)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *);
  void (*increment_pixel)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *);
  void (*_increment_vram_address)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *);
  void (*_trigger_nmi)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *);
  void (*_reset_effective_y)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *);
  void (*_prefetch_active_sprites)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *);
  void (*_fill_sprite_latches)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *, int);
  int (*_overlay_sprites)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *, int);
  void (*fill_bkg_latches)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *);
  int (*_get_bkg_pixel)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *);
  void (*decode_palette)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *, int *, int, int);
  void (*invalidate_palette_cache)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *);
  void (*debug_render_nametables)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *, __Pyx_memviewslice, int __pyx_skip_dispatch);
  void (*debug_render_tile)(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *, __Pyx_memviewslice, int, int, int, int, int, int, int, int __pyx_skip_dispatch);
};
static struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *__pyx_vtabptr_3nes_6cycore_3ppu_NESPPU;

</pre><pre class="cython line score-0">&#xA0;<span class="">028</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>:     NES Picture Processing Unit (PPU), the 2C02</pre>
<pre class="cython line score-0">&#xA0;<span class="">030</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">031</span>:     References:</pre>
<pre class="cython line score-0">&#xA0;<span class="">032</span>:         [1] Overall reference:  https://wiki.nesdev.com/w/index.php/PPU_programmer_reference</pre>
<pre class="cython line score-0">&#xA0;<span class="">033</span>:         [2] Rendering timing: https://wiki.nesdev.com/w/index.php/PPU_rendering</pre>
<pre class="cython line score-0">&#xA0;<span class="">034</span>:         [3] OAM layout:  https://wiki.nesdev.com/w/index.php/PPU_OAM</pre>
<pre class="cython line score-0">&#xA0;<span class="">035</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>:         [4] Detailed operation: http://nesdev.com/2C02%20technical%20operation.TXT</pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>:         [5] Palette generator: https://bisqwit.iki.fi/utils/nespalette.php</pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">040</span>:         [6] Register behaviour: https://wiki.nesdev.com/w/index.php/PPU_registers</pre>
<pre class="cython line score-0">&#xA0;<span class="">041</span>:         [7] Scrolling: https://wiki.nesdev.com/w/index.php/PPU_scrolling</pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>:     """</pre>
<pre class="cython line score-46" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">043</span>:     def __init__(self, cart=None, interrupt_listener=None, palette=None):</pre>
<pre class='cython code score-46 '>/* Python wrapper */
static int __pyx_pw_3nes_6cycore_3ppu_6NESPPU_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_3nes_6cycore_3ppu_6NESPPU_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_cart = 0;
  PyObject *__pyx_v_interrupt_listener = 0;
  PyObject *__pyx_v_palette = 0;
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__init__ (wrapper)", 0);
  #if CYTHON_ASSUME_SAFE_SIZE
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return -1;
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_VARARGS</span>(__pyx_args, __pyx_nargs);
  {
    PyObject ** const __pyx_pyargnames[] = {&amp;__pyx_mstate_global-&gt;__pyx_n_u_cart,&amp;__pyx_mstate_global-&gt;__pyx_n_u_interrupt_listener,&amp;__pyx_mstate_global-&gt;__pyx_n_u_palette,0};
  PyObject* values[3] = {0,0,0};
    const Py_ssize_t __pyx_kwds_len = (__pyx_kwds) ? <span class='pyx_c_api'>__Pyx_NumKwargs_VARARGS</span>(__pyx_kwds) : 0;
    if (unlikely(__pyx_kwds_len) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 43, __pyx_L3_error)</span>
    if (__pyx_kwds_len &gt; 0) {
      switch (__pyx_nargs) {
        case  3:
        values[2] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 2);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[2])) <span class='error_goto'>__PYX_ERR(0, 43, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  2:
        values[1] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 1);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[1])) <span class='error_goto'>__PYX_ERR(0, 43, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  1:
        values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 0);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 43, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      const Py_ssize_t kwd_pos_args = __pyx_nargs;
      if (<span class='pyx_c_api'>__Pyx_ParseKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values, kwd_pos_args, __pyx_kwds_len, "__init__", 0) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 43, __pyx_L3_error)</span>
      if (!values[0]) values[0] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
      if (!values[1]) values[1] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
      if (!values[2]) values[2] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
    } else {
      switch (__pyx_nargs) {
        case  3:
        values[2] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 2);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[2])) <span class='error_goto'>__PYX_ERR(0, 43, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  2:
        values[1] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 1);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[1])) <span class='error_goto'>__PYX_ERR(0, 43, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  1:
        values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 0);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 43, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      if (!values[0]) values[0] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
      if (!values[1]) values[1] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
      if (!values[2]) values[2] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
    }
    __pyx_v_cart = values[0];
    __pyx_v_interrupt_listener = values[1];
    __pyx_v_palette = values[2];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 3, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 43, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3nes_6cycore_3ppu_6NESPPU___init__(((struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self), __pyx_v_cart, __pyx_v_interrupt_listener, __pyx_v_palette);

  /* function exit code */
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static int __pyx_pf_3nes_6cycore_3ppu_6NESPPU___init__(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self, PyObject *__pyx_v_cart, PyObject *__pyx_v_interrupt_listener, PyObject *__pyx_v_palette) {
  CYTHON_UNUSED long __pyx_7genexpr__pyx_v__;
  int __pyx_r;
/* … */
  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">044</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">045</span>:         # Registers</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">046</span>:         self.ppu_ctrl = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;ppu_ctrl = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">047</span>:         self.ppu_mask = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;ppu_mask = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">048</span>:         self.oam_addr = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;oam_addr = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">049</span>:         self.oam_data = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;oam_data = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">050</span>:         self.ppu_scroll[:] = [0, 0]     # this contains x-scroll (byte 0) and y-scroll (byte 1) accumulated over two writes</pre>
<pre class='cython code score-0 '>  __pyx_t_1[0] = 0;
  __pyx_t_1[1] = 0;
  memcpy(&amp;(__pyx_v_self-&gt;ppu_scroll[0]), __pyx_t_1, sizeof(__pyx_v_self-&gt;ppu_scroll[0]) * (2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">051</span>:         self.ppu_addr = 0               # the accumulated **16-bit** address</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;ppu_addr = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">052</span>:         self._ppu_byte_latch = 0        # latch to keep track of which byte is being written in ppu_scroll and ppu_addr; latch is shared</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;_ppu_byte_latch = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">053</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">054</span>:         # internal latches to deal with open bus and buffering behaviour</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">055</span>:         self._ppu_data_buffer = 0       # data to hold buffered reads from VRAM (see read of ppu_data)</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;_ppu_data_buffer = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">056</span>:         self._io_latch = 0              # last write/valid read of the ppu registers, sometimes reflected in read status</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;_io_latch = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">057</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>:         # internal latches used in background rendering</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">059</span>:         self._palette = [[0, 1, 2, 3], [4, 5, 6, 7]]</pre>
<pre class='cython code score-0 '>  __pyx_t_2[0] = 0;
  __pyx_t_2[1] = 1;
  __pyx_t_2[2] = 2;
  __pyx_t_2[3] = 3;
  __pyx_t_3[0] = 4;
  __pyx_t_3[1] = 5;
  __pyx_t_3[2] = 6;
  __pyx_t_3[3] = 7;
  memcpy(&amp;(__pyx_t_4[0]), __pyx_t_2, sizeof(__pyx_t_4[0]));
  memcpy(&amp;(__pyx_t_4[1]), __pyx_t_3, sizeof(__pyx_t_4[0]));
  memcpy(&amp;(__pyx_v_self-&gt;_palette[0]), __pyx_t_4, sizeof(__pyx_v_self-&gt;_palette[0]) * (2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">060</span>:         self._pattern_lo = 0   # 16 bit patterns register to hold 2 x 8 bit patterns</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;_pattern_lo = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">061</span>:         self._pattern_hi = 0   # 16 bit patterns register to hold 2 x 8 bit patterns</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;_pattern_hi = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">062</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">063</span>:         # internal memory and latches used in sprite rendering</pre>
<pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">064</span>:         self._sprite_pattern = [[0] * 8 for _ in range(8)]</pre>
<pre class='cython code score-17 '>  { /* enter inner scope */
    __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 64, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    for (__pyx_t_6 = 0; __pyx_t_6 &lt; 8; __pyx_t_6+=1) {
      __pyx_7genexpr__pyx_v__ = __pyx_t_6;
      __pyx_t_7 = <span class='py_c_api'>PyList_New</span>(1 * 8);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 64, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      { Py_ssize_t __pyx_temp;
        for (__pyx_temp=0; __pyx_temp &lt; 8; __pyx_temp++) {
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_mstate_global-&gt;__pyx_int_0);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_int_0);
          if (<span class='pyx_c_api'>__Pyx_PyList_SET_ITEM</span>(__pyx_t_7, __pyx_temp, __pyx_mstate_global-&gt;__pyx_int_0) != (0)) <span class='error_goto'>__PYX_ERR(0, 64, __pyx_L1_error)</span>;
        }
      }
      if (unlikely(<span class='pyx_c_api'>__Pyx_ListComp_Append</span>(__pyx_t_5, (PyObject*)__pyx_t_7))) <span class='error_goto'>__PYX_ERR(0, 64, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    }
  } /* exit inner scope */
  if (unlikely((__Pyx_carray_from_py_char___5b_8_5d_(__pyx_t_5, __pyx_t_8, 8) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 64, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  memcpy(&amp;(__pyx_v_self-&gt;_sprite_pattern[0]), __pyx_t_8, sizeof(__pyx_v_self-&gt;_sprite_pattern[0]) * (8));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">065</span>:         self._sprite_bkg_priority = [0] * 8</pre>
<pre class='cython code score-0 '>  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp = 0; __pyx_temp &lt; 8; __pyx_temp++) {
      __pyx_t_9[0+ (1 * __pyx_temp)] = 0;
    }
  }
  memcpy(&amp;(__pyx_v_self-&gt;_sprite_bkg_priority[0]), __pyx_t_9, sizeof(__pyx_v_self-&gt;_sprite_bkg_priority[0]) * (8));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">066</span>:         self._num_active_sprites = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;_num_active_sprites = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">067</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">068</span>:         # some state used in rendering to tell us where on the screen we are drawing</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">069</span>:         self.line = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;line = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">070</span>:         self.pixel = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;pixel = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">071</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>:         # internal statuses</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">073</span>:         self.in_vblank = False</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;in_vblank = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">074</span>:         self.sprite_zero_hit = False</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;sprite_zero_hit = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">075</span>:         self.sprite_overflow = False</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;sprite_overflow = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">076</span>:         self.ignore_ppu_ctrl = True   # on startup, ignore writes to ppu_ctrl for about 30k cycles</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;ignore_ppu_ctrl = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">077</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>:         # status used by emulator</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">079</span>:         self.cycles_since_reset = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;cycles_since_reset = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">080</span>:         self.frames_since_reset = 0  # need all three counters (not really, but easier) because frame lengths vary</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;frames_since_reset = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">081</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">082</span>:         # memory</pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">083</span>:         self.vram = NESVRAM(cart=cart)</pre>
<pre class='cython code score-11 '>  __pyx_t_7 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_mstate_global-&gt;__pyx_ptype_3nes_6cycore_6memory_NESVRAM);
  __pyx_t_10 = ((PyObject *)__pyx_mstate_global-&gt;__pyx_ptype_3nes_6cycore_6memory_NESVRAM); 
  __pyx_t_11 = 1;
  {
    PyObject *__pyx_callargs[2 + ((CYTHON_VECTORCALL) ? 1 : 0)] = {__pyx_t_7, NULL};
    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_MakeVectorcallBuilderKwds</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 83, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
    if (<span class='pyx_c_api'>__Pyx_VectorcallBuilder_AddArg</span>(__pyx_mstate_global-&gt;__pyx_n_u_cart, __pyx_v_cart, __pyx_t_12, __pyx_callargs+1, 0) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 83, __pyx_L1_error)</span>
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_Object_Vectorcall_CallFromBuilder</span>(__pyx_t_10, __pyx_callargs+__pyx_t_11, (1-__pyx_t_11) | (__pyx_t_11*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET), __pyx_t_12);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 83, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>((PyObject *)__pyx_t_5);
  }
  <span class='refnanny'>__Pyx_GIVEREF</span>((PyObject *)__pyx_t_5);
  <span class='refnanny'>__Pyx_GOTREF</span>((PyObject *)__pyx_v_self-&gt;vram);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>((PyObject *)__pyx_v_self-&gt;vram);
  __pyx_v_self-&gt;vram = ((struct __pyx_obj_3nes_6cycore_6memory_NESVRAM *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">084</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">085</span>:         # interrupt listener</pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">086</span>:         self.interrupt_listener = interrupt_listener</pre>
<pre class='cython code score-4 '>  __pyx_t_5 = __pyx_v_interrupt_listener;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_mstate_global-&gt;__pyx_ptype_3nes_6cycore_6system_InterruptListener))))) <span class='error_goto'>__PYX_ERR(0, 86, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GOTREF</span>((PyObject *)__pyx_v_self-&gt;interrupt_listener);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>((PyObject *)__pyx_v_self-&gt;interrupt_listener);
  __pyx_v_self-&gt;interrupt_listener = ((struct __pyx_obj_3nes_6cycore_6system_InterruptListener *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">087</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">088</span>:         # palette: use the default, but can be replaced using utils.load_palette</pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">089</span>:         self.set_hex_palette(palette if palette is not None else DEFAULT_NES_PALETTE)</pre>
<pre class='cython code score-7 '>  __pyx_t_10 = ((PyObject *)__pyx_v_self);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
  __pyx_t_13 = (__pyx_v_palette != Py_None);
  if (__pyx_t_13) {
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_palette);
    __pyx_t_12 = __pyx_v_palette;
  } else {
    __pyx_t_7 = __Pyx_carray_to_py_int___5b_3_5d_(__pyx_v_3nes_6cycore_3ppu_DEFAULT_NES_PALETTE, 64);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 89, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_12 = __pyx_t_7;
    __pyx_t_7 = 0;
  }
  __pyx_t_11 = 0;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_t_12};
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCallMethod</span>(__pyx_mstate_global-&gt;__pyx_n_u_set_hex_palette, __pyx_callargs+__pyx_t_11, (2-__pyx_t_11) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 89, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">090</span>:         self.transparent_color = -1</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;transparent_color = -1;
</pre><pre class="cython line score-0">&#xA0;<span class="">091</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">092</span>:         self._palette_cache_valid[:] = [0, 0, 0, 0, 0, 0, 0, 0]</pre>
<pre class='cython code score-0 '>  __pyx_t_14[0] = 0;
  __pyx_t_14[1] = 0;
  __pyx_t_14[2] = 0;
  __pyx_t_14[3] = 0;
  __pyx_t_14[4] = 0;
  __pyx_t_14[5] = 0;
  __pyx_t_14[6] = 0;
  __pyx_t_14[7] = 0;
  memcpy(&amp;(__pyx_v_self-&gt;_palette_cache_valid[0]), __pyx_t_14, sizeof(__pyx_v_self-&gt;_palette_cache_valid[0]) * (8));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">093</span>:         self.irq_tick_triggers[:] = [False] * 68</pre>
<pre class='cython code score-0 '>  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp = 0; __pyx_temp &lt; 68; __pyx_temp++) {
      __pyx_t_15[0+ (1 * __pyx_temp)] = 0;
    }
  }
  memcpy(&amp;(__pyx_v_self-&gt;irq_tick_triggers[0]), __pyx_t_15, sizeof(__pyx_v_self-&gt;irq_tick_triggers[0]) * (68));
</pre><pre class="cython line score-0">&#xA0;<span class="">094</span>: </pre>
<pre class="cython line score-37" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">095</span>:     def set_hex_palette(self, rgb_palette):</pre>
<pre class='cython code score-37 '>/* Python wrapper */
static PyObject *__pyx_pw_3nes_6cycore_3ppu_6NESPPU_3set_hex_palette(PyObject *__pyx_v_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static PyMethodDef __pyx_mdef_3nes_6cycore_3ppu_6NESPPU_3set_hex_palette = {"set_hex_palette", (PyCFunction)(void(*)(void))(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_3nes_6cycore_3ppu_6NESPPU_3set_hex_palette, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_3nes_6cycore_3ppu_6NESPPU_3set_hex_palette(PyObject *__pyx_v_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_rgb_palette = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("set_hex_palette (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_SIZE
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject ** const __pyx_pyargnames[] = {&amp;__pyx_mstate_global-&gt;__pyx_n_u_rgb_palette,0};
  PyObject* values[1] = {0};
    const Py_ssize_t __pyx_kwds_len = (__pyx_kwds) ? <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds) : 0;
    if (unlikely(__pyx_kwds_len) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 95, __pyx_L3_error)</span>
    if (__pyx_kwds_len &gt; 0) {
      switch (__pyx_nargs) {
        case  1:
        values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 0);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 95, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      const Py_ssize_t kwd_pos_args = __pyx_nargs;
      if (<span class='pyx_c_api'>__Pyx_ParseKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values, kwd_pos_args, __pyx_kwds_len, "set_hex_palette", 0) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 95, __pyx_L3_error)</span>
      for (Py_ssize_t i = __pyx_nargs; i &lt; 1; i++) {
        if (unlikely(!values[i])) { <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("set_hex_palette", 1, 1, 1, i); <span class='error_goto'>__PYX_ERR(0, 95, __pyx_L3_error)</span> }
      }
    } else if (unlikely(__pyx_nargs != 1)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 0);
      if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 95, __pyx_L3_error)</span>
    }
    __pyx_v_rgb_palette = values[0];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("set_hex_palette", 1, 1, 1, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 95, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.set_hex_palette", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3nes_6cycore_3ppu_6NESPPU_2set_hex_palette(((struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self), __pyx_v_rgb_palette);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3nes_6cycore_3ppu_6NESPPU_2set_hex_palette(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self, PyObject *__pyx_v_rgb_palette) {
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_c = NULL;
  PyObject *__pyx_r = NULL;
/* … */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.set_hex_palette", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_c);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_3nes_6cycore_3ppu_6NESPPU_3set_hex_palette, __Pyx_CYFUNCTION_CCLASS, __pyx_mstate_global-&gt;__pyx_n_u_NESPPU_set_hex_palette, NULL, __pyx_mstate_global-&gt;__pyx_n_u_nes_cycore_ppu, __pyx_mstate_global-&gt;__pyx_d, ((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[1]));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 95, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  if (<span class='pyx_c_api'>__Pyx_SetItemOnTypeDict</span>(__pyx_mstate_global-&gt;__pyx_ptype_3nes_6cycore_3ppu_NESPPU, __pyx_mstate_global-&gt;__pyx_n_u_set_hex_palette, __pyx_t_5) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 95, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-55" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">096</span>:         for i, c in enumerate(rgb_palette):</pre>
<pre class='cython code score-55 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_mstate_global-&gt;__pyx_int_0);
  __pyx_t_1 = __pyx_mstate_global-&gt;__pyx_int_0;
  if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_rgb_palette)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_rgb_palette)) {
    __pyx_t_2 = __pyx_v_rgb_palette; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
  } else {
    __pyx_t_3 = -1; __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_rgb_palette);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 96, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_4 = (CYTHON_COMPILING_IN_LIMITED_API) ? PyIter_Next : <span class='pyx_c_api'>__Pyx_PyObject_GetIterNextFunc</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 96, __pyx_L1_error)</span>
  }
  for (;;) {
    if (likely(!__pyx_t_4)) {
      if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2))) {
        {
          Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyList_GET_SIZE</span>(__pyx_t_2);
          #if !CYTHON_ASSUME_SAFE_SIZE
          if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 96, __pyx_L1_error)</span>
          #endif
          if (__pyx_t_3 &gt;= __pyx_temp) break;
        }
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyList_GetItemRef</span>(__pyx_t_2, __pyx_t_3);
        ++__pyx_t_3;
      } else {
        {
          Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyTuple_GET_SIZE</span>(__pyx_t_2);
          #if !CYTHON_ASSUME_SAFE_SIZE
          if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 96, __pyx_L1_error)</span>
          #endif
          if (__pyx_t_3 &gt;= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_NewRef</span>(<span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_3));
        #else
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PySequence_ITEM</span>(__pyx_t_2, __pyx_t_3);
        #endif
        ++__pyx_t_3;
      }
      if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 96, __pyx_L1_error)</span>
    } else {
      __pyx_t_5 = __pyx_t_4(__pyx_t_2);
      if (unlikely(!__pyx_t_5)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (unlikely(!<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='error_goto'>__PYX_ERR(0, 96, __pyx_L1_error)</span>
          <span class='py_c_api'>PyErr_Clear</span>();
        }
        break;
      }
    }
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_c, __pyx_t_5);
    __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_i, __pyx_t_1);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyLong_AddObjC</span>(__pyx_t_1, __pyx_mstate_global-&gt;__pyx_int_1, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 96, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1);
    __pyx_t_1 = __pyx_t_5;
    __pyx_t_5 = 0;
/* … */
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-41" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">097</span>:             self.hex_palette[i] = (c[0] &lt;&lt; 16) + (c[1] &lt;&lt; 8) + c[2]</pre>
<pre class='cython code score-41 '>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_c, 0, long, 1, __Pyx_PyLong_From_long, 0, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 97, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyLong_LshiftObjC</span>(__pyx_t_5, __pyx_mstate_global-&gt;__pyx_int_16, 16, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 97, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_c, 1, long, 1, __Pyx_PyLong_From_long, 0, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 97, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyLong_LshiftObjC</span>(__pyx_t_5, __pyx_mstate_global-&gt;__pyx_int_8, 8, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 97, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_6, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 97, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_c, 2, long, 1, __Pyx_PyLong_From_long, 0, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 97, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_5, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 97, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyLong_As_unsigned_int</span>(__pyx_t_6); if (unlikely((__pyx_t_8 == (unsigned int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 97, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_i); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 97, __pyx_L1_error)</span>
    (__pyx_v_self-&gt;hex_palette[__pyx_t_9]) = __pyx_t_8;
</pre><pre class="cython line score-0">&#xA0;<span class="">098</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">099</span>:     ################ Copy OAM data #####################################################################################</pre>
<pre class="cython line score-0">&#xA0;<span class="">100</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">101</span>:     cdef void write_oam(self, unsigned char* data):</pre>
<pre class='cython code score-0 '>static void __pyx_f_3nes_6cycore_3ppu_6NESPPU_write_oam(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self, unsigned char *__pyx_v_data) {
  int __pyx_v_i;
/* … */
  /* function exit code */
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">102</span>:         cdef int i=0</pre>
<pre class='cython code score-0 '>  __pyx_v_i = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">103</span>:         for i in range(OAM_SIZE_BYTES):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_e_3nes_6cycore_3ppu_OAM_SIZE_BYTES;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">104</span>:             self.oam[i] = data[i]</pre>
<pre class='cython code score-0 '>    (__pyx_v_self-&gt;oam[__pyx_v_i]) = (__pyx_v_data[__pyx_v_i]);
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">105</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">106</span>:     ################ Register reading and writing ######################################################################</pre>
<pre class="cython line score-0">&#xA0;<span class="">107</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">108</span>:     cdef unsigned char ppu_status(self):</pre>
<pre class='cython code score-0 '>static unsigned char __pyx_f_3nes_6cycore_3ppu_6NESPPU_ppu_status(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self) {
  unsigned char __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">109</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">110</span>:         The ppu status register value (without io latch noise in lower bits)</pre>
<pre class="cython line score-0">&#xA0;<span class="">111</span>:         :return:</pre>
<pre class="cython line score-0">&#xA0;<span class="">112</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">113</span>:         return VBLANK_MASK * self.in_vblank \</pre>
<pre class="cython line score-0">&#xA0;<span class="">114</span>:                + SPRITE0_HIT_MASK * self.sprite_zero_hit \</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">115</span>:                + SPRITE_OVERFLOW_MASK * self.sprite_overflow</pre>
<pre class='cython code score-0 '>  __pyx_r = (((__pyx_e_3nes_6cycore_3ppu_VBLANK_MASK * __pyx_v_self-&gt;in_vblank) + (__pyx_e_3nes_6cycore_3ppu_SPRITE0_HIT_MASK * __pyx_v_self-&gt;sprite_zero_hit)) + (__pyx_e_3nes_6cycore_3ppu_SPRITE_OVERFLOW_MASK * __pyx_v_self-&gt;sprite_overflow));
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">116</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">117</span>:     cdef unsigned char read_register(self, int register):</pre>
<pre class='cython code score-2 '>static unsigned char __pyx_f_3nes_6cycore_3ppu_6NESPPU_read_register(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self, int __pyx_v_register) {
  unsigned char __pyx_v_v;
  unsigned char __pyx_r;
/* … */
  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.read_register", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">118</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">119</span>:         Read the specified PPU register (and take the correct actions along with that)</pre>
<pre class="cython line score-0">&#xA0;<span class="">120</span>:         This is mostly (always?) triggered by the CPU reading memory mapped ram at 0x2000-0x3FFF</pre>
<pre class="cython line score-0">&#xA0;<span class="">121</span>:         "Reading a nominally write-only register will return the latch's current value" [6].</pre>
<pre class="cython line score-0">&#xA0;<span class="">122</span>:         The "latch" here refers to the capacitance</pre>
<pre class="cython line score-0">&#xA0;<span class="">123</span>:         of the PPU lines, which leads to some degree of "memory" on the lines, which will hold the last</pre>
<pre class="cython line score-0">&#xA0;<span class="">124</span>:         value written to a port (including read only ones), or the last value read from a read-only port</pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">127</span>:         cdef unsigned char v=0</pre>
<pre class='cython code score-0 '>  __pyx_v_v = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">128</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">129</span>:         if register == PPU_CTRL:</pre>
<pre class='cython code score-0 '>  switch (__pyx_v_register) {
    case __pyx_e_3nes_6cycore_3ppu_PPU_CTRL:
/* … */
    break;
    case __pyx_e_3nes_6cycore_3ppu_PPU_MASK:
</pre><pre class="cython line score-0">&#xA0;<span class="">130</span>:             # write only</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">131</span>:             return self._io_latch</pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_v_self-&gt;_io_latch;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">132</span>:         elif register == PPU_MASK:</pre>
<pre class='cython code score-0 '>    break;
    case __pyx_e_3nes_6cycore_3ppu_PPU_STATUS:
</pre><pre class="cython line score-0">&#xA0;<span class="">133</span>:             # write only</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">134</span>:             return self._io_latch</pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_v_self-&gt;_io_latch;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">135</span>:         elif register == PPU_STATUS:</pre>
<pre class='cython code score-0 '>    break;
    case __pyx_e_3nes_6cycore_3ppu_OAM_ADDR:
</pre><pre class="cython line score-0">&#xA0;<span class="">136</span>:             # clear ppu_scroll and ppu_addr latches</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">137</span>:             self._ppu_byte_latch = 0   # this is a shared latch between scroll and addr</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;_ppu_byte_latch = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">138</span>:             v = self.ppu_status() + (0x00011111 &amp; self._io_latch)</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;ppu_status(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 138, __pyx_L1_error)</span>
    __pyx_v_v = (__pyx_t_1 + (0x00011111 &amp; __pyx_v_self-&gt;_io_latch));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">139</span>:             self.in_vblank = False  # clear vblank in ppu_status</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;in_vblank = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">140</span>:             self._io_latch = v</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;_io_latch = __pyx_v_v;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">141</span>:             return v</pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_v_v;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">142</span>:         elif register == OAM_ADDR:</pre>
<pre class='cython code score-0 '>    break;
    case __pyx_e_3nes_6cycore_3ppu_OAM_DATA:
</pre><pre class="cython line score-0">&#xA0;<span class="">143</span>:             # write only</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">144</span>:             return self._io_latch</pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_v_self-&gt;_io_latch;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">145</span>:         elif register == OAM_DATA:</pre>
<pre class='cython code score-0 '>    break;
    case __pyx_e_3nes_6cycore_3ppu_PPU_SCROLL:
</pre><pre class="cython line score-0">&#xA0;<span class="">146</span>:             # todo: does not properly implement the weird results of this read during rendering</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">147</span>:             v = self.oam[self.oam_addr]</pre>
<pre class='cython code score-0 '>    __pyx_v_v = (__pyx_v_self-&gt;oam[__pyx_v_self-&gt;oam_addr]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">148</span>:             self._io_latch = v</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;_io_latch = __pyx_v_v;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">149</span>:             return v</pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_v_v;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">150</span>:         elif register == PPU_SCROLL:</pre>
<pre class='cython code score-0 '>    break;
    case __pyx_e_3nes_6cycore_3ppu_PPU_ADDR:
</pre><pre class="cython line score-0">&#xA0;<span class="">151</span>:             # write only</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">152</span>:             return self._io_latch</pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_v_self-&gt;_io_latch;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">153</span>:         elif register == PPU_ADDR:</pre>
<pre class='cython code score-0 '>    break;
    case __pyx_e_3nes_6cycore_3ppu_PPU_DATA:
</pre><pre class="cython line score-0">&#xA0;<span class="">154</span>:             # write only</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">155</span>:             return self._io_latch</pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_v_self-&gt;_io_latch;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">156</span>:         elif register == PPU_DATA:</pre>
<pre class='cython code score-0 '>    break;
    default: break;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">157</span>:             if self.ppu_addr &lt; PALETTE_START:</pre>
<pre class='cython code score-0 '>    __pyx_t_2 = (__pyx_v_self-&gt;ppu_addr &lt; __pyx_e_3nes_6cycore_6memory_PALETTE_START);
    if (__pyx_t_2) {
/* … */
      goto __pyx_L3;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">158</span>:                 v = self._ppu_data_buffer</pre>
<pre class='cython code score-0 '>      __pyx_t_1 = __pyx_v_self-&gt;_ppu_data_buffer;
      __pyx_v_v = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">159</span>:                 self._ppu_data_buffer = self.vram.read(self.ppu_addr)</pre>
<pre class='cython code score-0 '>      __pyx_t_1 = ((struct __pyx_vtabstruct_3nes_6cycore_6memory_NESVRAM *)__pyx_v_self-&gt;vram-&gt;__pyx_base.__pyx_vtab)-&gt;__pyx_base.read(((struct __pyx_obj_3nes_6cycore_6memory_MemoryBase *)__pyx_v_self-&gt;vram), __pyx_v_self-&gt;ppu_addr);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 159, __pyx_L1_error)</span>
      __pyx_v_self-&gt;_ppu_data_buffer = __pyx_t_1;
</pre><pre class="cython line score-0">&#xA0;<span class="">160</span>:             else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">161</span>:                 v = self.vram.read(self.ppu_addr)</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_t_1 = ((struct __pyx_vtabstruct_3nes_6cycore_6memory_NESVRAM *)__pyx_v_self-&gt;vram-&gt;__pyx_base.__pyx_vtab)-&gt;__pyx_base.read(((struct __pyx_obj_3nes_6cycore_6memory_MemoryBase *)__pyx_v_self-&gt;vram), __pyx_v_self-&gt;ppu_addr);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 161, __pyx_L1_error)</span>
      __pyx_v_v = __pyx_t_1;
</pre><pre class="cython line score-0">&#xA0;<span class="">162</span>:                 # palette reads will return the palette without buffering, but will put the mirrored NT byte in the</pre>
<pre class="cython line score-0">&#xA0;<span class="">163</span>:                 # read buffer, i.e. reading $3F00 will give you the palette entry at $3F00 and will put the byte in</pre>
<pre class="cython line score-0">&#xA0;<span class="">164</span>:                 # VRAM[$2F00] in the read buffer</pre>
<pre class="cython line score-0">&#xA0;<span class="">165</span>:                 # source: http://forums.nesdev.com/viewtopic.php?t=1721</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">166</span>:                 self._ppu_data_buffer = self.vram.read(self.ppu_addr - 0x1000)</pre>
<pre class='cython code score-0 '>      __pyx_t_1 = ((struct __pyx_vtabstruct_3nes_6cycore_6memory_NESVRAM *)__pyx_v_self-&gt;vram-&gt;__pyx_base.__pyx_vtab)-&gt;__pyx_base.read(((struct __pyx_obj_3nes_6cycore_6memory_MemoryBase *)__pyx_v_self-&gt;vram), (__pyx_v_self-&gt;ppu_addr - 0x1000));<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 166, __pyx_L1_error)</span>
      __pyx_v_self-&gt;_ppu_data_buffer = __pyx_t_1;
    }
    __pyx_L3:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">167</span>:             self._increment_vram_address()</pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_increment_vram_address(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 167, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">168</span>:             self._io_latch = self._ppu_data_buffer</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = __pyx_v_self-&gt;_ppu_data_buffer;
    __pyx_v_self-&gt;_io_latch = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">169</span>:             return v</pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_v_v;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">170</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">171</span>:     cdef void write_register(self, int register, unsigned char value):</pre>
<pre class='cython code score-2 '>static void __pyx_f_3nes_6cycore_3ppu_6NESPPU_write_register(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self, int __pyx_v_register, unsigned char __pyx_v_value) {
  int __pyx_v_trigger_nmi;
  CYTHON_UNUSED int __pyx_v_n_chng;
  int __pyx_v_prev_ppu_addr;
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.write_register", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">172</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">173</span>:         Write one of the PPU registers with byte value and do whatever else that entails</pre>
<pre class="cython line score-0">&#xA0;<span class="">174</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">175</span>:         # need to store the last write because it affects the value read on ppu_status</pre>
<pre class="cython line score-0">&#xA0;<span class="">176</span>:         # "Writing any value to any PPU port, even to the nominally read-only PPUSTATUS, will fill this latch"  [6]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">177</span>:         cdef int trigger_nmi=0, n_chng=0, prev_ppu_addr=0</pre>
<pre class='cython code score-0 '>  __pyx_v_trigger_nmi = 0;
  __pyx_v_n_chng = 0;
  __pyx_v_prev_ppu_addr = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">178</span>:         value &amp;= 0xFF  # can only write a byte here</pre>
<pre class='cython code score-0 '>  __pyx_v_value = (__pyx_v_value &amp; 0xFF);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">179</span>:         self._io_latch = value</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;_io_latch = __pyx_v_value;
</pre><pre class="cython line score-0">&#xA0;<span class="">180</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">181</span>:         if register == PPU_CTRL:</pre>
<pre class='cython code score-0 '>  switch (__pyx_v_register) {
    case __pyx_e_3nes_6cycore_3ppu_PPU_CTRL:
/* … */
    break;
    case __pyx_e_3nes_6cycore_3ppu_PPU_MASK:
</pre><pre class="cython line score-0">&#xA0;<span class="">182</span>:             # write only</pre>
<pre class="cython line score-0">&#xA0;<span class="">183</span>:             # writes to ppu_ctrl are ignored at first</pre>
<pre class="cython line score-0">&#xA0;<span class="">184</span>:             # this is a slightly safer mechanism to implement this rather than relying on cycles_since_reset, which</pre>
<pre class="cython line score-0">&#xA0;<span class="">185</span>:             # caused a bug by overflowing</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">186</span>:             if self.ignore_ppu_ctrl:</pre>
<pre class='cython code score-0 '>    if (__pyx_v_self-&gt;ignore_ppu_ctrl) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">187</span>:                 if self.cycles_since_reset &lt; 29658:</pre>
<pre class='cython code score-0 '>      __pyx_t_1 = (__pyx_v_self-&gt;cycles_since_reset &lt; 0x73DA);
      if (__pyx_t_1) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">188</span>:                     return</pre>
<pre class='cython code score-0 '>        goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">189</span>:                 else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">190</span>:                     self.ignore_ppu_ctrl = False</pre>
<pre class='cython code score-0 '>      /*else*/ {
        __pyx_v_self-&gt;ignore_ppu_ctrl = 0;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">191</span>:             # can trigger an immediate NMI if we are in vblank and the (allow) vblank NMI trigger flag is flipped high</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">192</span>:             trigger_nmi = self.in_vblank \</pre>
<pre class='cython code score-0 '>    if (__pyx_v_self-&gt;in_vblank) {
    } else {
      __pyx_t_2 = __pyx_v_self-&gt;in_vblank;
      goto __pyx_L5_bool_binop_done;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">193</span>:                           and (value &amp; VBLANK_MASK) &gt; 0 \</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_value &amp; __pyx_e_3nes_6cycore_3ppu_VBLANK_MASK) &gt; 0);
    if (__pyx_t_1) {
    } else {
      __pyx_t_2 = __pyx_t_1;
      goto __pyx_L5_bool_binop_done;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">194</span>:                           and (self.ppu_ctrl &amp; VBLANK_MASK) == 0</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_self-&gt;ppu_ctrl &amp; __pyx_e_3nes_6cycore_3ppu_VBLANK_MASK) == 0);
    __pyx_t_2 = __pyx_t_1;
    __pyx_L5_bool_binop_done:;
    __pyx_v_trigger_nmi = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">195</span>:             self.ppu_ctrl = value</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;ppu_ctrl = __pyx_v_value;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">196</span>:             if trigger_nmi:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = (__pyx_v_trigger_nmi != 0);
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">197</span>:                 self._trigger_nmi()</pre>
<pre class='cython code score-0 '>      ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_trigger_nmi(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 197, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">198</span>:         elif register == PPU_MASK:</pre>
<pre class='cython code score-0 '>    break;
    case __pyx_e_3nes_6cycore_3ppu_PPU_STATUS:
</pre><pre class="cython line score-0">&#xA0;<span class="">199</span>:             # write only</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">200</span>:             self.ppu_mask = value</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;ppu_mask = __pyx_v_value;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">201</span>:         elif register == PPU_STATUS:</pre>
<pre class='cython code score-0 '>    break;
    case __pyx_e_3nes_6cycore_3ppu_OAM_ADDR:
</pre><pre class="cython line score-0">&#xA0;<span class="">202</span>:             # read only</pre>
<pre class="cython line score-0">&#xA0;<span class="">203</span>:             pass</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">204</span>:         elif register == OAM_ADDR:</pre>
<pre class='cython code score-0 '>    break;
    case __pyx_e_3nes_6cycore_3ppu_OAM_DATA:
</pre><pre class="cython line score-0">&#xA0;<span class="">205</span>:             # write only</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">206</span>:             self.oam_addr = value</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;oam_addr = __pyx_v_value;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">207</span>:         elif register == OAM_DATA:</pre>
<pre class='cython code score-0 '>    break;
    case __pyx_e_3nes_6cycore_3ppu_PPU_SCROLL:
</pre><pre class="cython line score-0">&#xA0;<span class="">208</span>:             # read/write</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">209</span>:             self.oam[self.oam_addr] = value</pre>
<pre class='cython code score-0 '>    (__pyx_v_self-&gt;oam[__pyx_v_self-&gt;oam_addr]) = __pyx_v_value;
</pre><pre class="cython line score-0">&#xA0;<span class="">210</span>:             # increment the OAM address and wrap around if necessary (wraps to start of page since OAM addr specifies</pre>
<pre class="cython line score-0">&#xA0;<span class="">211</span>:             # sub-page address)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">212</span>:             self.oam_addr = (self.oam_addr + 1) &amp; 0xFF</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;oam_addr = ((__pyx_v_self-&gt;oam_addr + 1) &amp; 0xFF);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">213</span>:         elif register == PPU_SCROLL:</pre>
<pre class='cython code score-0 '>    break;
    case __pyx_e_3nes_6cycore_3ppu_PPU_ADDR:
</pre><pre class="cython line score-0">&#xA0;<span class="">214</span>:             # write only</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">215</span>:             self.ppu_scroll[self._ppu_byte_latch] = value</pre>
<pre class='cython code score-0 '>    (__pyx_v_self-&gt;ppu_scroll[__pyx_v_self-&gt;_ppu_byte_latch]) = __pyx_v_value;
</pre><pre class="cython line score-0">&#xA0;<span class="">216</span>:             # flip which byte is pointed to on each write; reset on ppu status read.  Latch shared with ppu_addr.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">217</span>:             self._ppu_byte_latch = 1 - self._ppu_byte_latch</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;_ppu_byte_latch = (1 - __pyx_v_self-&gt;_ppu_byte_latch);
</pre><pre class="cython line score-0">&#xA0;<span class="">218</span>:             #print("set scroll: line {}, px {}, y-scroll: {}".format(self.line, self.pixel, self.ppu_scroll[PPU_SCROLL_Y]))</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">219</span>:         elif register == PPU_ADDR:</pre>
<pre class='cython code score-0 '>    break;
    case __pyx_e_3nes_6cycore_3ppu_PPU_DATA:
</pre><pre class="cython line score-0">&#xA0;<span class="">220</span>:             # write only</pre>
<pre class="cython line score-0">&#xA0;<span class="">221</span>:             # high byte first</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">222</span>:             if self._ppu_byte_latch == 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = (__pyx_v_self-&gt;_ppu_byte_latch == 0);
    if (__pyx_t_1) {
/* … */
      goto __pyx_L9;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">223</span>:                 prev_ppu_addr = self.ppu_addr</pre>
<pre class='cython code score-0 '>      __pyx_t_3 = __pyx_v_self-&gt;ppu_addr;
      __pyx_v_prev_ppu_addr = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">224</span>:                 self.ppu_addr = (self.ppu_addr &amp; 0x00FF) + (value &lt;&lt; 8)</pre>
<pre class='cython code score-0 '>      __pyx_v_self-&gt;ppu_addr = ((__pyx_v_self-&gt;ppu_addr &amp; 0x00FF) + (__pyx_v_value &lt;&lt; 8));
</pre><pre class="cython line score-0">&#xA0;<span class="">225</span>:                 # Writes here overwrite the current nametable bits in ppu_ctrl (or at least overwrite bits in an</pre>
<pre class="cython line score-0">&#xA0;<span class="">226</span>:                 # internal latch that is equivalent to this); see [7].  Some games, e.g. SMB, rely on this behaviour</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">227</span>:                 self.ppu_ctrl = (self.ppu_ctrl &amp; 0b11111100) + ((value &amp; 0b00001100) &gt;&gt; 2)</pre>
<pre class='cython code score-0 '>      __pyx_v_self-&gt;ppu_ctrl = ((__pyx_v_self-&gt;ppu_ctrl &amp; 252) + ((__pyx_v_value &amp; 12) &gt;&gt; 2));
</pre><pre class="cython line score-0">&#xA0;<span class="">228</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">229</span>:                 # a write here also has a very unusual effect on the coarse and fine y scroll [7]</pre>
<pre class="cython line score-0">&#xA0;<span class="">230</span>:                 # (note that bit 2 of PPU_SCROLL_Y is always set to 0 by this)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">231</span>:                 self.ppu_scroll[PPU_SCROLL_Y] = (self.ppu_scroll[PPU_SCROLL_Y] &amp; 0b00111000) + \</pre>
<pre class='cython code score-0 '>      (__pyx_v_self-&gt;ppu_scroll[__pyx_e_3nes_6cycore_3ppu_PPU_SCROLL_Y]) = ((((__pyx_v_self-&gt;ppu_scroll[__pyx_e_3nes_6cycore_3ppu_PPU_SCROLL_Y]) &amp; 56) + ((__pyx_v_value &amp; 3) &lt;&lt; 6)) + ((__pyx_v_value &amp; 48) &gt;&gt; 4));
</pre><pre class="cython line score-0">&#xA0;<span class="">232</span>:                                                      ((value &amp; 0b00000011) &lt;&lt; 6) + ((value &amp; 0b00110000) &gt;&gt; 4)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">233</span>:                 if bit_low(prev_ppu_addr, 12) and bit_high(self.ppu_addr, 12):</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = __pyx_f_3nes_6cycore_7bitwise_bit_low(__pyx_v_prev_ppu_addr, 12);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 233, __pyx_L1_error)</span>
      __pyx_t_4 = (__pyx_t_2 != 0);
      if (__pyx_t_4) {
      } else {
        __pyx_t_1 = __pyx_t_4;
        goto __pyx_L11_bool_binop_done;
      }
      __pyx_t_2 = __pyx_f_3nes_6cycore_7bitwise_bit_high(__pyx_v_self-&gt;ppu_addr, 12);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 233, __pyx_L1_error)</span>
      __pyx_t_4 = (__pyx_t_2 != 0);
      __pyx_t_1 = __pyx_t_4;
      __pyx_L11_bool_binop_done:;
      if (__pyx_t_1) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">234</span>:                     self.vram.cart.irq_tick()</pre>
<pre class='cython code score-0 '>        ((struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart *)__pyx_v_self-&gt;vram-&gt;cart-&gt;__pyx_vtab)-&gt;irq_tick(__pyx_v_self-&gt;vram-&gt;cart);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 234, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">235</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">236</span>:                 #print("set scroll: line {}, px {}, y-scroll: {}".format(self.line, self.pixel, self.ppu_scroll[PPU_SCROLL_Y]))</pre>
<pre class="cython line score-0">&#xA0;<span class="">237</span>:             else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">238</span>:                 self.ppu_addr = (self.ppu_addr &amp; 0xFF00) + value</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_self-&gt;ppu_addr = ((__pyx_v_self-&gt;ppu_addr &amp; 0xFF00) + __pyx_v_value);
</pre><pre class="cython line score-0">&#xA0;<span class="">239</span>:                 # writes here have a weird effect on the x and y scroll values [7]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">240</span>:                 self.ppu_scroll[PPU_SCROLL_X] = (self.ppu_scroll[PPU_SCROLL_X] &amp; 0b00000111) + ((value &amp; 0b00011111) &lt;&lt; 3)</pre>
<pre class='cython code score-0 '>      (__pyx_v_self-&gt;ppu_scroll[__pyx_e_3nes_6cycore_3ppu_PPU_SCROLL_X]) = (((__pyx_v_self-&gt;ppu_scroll[__pyx_e_3nes_6cycore_3ppu_PPU_SCROLL_X]) &amp; 7) + ((__pyx_v_value &amp; 31) &lt;&lt; 3));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">241</span>:                 self.ppu_scroll[PPU_SCROLL_Y] = (self.ppu_scroll[PPU_SCROLL_Y] &amp; 0b11000111) + ((value &amp; 0b11100000) &gt;&gt; 2)</pre>
<pre class='cython code score-0 '>      (__pyx_v_self-&gt;ppu_scroll[__pyx_e_3nes_6cycore_3ppu_PPU_SCROLL_Y]) = (((__pyx_v_self-&gt;ppu_scroll[__pyx_e_3nes_6cycore_3ppu_PPU_SCROLL_Y]) &amp; 199) + ((__pyx_v_value &amp; 224) &gt;&gt; 2));
</pre><pre class="cython line score-0">&#xA0;<span class="">242</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">243</span>:                 # side effect is that y-scroll is changed immediately, allowing mid-frame y-scroll changes</pre>
<pre class="cython line score-0">&#xA0;<span class="">244</span>:                 # this only happens on the second write to ppu_addr</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">245</span>:                 self._reset_effective_y()</pre>
<pre class='cython code score-0 '>      ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_reset_effective_y(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 245, __pyx_L1_error)</span>
    }
    __pyx_L9:;
</pre><pre class="cython line score-0">&#xA0;<span class="">246</span>:                 #print("set scroll: line {}, px {}, y-scroll: {} (IMMEDIATE)".format(self.line, self.pixel, self.ppu_scroll[PPU_SCROLL_Y]))</pre>
<pre class="cython line score-0">&#xA0;<span class="">247</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">248</span>:             # flip which byte is pointed to on each write; reset on ppu status read</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">249</span>:             self._ppu_byte_latch = 1 - self._ppu_byte_latch</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;_ppu_byte_latch = (1 - __pyx_v_self-&gt;_ppu_byte_latch);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">250</span>:         elif register == PPU_DATA:</pre>
<pre class='cython code score-0 '>    break;
    default: break;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">251</span>:             # read/write</pre>
<pre class="cython line score-0">&#xA0;<span class="">252</span>:             #print("write {:02X} to {:04X}".format(value, self.ppu_addr))</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">253</span>:             self.vram.write(self.ppu_addr, value)</pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_3nes_6cycore_6memory_NESVRAM *)__pyx_v_self-&gt;vram-&gt;__pyx_base.__pyx_vtab)-&gt;__pyx_base.write(((struct __pyx_obj_3nes_6cycore_6memory_MemoryBase *)__pyx_v_self-&gt;vram), __pyx_v_self-&gt;ppu_addr, __pyx_v_value);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 253, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">254</span>:             self._increment_vram_address()</pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_increment_vram_address(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 254, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">255</span>:             # invalidate the palette cache if this is a write to the palette memory.  Could be more careful about what</pre>
<pre class="cython line score-0">&#xA0;<span class="">256</span>:             # is invalidated here so that potentially less recalculation is needed.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">257</span>:             if self.ppu_addr &gt;= PALETTE_START:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = (__pyx_v_self-&gt;ppu_addr &gt;= __pyx_e_3nes_6cycore_6memory_PALETTE_START);
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">258</span>:                 self.invalidate_palette_cache()</pre>
<pre class='cython code score-0 '>      ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;invalidate_palette_cache(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 258, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">259</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">260</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">261</span>:     ################ Screen buffer copy and clear ######################################################################</pre>
<pre class="cython line score-0">&#xA0;<span class="">262</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">263</span>:     cdef int get_background_color(self):</pre>
<pre class='cython code score-2 '>static int __pyx_f_3nes_6cycore_3ppu_6NESPPU_get_background_color(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self) {
  int __pyx_v_p0[4];
  int __pyx_r;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.get_background_color", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">264</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">265</span>:         Get the background color for the screen (set by color zero of palette zero)</pre>
<pre class="cython line score-0">&#xA0;<span class="">266</span>:         :return:</pre>
<pre class="cython line score-0">&#xA0;<span class="">267</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">268</span>:         cdef int p0[4]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">269</span>:         self.decode_palette(p0, 0, False)</pre>
<pre class='cython code score-0 '>  ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;decode_palette(__pyx_v_self, __pyx_v_p0, 0, 0);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 269, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">270</span>:         return self.hex_palette[p0[0]]</pre>
<pre class='cython code score-0 '>  __pyx_r = (__pyx_v_self-&gt;hex_palette[(__pyx_v_p0[0])]);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">271</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">272</span>:     cdef void _clear_to_bkg(self):</pre>
<pre class='cython code score-2 '>static void __pyx_f_3nes_6cycore_3ppu_6NESPPU__clear_to_bkg(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self) {
  int __pyx_v_cc;
  int __pyx_v_x;
  int __pyx_v_y;
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU._clear_to_bkg", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">273</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">274</span>:         Clears the screen buffer to the background color (which is set by palette 0)</pre>
<pre class="cython line score-0">&#xA0;<span class="">275</span>:         :return:</pre>
<pre class="cython line score-0">&#xA0;<span class="">276</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">277</span>:         cdef int cc=0, x=0, y=0</pre>
<pre class='cython code score-0 '>  __pyx_v_cc = 0;
  __pyx_v_x = 0;
  __pyx_v_y = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">278</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">279</span>:         cc = self.get_background_color()</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;get_background_color(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 279, __pyx_L1_error)</span>
  __pyx_v_cc = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">280</span>:         for x in range(SCREEN_WIDTH_PX):</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_e_3nes_6cycore_3ppu_SCREEN_WIDTH_PX;
  __pyx_t_3 = __pyx_t_2;
  for (__pyx_t_1 = 0; __pyx_t_1 &lt; __pyx_t_3; __pyx_t_1+=1) {
    __pyx_v_x = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">281</span>:             for y in range(SCREEN_HEIGHT_PX):</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_e_3nes_6cycore_3ppu_SCREEN_HEIGHT_PX;
    __pyx_t_5 = __pyx_t_4;
    for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_y = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">282</span>:                 self.screen_buffer[x][y] = cc</pre>
<pre class='cython code score-0 '>      ((__pyx_v_self-&gt;screen_buffer[__pyx_v_x])[__pyx_v_y]) = __pyx_v_cc;
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">283</span>: </pre>
<pre class="cython line score-105" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">284</span>:     cpdef void copy_screen_buffer_to(self, unsigned int[:, :] dest, bint v_overscan=False, bint h_overscan=False):</pre>
<pre class='cython code score-105 '>static PyObject *__pyx_pw_3nes_6cycore_3ppu_6NESPPU_5copy_screen_buffer_to(PyObject *__pyx_v_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static void __pyx_f_3nes_6cycore_3ppu_6NESPPU_copy_screen_buffer_to(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self, __Pyx_memviewslice __pyx_v_dest, int __pyx_skip_dispatch, struct __pyx_opt_args_3nes_6cycore_3ppu_6NESPPU_copy_screen_buffer_to *__pyx_optional_args) {
  int __pyx_v_v_overscan = ((int)0);
  int __pyx_v_h_overscan = ((int)0);
  int __pyx_v_start_line;
  int __pyx_v_end_line;
  int __pyx_v_start_row;
  int __pyx_v_end_row;
  __Pyx_memviewslice __pyx_v_scr_mv = { 0, 0, { 0 }, { 0 }, { 0 } };
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_v_overscan = __pyx_optional_args-&gt;v_overscan;
      if (__pyx_optional_args-&gt;__pyx_n &gt; 1) {
        __pyx_v_h_overscan = __pyx_optional_args-&gt;h_overscan;
      }
    }
  }
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (
  #if !CYTHON_USE_TYPE_SLOTS
  unlikely(Py_TYPE(((PyObject *)__pyx_v_self)) != __pyx_mstate_global-&gt;__pyx_ptype_3nes_6cycore_3ppu_NESPPU &amp;&amp;
  <span class='pyx_c_api'>__Pyx_PyType_HasFeature</span>(Py_TYPE(((PyObject *)__pyx_v_self)), Py_TPFLAGS_HAVE_GC))
  #else
  unlikely(Py_TYPE(((PyObject *)__pyx_v_self))-&gt;tp_dictoffset != 0 || <span class='pyx_c_api'>__Pyx_PyType_HasFeature</span>(Py_TYPE(((PyObject *)__pyx_v_self)), (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))
  #endif
  ) {
    #if CYTHON_USE_DICT_VERSIONS &amp;&amp; CYTHON_USE_PYTYPE_LOOKUP &amp;&amp; CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_typedict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_self), __pyx_mstate_global-&gt;__pyx_n_u_copy_screen_buffer_to);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 284, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      if (!<span class='pyx_c_api'>__Pyx_IsSameCFunction</span>(__pyx_t_1, (void(*)(void)) __pyx_pw_3nes_6cycore_3ppu_6NESPPU_5copy_screen_buffer_to)) {
        __pyx_t_3 = NULL;
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
        __pyx_t_4 = __pyx_t_1; 
        if (unlikely(!__pyx_v_dest.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("dest"); <span class='error_goto'>__PYX_ERR(0, 284, __pyx_L1_error)</span> }
        __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_dest, 2, (PyObject *(*)(char *)) __pyx_memview_get_unsigned_int, (int (*)(char *, PyObject *)) __pyx_memview_set_unsigned_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 284, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(__pyx_v_v_overscan);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 284, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(__pyx_v_h_overscan);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 284, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        __pyx_t_8 = 1;
        #if CYTHON_UNPACK_METHODS
        if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
          __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
          assert(__pyx_t_3);
          PyObject* __pyx__function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx__function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, __pyx__function);
          __pyx_t_8 = 0;
        }
        #endif
        {
          PyObject *__pyx_callargs[4] = {__pyx_t_3, __pyx_t_5, __pyx_t_6, __pyx_t_7};
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_4, __pyx_callargs+__pyx_t_8, (4-__pyx_t_8) | (__pyx_t_8*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 284, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS &amp;&amp; CYTHON_USE_PYTYPE_LOOKUP &amp;&amp; CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_typedict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS &amp;&amp; CYTHON_USE_PYTYPE_LOOKUP &amp;&amp; CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_t_10);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_12, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.copy_screen_buffer_to", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_scr_mv, 1);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_3nes_6cycore_3ppu_6NESPPU_5copy_screen_buffer_to(PyObject *__pyx_v_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_3nes_6cycore_3ppu_6NESPPU_4copy_screen_buffer_to, "\n        Copy the screen buffer to a supplied destination.  Up to the caller to ensure that the destination buffer\n        has sufficient space to write into.\n        ");
static PyMethodDef __pyx_mdef_3nes_6cycore_3ppu_6NESPPU_5copy_screen_buffer_to = {"copy_screen_buffer_to", (PyCFunction)(void(*)(void))(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_3nes_6cycore_3ppu_6NESPPU_5copy_screen_buffer_to, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_3nes_6cycore_3ppu_6NESPPU_4copy_screen_buffer_to};
static PyObject *__pyx_pw_3nes_6cycore_3ppu_6NESPPU_5copy_screen_buffer_to(PyObject *__pyx_v_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_dest = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_v_overscan;
  int __pyx_v_h_overscan;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("copy_screen_buffer_to (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_SIZE
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject ** const __pyx_pyargnames[] = {&amp;__pyx_mstate_global-&gt;__pyx_n_u_dest,&amp;__pyx_mstate_global-&gt;__pyx_n_u_v_overscan,&amp;__pyx_mstate_global-&gt;__pyx_n_u_h_overscan,0};
  PyObject* values[3] = {0,0,0};
    const Py_ssize_t __pyx_kwds_len = (__pyx_kwds) ? <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds) : 0;
    if (unlikely(__pyx_kwds_len) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 284, __pyx_L3_error)</span>
    if (__pyx_kwds_len &gt; 0) {
      switch (__pyx_nargs) {
        case  3:
        values[2] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 2);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[2])) <span class='error_goto'>__PYX_ERR(0, 284, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  2:
        values[1] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 1);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[1])) <span class='error_goto'>__PYX_ERR(0, 284, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  1:
        values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 0);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 284, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      const Py_ssize_t kwd_pos_args = __pyx_nargs;
      if (<span class='pyx_c_api'>__Pyx_ParseKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values, kwd_pos_args, __pyx_kwds_len, "copy_screen_buffer_to", 0) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 284, __pyx_L3_error)</span>
      for (Py_ssize_t i = __pyx_nargs; i &lt; 1; i++) {
        if (unlikely(!values[i])) { <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("copy_screen_buffer_to", 0, 1, 3, i); <span class='error_goto'>__PYX_ERR(0, 284, __pyx_L3_error)</span> }
      }
    } else {
      switch (__pyx_nargs) {
        case  3:
        values[2] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 2);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[2])) <span class='error_goto'>__PYX_ERR(0, 284, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  2:
        values[1] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 1);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[1])) <span class='error_goto'>__PYX_ERR(0, 284, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  1:
        values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 0);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 284, __pyx_L3_error)</span>
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_dest = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_unsigned_int</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_dest.memview)) __PYX_ERR(0, 284, __pyx_L3_error)</span>
    if (values[1]) {
      __pyx_v_v_overscan = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[1]); if (unlikely((__pyx_v_v_overscan == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 284, __pyx_L3_error)</span>
    } else {
      __pyx_v_v_overscan = ((int)0);
    }
    if (values[2]) {
      __pyx_v_h_overscan = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[2]); if (unlikely((__pyx_v_h_overscan == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 284, __pyx_L3_error)</span>
    } else {
      __pyx_v_h_overscan = ((int)0);
    }
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("copy_screen_buffer_to", 0, 1, 3, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 284, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_dest, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.copy_screen_buffer_to", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3nes_6cycore_3ppu_6NESPPU_4copy_screen_buffer_to(((struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self), __pyx_v_dest, __pyx_v_v_overscan, __pyx_v_h_overscan);

  /* function exit code */
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_dest, 1);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3nes_6cycore_3ppu_6NESPPU_4copy_screen_buffer_to(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self, __Pyx_memviewslice __pyx_v_dest, int __pyx_v_v_overscan, int __pyx_v_h_overscan) {
  PyObject *__pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  if (unlikely(!__pyx_v_dest.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("dest"); <span class='error_goto'>__PYX_ERR(0, 284, __pyx_L1_error)</span> }
  __pyx_t_1.__pyx_n = 2;
  __pyx_t_1.v_overscan = __pyx_v_v_overscan;
  __pyx_t_1.h_overscan = __pyx_v_h_overscan;
  __pyx_vtabptr_3nes_6cycore_3ppu_NESPPU-&gt;copy_screen_buffer_to(__pyx_v_self, __pyx_v_dest, 1, &amp;__pyx_t_1);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 284, __pyx_L1_error)</span>
  __pyx_t_2 = __Pyx_void_to_None(NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 284, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.copy_screen_buffer_to", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_3nes_6cycore_3ppu_6NESPPU_5copy_screen_buffer_to, __Pyx_CYFUNCTION_CCLASS, __pyx_mstate_global-&gt;__pyx_n_u_NESPPU_copy_screen_buffer_to, NULL, __pyx_mstate_global-&gt;__pyx_n_u_nes_cycore_ppu, __pyx_mstate_global-&gt;__pyx_d, ((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[2]));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 284, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_5, __pyx_mstate_global-&gt;__pyx_tuple[57]);
  if (<span class='pyx_c_api'>__Pyx_SetItemOnTypeDict</span>(__pyx_mstate_global-&gt;__pyx_ptype_3nes_6cycore_3ppu_NESPPU, __pyx_mstate_global-&gt;__pyx_n_u_copy_screen_buffer_to, __pyx_t_5) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 284, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">285</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">286</span>:         Copy the screen buffer to a supplied destination.  Up to the caller to ensure that the destination buffer</pre>
<pre class="cython line score-0">&#xA0;<span class="">287</span>:         has sufficient space to write into.</pre>
<pre class="cython line score-0">&#xA0;<span class="">288</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">289</span>:         cdef int start_line=VERTICAL_OVERSCAN_PX, end_line=SCREEN_HEIGHT_PX - VERTICAL_OVERSCAN_PX</pre>
<pre class='cython code score-0 '>  __pyx_v_start_line = __pyx_e_3nes_6cycore_3ppu_VERTICAL_OVERSCAN_PX;
  __pyx_v_end_line = (__pyx_e_3nes_6cycore_3ppu_SCREEN_HEIGHT_PX - __pyx_e_3nes_6cycore_3ppu_VERTICAL_OVERSCAN_PX);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">290</span>:         cdef int start_row=HORIZONTAL_OVERSCAN_PX, end_row=SCREEN_WIDTH_PX - HORIZONTAL_OVERSCAN_PX</pre>
<pre class='cython code score-0 '>  __pyx_v_start_row = __pyx_e_3nes_6cycore_3ppu_HORIZONTAL_OVERSCAN_PX;
  __pyx_v_end_row = (__pyx_e_3nes_6cycore_3ppu_SCREEN_WIDTH_PX - __pyx_e_3nes_6cycore_3ppu_HORIZONTAL_OVERSCAN_PX);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">291</span>:         if v_overscan:</pre>
<pre class='cython code score-0 '>  if (__pyx_v_v_overscan) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">292</span>:             start_line = 0</pre>
<pre class='cython code score-0 '>    __pyx_v_start_line = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">293</span>:             end_line = SCREEN_HEIGHT_PX</pre>
<pre class='cython code score-0 '>    __pyx_v_end_line = __pyx_e_3nes_6cycore_3ppu_SCREEN_HEIGHT_PX;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">294</span>:         if h_overscan:</pre>
<pre class='cython code score-0 '>  if (__pyx_v_h_overscan) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">295</span>:             start_row = 0</pre>
<pre class='cython code score-0 '>    __pyx_v_start_row = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">296</span>:             end_row = SCREEN_WIDTH_PX</pre>
<pre class='cython code score-0 '>    __pyx_v_end_row = __pyx_e_3nes_6cycore_3ppu_SCREEN_WIDTH_PX;
</pre><pre class="cython line score-0">&#xA0;<span class="">297</span>:         # create a memory view to the screen to allow it to be treated as a buffer in the Numpy-esque style</pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">298</span>:         cdef unsigned int[:, :] scr_mv = &lt;unsigned int[:SCREEN_WIDTH_PX, :SCREEN_HEIGHT_PX]&gt;self.screen_buffer</pre>
<pre class='cython code score-16 '>  __pyx_t_9 = __pyx_v_self-&gt;screen_buffer;
  if (!__pyx_t_9) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ValueError,"Cannot create cython.array from NULL pointer");
    <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L1_error)</span>
  }
  __pyx_t_2 = __pyx_format_from_typeinfo(&amp;__Pyx_TypeInfo_unsigned_int);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 298, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = Py_BuildValue("("  __PYX_BUILD_PY_SSIZE_T  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)__pyx_e_3nes_6cycore_3ppu_SCREEN_WIDTH_PX), ((Py_ssize_t)__pyx_e_3nes_6cycore_3ppu_SCREEN_HEIGHT_PX));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 298, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  #if CYTHON_COMPILING_IN_LIMITED_API
  __pyx_t_11 = <span class='py_c_api'>PyBytes_AsString</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 298, __pyx_L1_error)</span>
  #else
  __pyx_t_11 = <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_2);
  #endif
  __pyx_t_10 = __pyx_array_new(__pyx_t_1, sizeof(unsigned int), __pyx_t_11, "c", (char *) __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 298, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>((PyObject *)__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_unsigned_int</span>(((PyObject *)__pyx_t_10), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 298, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>((PyObject *)__pyx_t_10); __pyx_t_10 = 0;
  __pyx_v_scr_mv = __pyx_t_12;
  __pyx_t_12.memview = NULL;
  __pyx_t_12.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">299</span>:         dest[:, :] = scr_mv[start_row:end_row, start_line:end_line]</pre>
<pre class='cython code score-0 '>  __pyx_t_12.data = __pyx_v_scr_mv.data;
  __pyx_t_12.memview = __pyx_v_scr_mv.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_12, 1);
  __pyx_t_13 = -1;
  if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_12,
    __pyx_v_scr_mv.shape[0], __pyx_v_scr_mv.strides[0], __pyx_v_scr_mv.suboffsets[0],
    0,
    0,
    &amp;__pyx_t_13,
    __pyx_v_start_row,
    __pyx_v_end_row,
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 299, __pyx_L1_error)</span>
}

if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_12,
    __pyx_v_scr_mv.shape[1], __pyx_v_scr_mv.strides[1], __pyx_v_scr_mv.suboffsets[1],
    1,
    1,
    &amp;__pyx_t_13,
    __pyx_v_start_line,
    __pyx_v_end_line,
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 299, __pyx_L1_error)</span>
}

if (unlikely((__pyx_memoryview_copy_contents(__pyx_t_12, __pyx_v_dest, 2, 2, 0) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 299, __pyx_L1_error)</span>
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_12, 1);
  __pyx_t_12.memview = NULL; __pyx_t_12.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">300</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">301</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">302</span>:     ################ Main cycle running ################################################################################</pre>
<pre class="cython line score-0">&#xA0;<span class="">303</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">304</span>:     cdef int run_cycles(self, int num_cycles):</pre>
<pre class='cython code score-2 '>static int __pyx_f_3nes_6cycore_3ppu_6NESPPU_run_cycles(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self, int __pyx_v_num_cycles) {
  CYTHON_UNUSED int __pyx_v_cyc;
  int __pyx_v_vblank_started;
  int __pyx_r;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.run_cycles", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">305</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">306</span>:         The main function of the PPU that steps it forward the specified number of cycles.  Cycles correspond to screen</pre>
<pre class="cython line score-0">&#xA0;<span class="">307</span>:         pixels during the screen-drawing phase of the ppu there are three ppu cycles per cpu cycles, at least on NTSC</pre>
<pre class="cython line score-0">&#xA0;<span class="">308</span>:         systems.</pre>
<pre class="cython line score-0">&#xA0;<span class="">309</span>:         :param num_cycles: the number of PPU cycles (not cpu cycles!).</pre>
<pre class="cython line score-0">&#xA0;<span class="">310</span>:         :return: whether vblank started during the cycles run</pre>
<pre class="cython line score-0">&#xA0;<span class="">311</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">312</span>:         cdef int cyc=0</pre>
<pre class='cython code score-0 '>  __pyx_v_cyc = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">313</span>:         cdef bint vblank_started=False</pre>
<pre class='cython code score-0 '>  __pyx_v_vblank_started = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">314</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">315</span>:         for cyc in range(num_cycles):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_num_cycles;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_cyc = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">316</span>:             # current scanline of the frame we are on - this determines behaviour during the line</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">317</span>:             if self.line &lt;= 239 and (self.ppu_mask &amp; RENDERING_ENABLED_MASK) &gt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = (__pyx_v_self-&gt;line &lt;= 0xEF);
    if (__pyx_t_5) {
    } else {
      __pyx_t_4 = __pyx_t_5;
      goto __pyx_L6_bool_binop_done;
    }
    __pyx_t_5 = ((__pyx_v_self-&gt;ppu_mask &amp; __pyx_e_3nes_6cycore_3ppu_RENDERING_ENABLED_MASK) &gt; 0);
    __pyx_t_4 = __pyx_t_5;
    __pyx_L6_bool_binop_done:;
    if (__pyx_t_4) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">318</span>:                 self.render_visible_scanline()</pre>
<pre class='cython code score-0 '>      ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;render_visible_scanline(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 318, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">319</span>:             elif self.line == 241 and self.pixel == 1:</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = (__pyx_v_self-&gt;line == 0xF1);
    if (__pyx_t_5) {
    } else {
      __pyx_t_4 = __pyx_t_5;
      goto __pyx_L8_bool_binop_done;
    }
    __pyx_t_5 = (__pyx_v_self-&gt;pixel == 1);
    __pyx_t_4 = __pyx_t_5;
    __pyx_L8_bool_binop_done:;
    if (__pyx_t_4) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">320</span>:                 # set vblank flag</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">321</span>:                 vblank_started = True   # this is used by the emulator to know when it can flip the screen</pre>
<pre class='cython code score-0 '>      __pyx_v_vblank_started = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">322</span>:                 self.in_vblank = True   # set the vblank flag in ppu_status register</pre>
<pre class='cython code score-0 '>      __pyx_v_self-&gt;in_vblank = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">323</span>:                 # trigger NMI (if NMI is enabled)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">324</span>:                 if (self.ppu_ctrl &amp; VBLANK_MASK) &gt; 0:</pre>
<pre class='cython code score-0 '>      __pyx_t_4 = ((__pyx_v_self-&gt;ppu_ctrl &amp; __pyx_e_3nes_6cycore_3ppu_VBLANK_MASK) &gt; 0);
      if (__pyx_t_4) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">325</span>:                     self._trigger_nmi()</pre>
<pre class='cython code score-0 '>        ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_trigger_nmi(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 325, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">326</span>:             elif self.line == 261:</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = (__pyx_v_self-&gt;line == 0x105);
    if (__pyx_t_4) {
/* … */
    }
    __pyx_L5:;
</pre><pre class="cython line score-0">&#xA0;<span class="">327</span>:                 # line 261 is also sometimes called line -1 and is the pre-render scanline</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">328</span>:                 self.prerender_scanline()</pre>
<pre class='cython code score-0 '>      ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;prerender_scanline(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 328, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">329</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">330</span>:             self.increment_pixel()</pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;increment_pixel(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 330, __pyx_L1_error)</span>
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">331</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">332</span>:         return vblank_started</pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_vblank_started;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">333</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">334</span>:     cdef void prerender_scanline(self):</pre>
<pre class='cython code score-2 '>static void __pyx_f_3nes_6cycore_3ppu_6NESPPU_prerender_scanline(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self) {
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.prerender_scanline", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">335</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">336</span>:         The pre-render scanline (line 261) has some special things that happen on it like turning off vblank and</pre>
<pre class="cython line score-0">&#xA0;<span class="">337</span>:         starting to do the background pre-fetch.</pre>
<pre class="cython line score-0">&#xA0;<span class="">338</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">339</span>:         if self.pixel == 1:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_self-&gt;pixel == 1);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">340</span>:             # At dot 1, reset vblank flag in ppu_status</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">341</span>:             self.in_vblank = False</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;in_vblank = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">342</span>:             self.sprite_zero_hit = False</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;sprite_zero_hit = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">343</span>:             self.sprite_overflow = False</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;sprite_overflow = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">344</span>:         elif self.pixel == 257:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_self-&gt;pixel == 0x101);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">345</span>:             # "Sprite evaluation does not happen on the pre-render scanline. Because evaluation applies to the</pre>
<pre class="cython line score-0">&#xA0;<span class="">346</span>:             # next line's sprite rendering, no sprites will be rendered on the first scanline, and this is why</pre>
<pre class="cython line score-0">&#xA0;<span class="">347</span>:             # there is a 1 line offset on a sprite's Y coordinate."</pre>
<pre class="cython line score-0">&#xA0;<span class="">348</span>:             # source: https://wiki.nesdev.com/w/index.php/PPU_sprite_evaluation  (note 1)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">349</span>:             self._num_active_sprites = 0</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;_num_active_sprites = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">350</span>:             # reset the x counter to the start of the line</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">351</span>:             self._effective_x = self.ppu_scroll[PPU_SCROLL_X] + (bit_high(self.ppu_ctrl, BIT_NAMETABLE_X) &lt;&lt; 8)</pre>
<pre class='cython code score-0 '>    __pyx_t_2 = __pyx_f_3nes_6cycore_7bitwise_bit_high(__pyx_v_self-&gt;ppu_ctrl, __pyx_e_3nes_6cycore_3ppu_BIT_NAMETABLE_X);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 351, __pyx_L1_error)</span>
    __pyx_v_self-&gt;_effective_x = ((__pyx_v_self-&gt;ppu_scroll[__pyx_e_3nes_6cycore_3ppu_PPU_SCROLL_X]) + (__pyx_t_2 &lt;&lt; 8));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">352</span>:         elif self.pixel == 260 and (self.ppu_mask &amp; RENDERING_ENABLED_MASK) &gt; 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = (__pyx_v_self-&gt;pixel == 0x104);
  if (__pyx_t_3) {
  } else {
    __pyx_t_1 = __pyx_t_3;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_3 = ((__pyx_v_self-&gt;ppu_mask &amp; __pyx_e_3nes_6cycore_3ppu_RENDERING_ENABLED_MASK) &gt; 0);
  __pyx_t_1 = __pyx_t_3;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">353</span>:             # for simplicity, always trigger the irq_tick once at pixel 260 on the pre-render scanline; this might be</pre>
<pre class="cython line score-0">&#xA0;<span class="">354</span>:             # wrong by a few pixels for this line, but it probably won't matter most of the time</pre>
<pre class="cython line score-0">&#xA0;<span class="">355</span>:             # todo: more correct behaviour here (what is it in the case of double-height sprites?)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">356</span>:             self.vram.cart.irq_tick()</pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart *)__pyx_v_self-&gt;vram-&gt;cart-&gt;__pyx_vtab)-&gt;irq_tick(__pyx_v_self-&gt;vram-&gt;cart);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 356, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">357</span>:         elif self.pixel == 280:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_self-&gt;pixel == 0x118);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">358</span>:             # "Vertical scroll bits are reloaded if rendering is enabled"</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">359</span>:             self._reset_effective_y()</pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_reset_effective_y(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 359, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">360</span>:         elif self.pixel == 328 or self.pixel == 336:</pre>
<pre class='cython code score-0 '>  switch (__pyx_v_self-&gt;pixel) {
    case 0x148:
    case 0x150:
    __pyx_t_1 = 1;
    break;
    default:
    __pyx_t_1 = 0;
    break;
  }
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">361</span>:             # load background data for next scanline</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">362</span>:             self.fill_bkg_latches()  # get some more data for the upper latches</pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;fill_bkg_latches(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 362, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">363</span>:         elif self.pixel == 339:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_self-&gt;pixel == 0x153);
  if (__pyx_t_1) {
/* … */
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">364</span>:             # about the last pixel of the pre-render, so clear the display ready for the next frame</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">365</span>:             self._clear_to_bkg()</pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_clear_to_bkg(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 365, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">366</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">367</span>:     cdef void render_visible_scanline(self):</pre>
<pre class='cython code score-2 '>static void __pyx_f_3nes_6cycore_3ppu_6NESPPU_render_visible_scanline(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self) {
  int __pyx_v_bkg_pixel;
  int __pyx_v_final_pixel;
  CYTHON_UNUSED int __pyx_v_coarse_y;
  int __pyx_v_cmask;
  CYTHON_UNUSED int __pyx_v_sprite_table;
  CYTHON_UNUSED int __pyx_v_double_sprites;
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.render_visible_scanline", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">368</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">369</span>:         Render a pixel on a visible scanline (lines 0-239 inclusive)</pre>
<pre class="cython line score-0">&#xA0;<span class="">370</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">371</span>:         cdef int bkg_pixel=0, final_pixel=0, coarse_y=0, cmask=0, sprite_table=0</pre>
<pre class='cython code score-0 '>  __pyx_v_bkg_pixel = 0;
  __pyx_v_final_pixel = 0;
  __pyx_v_coarse_y = 0;
  __pyx_v_cmask = 0;
  __pyx_v_sprite_table = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">372</span>:         cdef bint double_sprites=False</pre>
<pre class='cython code score-0 '>  __pyx_v_double_sprites = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">373</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">374</span>:         if 0 &lt; self.pixel &lt;= 256:  # pixels 1 - 256</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (0 &lt; __pyx_v_self-&gt;pixel);
  if (__pyx_t_1) {
    __pyx_t_1 = (__pyx_v_self-&gt;pixel &lt;= 0x100);
  }
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">375</span>:             # render pixel - 1</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">376</span>:             if (self.pixel - 1) % 8 == 0 and self.pixel &gt; 1:</pre>
<pre class='cython code score-0 '>    __pyx_t_2 = (((__pyx_v_self-&gt;pixel - 1) % 8) == 0);
    if (__pyx_t_2) {
    } else {
      __pyx_t_1 = __pyx_t_2;
      goto __pyx_L5_bool_binop_done;
    }
    __pyx_t_2 = (__pyx_v_self-&gt;pixel &gt; 1);
    __pyx_t_1 = __pyx_t_2;
    __pyx_L5_bool_binop_done:;
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">377</span>:                 # fill background data latches</pre>
<pre class="cython line score-0">&#xA0;<span class="">378</span>:                 # todo: this is not cycle-correct, since the read is done atomically at the eighth pixel rather than throughout the cycle.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">379</span>:                 self.fill_bkg_latches()   # get some more data for the upper latches</pre>
<pre class='cython code score-0 '>      ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;fill_bkg_latches(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 379, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">380</span>:             # render background from latches</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">381</span>:             bkg_pixel = self._get_bkg_pixel()</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_get_bkg_pixel(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 381, __pyx_L1_error)</span>
    __pyx_v_bkg_pixel = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">382</span>:             # overlay sprite from latches</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">383</span>:             final_pixel = self._overlay_sprites(bkg_pixel)</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_overlay_sprites(__pyx_v_self, __pyx_v_bkg_pixel);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 383, __pyx_L1_error)</span>
    __pyx_v_final_pixel = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">384</span>:             # monochrome mode if bit 0 of ppu_mask is set</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">385</span>:             cmask = 0x30 if (self.ppu_mask &amp; 1) else 0xFF</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_self-&gt;ppu_mask &amp; 1) != 0);
    if (__pyx_t_1) {
      __pyx_t_3 = 0x30;
    } else {
      __pyx_t_3 = 0xFF;
    }
    __pyx_v_cmask = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">386</span>:             if final_pixel != self.transparent_color:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = (__pyx_v_final_pixel != __pyx_v_self-&gt;transparent_color);
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">387</span>:                 self.screen_buffer[self.pixel - 1][self.line] = self.hex_palette[final_pixel &amp; cmask]</pre>
<pre class='cython code score-0 '>      ((__pyx_v_self-&gt;screen_buffer[(__pyx_v_self-&gt;pixel - 1)])[__pyx_v_self-&gt;line]) = (__pyx_v_self-&gt;hex_palette[(__pyx_v_final_pixel &amp; __pyx_v_cmask)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">388</span>:         elif self.pixel == 257:   # pixels 257 - 320</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_self-&gt;pixel == 0x101);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">389</span>:             # sprite data fetching: fetch data from OAM for sprites on the next scanline</pre>
<pre class="cython line score-0">&#xA0;<span class="">390</span>:             # NOTE:  "evaluation applies to the next line's sprite rendering, ... and this is why</pre>
<pre class="cython line score-0">&#xA0;<span class="">391</span>:             # there is a 1 line offset on a sprite's Y coordinate."</pre>
<pre class="cython line score-0">&#xA0;<span class="">392</span>:             # source: https://wiki.nesdev.com/w/index.php/PPU_sprite_evaluation  (note 1)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">393</span>:             self._prefetch_active_sprites()</pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_prefetch_active_sprites(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 393, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">394</span>:             # reset the x counter to the start of the line</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">395</span>:             self._effective_x = self.ppu_scroll[PPU_SCROLL_X] + (bit_high(self.ppu_ctrl, BIT_NAMETABLE_X) &lt;&lt; 8)</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = __pyx_f_3nes_6cycore_7bitwise_bit_high(__pyx_v_self-&gt;ppu_ctrl, __pyx_e_3nes_6cycore_3ppu_BIT_NAMETABLE_X);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 395, __pyx_L1_error)</span>
    __pyx_v_self-&gt;_effective_x = ((__pyx_v_self-&gt;ppu_scroll[__pyx_e_3nes_6cycore_3ppu_PPU_SCROLL_X]) + (__pyx_t_3 &lt;&lt; 8));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">396</span>:         elif self.pixel == 280:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_self-&gt;pixel == 0x118);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">397</span>:             # increment y to next row</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">398</span>:             if (self._effective_y &amp; 0xFF) == 239:  # can only go up to 239 before wrapping to 256</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_self-&gt;_effective_y &amp; 0xFF) == 0xEF);
    if (__pyx_t_1) {
/* … */
      goto __pyx_L8;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">399</span>:                 self._effective_y += 17  # skip over the attribute table to the next nametable (equivalent to 2 rows)</pre>
<pre class='cython code score-0 '>      __pyx_v_self-&gt;_effective_y = (__pyx_v_self-&gt;_effective_y + 17);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">400</span>:             elif (self._effective_y &amp; 0xFF) == 255:  # but if scroll is set into the "illegal zone"</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_self-&gt;_effective_y &amp; 0xFF) == 0xFF);
    if (__pyx_t_1) {
/* … */
      goto __pyx_L8;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">401</span>:                 # if scroll is set into the out-of-bounds zone between lines 240-255, that is okay, which causes the</pre>
<pre class="cython line score-0">&#xA0;<span class="">402</span>:                 # attribute table to be read as tile data; this achieves a sort of negative scroll that some games use</pre>
<pre class="cython line score-0">&#xA0;<span class="">403</span>:                 # especially noticable in the bouncing of the SMB3 logo in the title sequence of SMB3, which will not</pre>
<pre class="cython line score-0">&#xA0;<span class="">404</span>:                 # work properly without this obscure behaviour. See https://wiki.nesdev.com/w/index.php/PPU_scrolling</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">405</span>:                 self._effective_y &amp;= 0x100</pre>
<pre class='cython code score-0 '>      __pyx_v_self-&gt;_effective_y = (__pyx_v_self-&gt;_effective_y &amp; 0x100);
</pre><pre class="cython line score-0">&#xA0;<span class="">406</span>:             else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">407</span>:                 self._effective_y += 1</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_self-&gt;_effective_y = (__pyx_v_self-&gt;_effective_y + 1);
    }
    __pyx_L8:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">408</span>:         elif self.pixel == 328 or self.pixel == 336:   # pixels 321 - 336</pre>
<pre class='cython code score-0 '>  switch (__pyx_v_self-&gt;pixel) {
    case 0x148:
    case 0x150:
    __pyx_t_1 = 1;
    break;
    default:
    __pyx_t_1 = 0;
    break;
  }
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">409</span>:             # fill background data latches with data for first two tiles of next scanline</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">410</span>:             self.fill_bkg_latches()  # get some more data for the upper latches</pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;fill_bkg_latches(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 410, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">411</span>:         else:  # pixels 337 - 340</pre>
<pre class="cython line score-0">&#xA0;<span class="">412</span>:             # todo: garbage nametable fetches (used by MMC5)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">413</span>:             pass</pre>
<pre class='cython code score-0 '>  /*else*/ {
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">414</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">415</span>:         if 257 &lt;= self.pixel &lt;= 324:  # sprite fetching period</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (0x101 &lt;= __pyx_v_self-&gt;pixel);
  if (__pyx_t_1) {
    __pyx_t_1 = (__pyx_v_self-&gt;pixel &lt;= 0x144);
  }
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">416</span>:             # sprite fetch has already happened on pixel 257 (above), but it is possible that, if using double sprites</pre>
<pre class="cython line score-0">&#xA0;<span class="">417</span>:             # irq ticks could be triggered here; the timings of these were precalculated during sprite fetch and put</pre>
<pre class="cython line score-0">&#xA0;<span class="">418</span>:             # into the irq_tick_triggers array, so all we have to do here is test if this pixel has the trigger be true</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">419</span>:             if self.irq_tick_triggers[self.pixel - 257]:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = (__pyx_v_self-&gt;irq_tick_triggers[(__pyx_v_self-&gt;pixel - 0x101)]);
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">420</span>:                 self.vram.cart.irq_tick()</pre>
<pre class='cython code score-0 '>      ((struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart *)__pyx_v_self-&gt;vram-&gt;cart-&gt;__pyx_vtab)-&gt;irq_tick(__pyx_v_self-&gt;vram-&gt;cart);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 420, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">421</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">422</span>:     cdef void increment_pixel(self):</pre>
<pre class='cython code score-0 '>static void __pyx_f_3nes_6cycore_3ppu_6NESPPU_increment_pixel(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self) {
/* … */
  /* function exit code */
}
</pre><pre class="cython line score-0">&#xA0;<span class="">423</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">424</span>:         Increment the current pixel by 1 and, if necessary, move to the next line or even frame.</pre>
<pre class="cython line score-0">&#xA0;<span class="">425</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">426</span>:         self.cycles_since_reset += 1</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;cycles_since_reset = (__pyx_v_self-&gt;cycles_since_reset + 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">427</span>:         self.pixel += 1</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;pixel = (__pyx_v_self-&gt;pixel + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">428</span>:         # need to check if we are in the last *two* pixels because the frame sometimes ends one pixel early</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">429</span>:         if self.pixel &gt;= PIXELS_PER_LINE - 1:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_self-&gt;pixel &gt;= (__pyx_e_3nes_6cycore_3ppu_PIXELS_PER_LINE - 1));
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">430</span>:             if self.line == 261 and self.pixel == PIXELS_PER_LINE - self.frames_since_reset % 2:</pre>
<pre class='cython code score-0 '>    __pyx_t_2 = (__pyx_v_self-&gt;line == 0x105);
    if (__pyx_t_2) {
    } else {
      __pyx_t_1 = __pyx_t_2;
      goto __pyx_L5_bool_binop_done;
    }
    __pyx_t_2 = (__pyx_v_self-&gt;pixel == (__pyx_e_3nes_6cycore_3ppu_PIXELS_PER_LINE - (__pyx_v_self-&gt;frames_since_reset % 2)));
    __pyx_t_1 = __pyx_t_2;
    __pyx_L5_bool_binop_done:;
    if (__pyx_t_1) {
/* … */
      goto __pyx_L4;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">431</span>:                 # frame has ended</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">432</span>:                 self.pixel = 0</pre>
<pre class='cython code score-0 '>      __pyx_v_self-&gt;pixel = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">433</span>:                 self.line = 0</pre>
<pre class='cython code score-0 '>      __pyx_v_self-&gt;line = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">434</span>:                 self.frames_since_reset += 1</pre>
<pre class='cython code score-0 '>      __pyx_v_self-&gt;frames_since_reset = (__pyx_v_self-&gt;frames_since_reset + 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">435</span>:             elif self.pixel == PIXELS_PER_LINE:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = (__pyx_v_self-&gt;pixel == __pyx_e_3nes_6cycore_3ppu_PIXELS_PER_LINE);
    if (__pyx_t_1) {
/* … */
    }
    __pyx_L4:;
</pre><pre class="cython line score-0">&#xA0;<span class="">436</span>:                 # just this line has ended</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">437</span>:                 self.line += 1</pre>
<pre class='cython code score-0 '>      __pyx_v_self-&gt;line = (__pyx_v_self-&gt;line + 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">438</span>:                 self.pixel = 0</pre>
<pre class='cython code score-0 '>      __pyx_v_self-&gt;pixel = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">439</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">440</span>:     cdef void _increment_vram_address(self):</pre>
<pre class='cython code score-2 '>static void __pyx_f_3nes_6cycore_3ppu_6NESPPU__increment_vram_address(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self) {
  int __pyx_v_prev_ppu_addr;
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU._increment_vram_address", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">441</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">442</span>:         Increment vram address after reads/writes by an amount specified by a value in ppu_ctrl</pre>
<pre class="cython line score-0">&#xA0;<span class="">443</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">444</span>:         cdef int prev_ppu_addr = self.ppu_addr</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_self-&gt;ppu_addr;
  __pyx_v_prev_ppu_addr = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">445</span>:         self.ppu_addr += 1 if (self.ppu_ctrl &amp; VRAM_INCREMENT_MASK) == 0 else 32</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = ((__pyx_v_self-&gt;ppu_ctrl &amp; __pyx_e_3nes_6cycore_3ppu_VRAM_INCREMENT_MASK) == 0);
  if (__pyx_t_3) {
    __pyx_t_2 = 1;
  } else {
    __pyx_t_2 = 32;
  }
  __pyx_v_self-&gt;ppu_addr = (__pyx_v_self-&gt;ppu_addr + __pyx_t_2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">446</span>:         if bit_low(prev_ppu_addr, 12) and bit_high(self.ppu_addr, 12):</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = __pyx_f_3nes_6cycore_7bitwise_bit_low(__pyx_v_prev_ppu_addr, 12);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 446, __pyx_L1_error)</span>
  __pyx_t_5 = (__pyx_t_4 != 0);
  if (__pyx_t_5) {
  } else {
    __pyx_t_3 = __pyx_t_5;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_4 = __pyx_f_3nes_6cycore_7bitwise_bit_high(__pyx_v_self-&gt;ppu_addr, 12);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 446, __pyx_L1_error)</span>
  __pyx_t_5 = (__pyx_t_4 != 0);
  __pyx_t_3 = __pyx_t_5;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">447</span>:             # if line A12 changes from low to high, trigger an irq counter tick in the cartridge (MMC3 and derivatives)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">448</span>:             self.vram.cart.irq_tick()</pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart *)__pyx_v_self-&gt;vram-&gt;cart-&gt;__pyx_vtab)-&gt;irq_tick(__pyx_v_self-&gt;vram-&gt;cart);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 448, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">449</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">450</span>:     cdef void _trigger_nmi(self):</pre>
<pre class='cython code score-2 '>static void __pyx_f_3nes_6cycore_3ppu_6NESPPU__trigger_nmi(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self) {
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU._trigger_nmi", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">451</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">452</span>:         Do whatever is necessary to trigger an NMI to the CPU; note that it is up to the caller to check whether NMIs</pre>
<pre class="cython line score-0">&#xA0;<span class="">453</span>:         should be generated by the PPU at this time (a flag in ppu_ctrl), and respecting this is critically important.</pre>
<pre class="cython line score-0">&#xA0;<span class="">454</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">455</span>:         self.interrupt_listener.raise_nmi()</pre>
<pre class='cython code score-0 '>  ((struct __pyx_vtabstruct_3nes_6cycore_6system_InterruptListener *)__pyx_v_self-&gt;interrupt_listener-&gt;__pyx_vtab)-&gt;raise_nmi(__pyx_v_self-&gt;interrupt_listener);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 455, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">456</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">457</span>:     cdef void _reset_effective_y(self):</pre>
<pre class='cython code score-2 '>static void __pyx_f_3nes_6cycore_3ppu_6NESPPU__reset_effective_y(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self) {
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU._reset_effective_y", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">458</span>:         # slightly complicated by the 30 (x 8px) row height of the screen, so if y &gt;= 240, should bump it by 16 to</pre>
<pre class="cython line score-0">&#xA0;<span class="">459</span>:         # account for the fact that the attribute table has been crossed.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">460</span>:         self._effective_y = (self.ppu_scroll[PPU_SCROLL_Y] + (bit_high(self.ppu_ctrl, BIT_NAMETABLE_Y) &lt;&lt; 8)) &amp; 0x1FF</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_f_3nes_6cycore_7bitwise_bit_high(__pyx_v_self-&gt;ppu_ctrl, __pyx_e_3nes_6cycore_3ppu_BIT_NAMETABLE_Y);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 460, __pyx_L1_error)</span>
  __pyx_v_self-&gt;_effective_y = (((__pyx_v_self-&gt;ppu_scroll[__pyx_e_3nes_6cycore_3ppu_PPU_SCROLL_Y]) + (__pyx_t_1 &lt;&lt; 8)) &amp; 0x1FF);
</pre><pre class="cython line score-0">&#xA0;<span class="">461</span>:         # it is actually valid to set the y scroll to between 240 and 256, will cause attriute table to be read as</pre>
<pre class="cython line score-0">&#xA0;<span class="">462</span>:         # nametable data; used in some places to do "negative y-scroll"</pre>
<pre class="cython line score-0">&#xA0;<span class="">463</span>:         #if self.ppu_scroll[PPU_SCROLL_Y] &gt;= 240:</pre>
<pre class="cython line score-0">&#xA0;<span class="">464</span>:         #   self._effective_y += 16</pre>
<pre class="cython line score-0">&#xA0;<span class="">465</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">466</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">467</span>:     ################ Sprite decoding and rendering #####################################################################</pre>
<pre class="cython line score-0">&#xA0;<span class="">468</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">469</span>:     cdef void _prefetch_active_sprites(self):</pre>
<pre class='cython code score-2 '>static void __pyx_f_3nes_6cycore_3ppu_6NESPPU__prefetch_active_sprites(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self) {
  int __pyx_v_n;
  int __pyx_v_addr;
  int __pyx_v_sprite_y;
  int __pyx_v_double_sprites;
  int __pyx_v_sprite_height;
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU._prefetch_active_sprites", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">470</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">471</span>:         Non cycle-correct detector for active sprites on the given line.  Returns a list of the indices of the start</pre>
<pre class="cython line score-0">&#xA0;<span class="">472</span>:         address of the sprite in the OAM</pre>
<pre class="cython line score-0">&#xA0;<span class="">473</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">474</span>:         cdef int n=0, addr=0, sprite_y=0</pre>
<pre class='cython code score-0 '>  __pyx_v_n = 0;
  __pyx_v_addr = 0;
  __pyx_v_sprite_y = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">475</span>:         cdef list sprite_line</pre>
<pre class="cython line score-0">&#xA0;<span class="">476</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">477</span>:         # scan through the sprites, starting at oam_start_addr, seeing if they are visible in the line given</pre>
<pre class="cython line score-0">&#xA0;<span class="">478</span>:         # (note that should be the next line); if so, add them to the list of active sprites, until that gets full.</pre>
<pre class="cython line score-0">&#xA0;<span class="">479</span>:         # if using 8x16 sprites (True), or 8x8 sprite (False)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">480</span>:         cdef bint double_sprites = (self.ppu_ctrl &amp; SPRITE_SIZE_MASK) &gt; 0</pre>
<pre class='cython code score-0 '>  __pyx_v_double_sprites = ((__pyx_v_self-&gt;ppu_ctrl &amp; __pyx_e_3nes_6cycore_3ppu_SPRITE_SIZE_MASK) &gt; 0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">481</span>:         cdef int sprite_height = 16 if double_sprites else 8</pre>
<pre class='cython code score-0 '>  if (__pyx_v_double_sprites) {
    __pyx_t_1 = 16;
  } else {
    __pyx_t_1 = 8;
  }
  __pyx_v_sprite_height = __pyx_t_1;
</pre><pre class="cython line score-0">&#xA0;<span class="">482</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">483</span>:         self._num_active_sprites = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;_num_active_sprites = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">484</span>:         for n in range(64):</pre>
<pre class='cython code score-0 '>  for (__pyx_t_1 = 0; __pyx_t_1 &lt; 64; __pyx_t_1+=1) {
    __pyx_v_n = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">485</span>:             addr = (self.oam_addr + n * 4) &amp; 0xFF  # wrap around the address if need be</pre>
<pre class='cython code score-0 '>    __pyx_v_addr = ((__pyx_v_self-&gt;oam_addr + (__pyx_v_n * 4)) &amp; 0xFF);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">486</span>:             sprite_y = self.oam[addr]</pre>
<pre class='cython code score-0 '>    __pyx_v_sprite_y = (__pyx_v_self-&gt;oam[__pyx_v_addr]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">487</span>:             if sprite_y &lt;= self.line &lt; sprite_y + sprite_height:</pre>
<pre class='cython code score-0 '>    __pyx_t_2 = (__pyx_v_sprite_y &lt;= __pyx_v_self-&gt;line);
    if (__pyx_t_2) {
      __pyx_t_2 = (__pyx_v_self-&gt;line &lt; (__pyx_v_sprite_y + __pyx_v_sprite_height));
    }
    if (__pyx_t_2) {
/* … */
    }
  }
  __pyx_L4_break:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">488</span>:                 if self._num_active_sprites &lt; 8:</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = (__pyx_v_self-&gt;_num_active_sprites &lt; 8);
      if (__pyx_t_2) {
/* … */
        goto __pyx_L6;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">489</span>:                     self._active_sprite_addrs[self._num_active_sprites] = addr</pre>
<pre class='cython code score-0 '>        (__pyx_v_self-&gt;_active_sprite_addrs[__pyx_v_self-&gt;_num_active_sprites]) = __pyx_v_addr;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">490</span>:                     self._sprite_line[self._num_active_sprites] = self.line - sprite_y</pre>
<pre class='cython code score-0 '>        (__pyx_v_self-&gt;_sprite_line[__pyx_v_self-&gt;_num_active_sprites]) = (__pyx_v_self-&gt;line - __pyx_v_sprite_y);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">491</span>:                     self._num_active_sprites += 1</pre>
<pre class='cython code score-0 '>        __pyx_v_self-&gt;_num_active_sprites = (__pyx_v_self-&gt;_num_active_sprites + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">492</span>:                     #sprite_line.append(line - sprite_y)</pre>
<pre class="cython line score-0">&#xA0;<span class="">493</span>:                 else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">494</span>:                     # overflow</pre>
<pre class="cython line score-0">&#xA0;<span class="">495</span>:                     # todo: this implements the *correct* behaviour of sprite overflow, but not the buggy behaviour</pre>
<pre class="cython line score-0">&#xA0;<span class="">496</span>:                     # (and even then it is not cycle correct, so could screw up games that rely on timing of this very exactly)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">497</span>:                     self.sprite_overflow = True</pre>
<pre class='cython code score-0 '>      /*else*/ {
        __pyx_v_self-&gt;sprite_overflow = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">498</span>:                     break</pre>
<pre class='cython code score-0 '>        goto __pyx_L4_break;
      }
      __pyx_L6:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">499</span>:         self._fill_sprite_latches(double_sprites)</pre>
<pre class='cython code score-0 '>  ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_fill_sprite_latches(__pyx_v_self, __pyx_v_double_sprites);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 499, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">500</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">501</span>:     cdef void _fill_sprite_latches(self, int double_sprites):</pre>
<pre class='cython code score-2 '>static void __pyx_f_3nes_6cycore_3ppu_6NESPPU__fill_sprite_latches(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self, int __pyx_v_double_sprites) {
  int __pyx_v_table_base;
  int __pyx_v_prev_table_base;
  int __pyx_v_palette_ix;
  int __pyx_v_attribs;
  int __pyx_v_flip_v;
  int __pyx_v_flip_h;
  int __pyx_v_tile_ix;
  int __pyx_v_line;
  int __pyx_v_tile_base;
  int __pyx_v_x;
  int __pyx_v_c;
  int __pyx_v_palette[4];
  unsigned char __pyx_v_sprite_pattern_lo;
  unsigned char __pyx_v_sprite_pattern_hi;
  int __pyx_v_i;
  int __pyx_v_address;
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU._fill_sprite_latches", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">502</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">503</span>:         Non cycle-correct way to pre-fetch the sprite lines for the next scanline</pre>
<pre class="cython line score-0">&#xA0;<span class="">504</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">505</span>:         cdef int table_base=0, prev_table_base=0, palette_ix=0, attribs=0, flip_v=0, flip_h=0, tile_ix=0, line=0, tile_base=0, x=0, c=0</pre>
<pre class='cython code score-0 '>  __pyx_v_table_base = 0;
  __pyx_v_prev_table_base = 0;
  __pyx_v_palette_ix = 0;
  __pyx_v_attribs = 0;
  __pyx_v_flip_v = 0;
  __pyx_v_flip_h = 0;
  __pyx_v_tile_ix = 0;
  __pyx_v_line = 0;
  __pyx_v_tile_base = 0;
  __pyx_v_x = 0;
  __pyx_v_c = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">506</span>:         cdef int palette[4]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">507</span>:         cdef unsigned char sprite_pattern_lo=0, sprite_pattern_hi=0</pre>
<pre class='cython code score-0 '>  __pyx_v_sprite_pattern_lo = 0;
  __pyx_v_sprite_pattern_hi = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">508</span>:         cdef int i=0, address=0</pre>
<pre class='cython code score-0 '>  __pyx_v_i = 0;
  __pyx_v_address = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">509</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">510</span>:         # previously the ppu was fetching background tiles, so address line A12 was set by the bkg table base; this is</pre>
<pre class="cython line score-0">&#xA0;<span class="">511</span>:         # used for triggering irq ticks for MMC3 type cartridges.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">512</span>:         table_base = ((self.ppu_ctrl &amp; BKG_PATTERN_TABLE_MASK) &gt; 0) * 0x1000</pre>
<pre class='cython code score-0 '>  __pyx_v_table_base = (((__pyx_v_self-&gt;ppu_ctrl &amp; __pyx_e_3nes_6cycore_3ppu_BKG_PATTERN_TABLE_MASK) &gt; 0) * 0x1000);
</pre><pre class="cython line score-0">&#xA0;<span class="">513</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">514</span>:         # the IRQ tick triggers for MMC3 are handled on the scanline renderers themselves, but they are related to</pre>
<pre class="cython line score-0">&#xA0;<span class="">515</span>:         # the rendering of sprites and associated pattern table switching, so they are calculated here</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">516</span>:         self.irq_tick_triggers[:] = [False] * 68</pre>
<pre class='cython code score-0 '>  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp = 0; __pyx_temp &lt; 68; __pyx_temp++) {
      __pyx_t_1[0+ (1 * __pyx_temp)] = 0;
    }
  }
  memcpy(&amp;(__pyx_v_self-&gt;irq_tick_triggers[0]), __pyx_t_1, sizeof(__pyx_v_self-&gt;irq_tick_triggers[0]) * (68));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">517</span>:         if not double_sprites:</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = (!(__pyx_v_double_sprites != 0));
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">518</span>:             if table_base == 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_2 = (__pyx_v_table_base == 0);
    if (__pyx_t_2) {
/* … */
      goto __pyx_L4;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">519</span>:                 self.irq_tick_triggers[67] = True   # trigger once at pixel 324</pre>
<pre class='cython code score-0 '>      (__pyx_v_self-&gt;irq_tick_triggers[67]) = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">520</span>:             else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">521</span>:                 self.irq_tick_triggers[3] = True    # trigger once at pixel 260</pre>
<pre class='cython code score-0 '>    /*else*/ {
      (__pyx_v_self-&gt;irq_tick_triggers[3]) = 1;
    }
    __pyx_L4:;
</pre><pre class="cython line score-0">&#xA0;<span class="">522</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">523</span>:         for i in range(self._num_active_sprites):</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = __pyx_v_self-&gt;_num_active_sprites;
  __pyx_t_4 = __pyx_t_3;
  for (__pyx_t_5 = 0; __pyx_t_5 &lt; __pyx_t_4; __pyx_t_5+=1) {
    __pyx_v_i = __pyx_t_5;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">524</span>:             address = self._active_sprite_addrs[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_address = (__pyx_v_self-&gt;_active_sprite_addrs[__pyx_v_i]);
</pre><pre class="cython line score-0">&#xA0;<span class="">525</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">526</span>:             attribs = self.oam[(address + 2) &amp; 0xFF]</pre>
<pre class='cython code score-0 '>    __pyx_v_attribs = (__pyx_v_self-&gt;oam[((__pyx_v_address + 2) &amp; 0xFF)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">527</span>:             palette_ix = attribs &amp; 0b00000011</pre>
<pre class='cython code score-0 '>    __pyx_v_palette_ix = (__pyx_v_attribs &amp; 3);
</pre><pre class="cython line score-0">&#xA0;<span class="">528</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">529</span>:             self.decode_palette(palette, palette_ix, is_sprite=True)</pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;decode_palette(__pyx_v_self, __pyx_v_palette, __pyx_v_palette_ix, 1);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 529, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">530</span>:             flip_v = bit_high(attribs, bit=7)</pre>
<pre class='cython code score-0 '>    __pyx_t_6 = __pyx_f_3nes_6cycore_7bitwise_bit_high(__pyx_v_attribs, 7);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 530, __pyx_L1_error)</span>
    __pyx_v_flip_v = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">531</span>:             flip_h = bit_high(attribs, bit=6)</pre>
<pre class='cython code score-0 '>    __pyx_t_6 = __pyx_f_3nes_6cycore_7bitwise_bit_high(__pyx_v_attribs, 6);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 531, __pyx_L1_error)</span>
    __pyx_v_flip_h = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">532</span>:             self._sprite_bkg_priority[i] = bit_high(attribs, bit=5)</pre>
<pre class='cython code score-0 '>    __pyx_t_6 = __pyx_f_3nes_6cycore_7bitwise_bit_high(__pyx_v_attribs, 5);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 532, __pyx_L1_error)</span>
    (__pyx_v_self-&gt;_sprite_bkg_priority[__pyx_v_i]) = __pyx_t_6;
</pre><pre class="cython line score-0">&#xA0;<span class="">533</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">534</span>:             if not double_sprites:</pre>
<pre class='cython code score-0 '>    __pyx_t_2 = (!(__pyx_v_double_sprites != 0));
    if (__pyx_t_2) {
/* … */
      goto __pyx_L7;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">535</span>:                 # sprite table select bit is only used in single-height (8x8) mode</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">536</span>:                 table_base = ((self.ppu_ctrl &amp; SPRITE_PATTERN_TABLE_MASK) &gt; 0) * 0x1000</pre>
<pre class='cython code score-0 '>      __pyx_v_table_base = (((__pyx_v_self-&gt;ppu_ctrl &amp; __pyx_e_3nes_6cycore_3ppu_SPRITE_PATTERN_TABLE_MASK) &gt; 0) * 0x1000);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">537</span>:                 tile_ix = self.oam[(address + 1) &amp; 0xFF]</pre>
<pre class='cython code score-0 '>      __pyx_v_tile_ix = (__pyx_v_self-&gt;oam[((__pyx_v_address + 1) &amp; 0xFF)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">538</span>:                 line = self._sprite_line[i] if not flip_v else 7 - self._sprite_line[i]</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = (!(__pyx_v_flip_v != 0));
      if (__pyx_t_2) {
        __pyx_t_7 = (__pyx_v_self-&gt;_sprite_line[__pyx_v_i]);
      } else {
        __pyx_t_7 = (7 - (__pyx_v_self-&gt;_sprite_line[__pyx_v_i]));
      }
      __pyx_v_line = __pyx_t_7;
</pre><pre class="cython line score-0">&#xA0;<span class="">539</span>:             else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">540</span>:                 line = self._sprite_line[i] if not flip_v else 15 - self._sprite_line[i]</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_t_2 = (!(__pyx_v_flip_v != 0));
      if (__pyx_t_2) {
        __pyx_t_7 = (__pyx_v_self-&gt;_sprite_line[__pyx_v_i]);
      } else {
        __pyx_t_7 = (15 - (__pyx_v_self-&gt;_sprite_line[__pyx_v_i]));
      }
      __pyx_v_line = __pyx_t_7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">541</span>:                 tile_ix = self.oam[(address + 1) &amp; 0xFF] &amp; 0b11111110</pre>
<pre class='cython code score-0 '>      __pyx_v_tile_ix = ((__pyx_v_self-&gt;oam[((__pyx_v_address + 1) &amp; 0xFF)]) &amp; 254);
</pre><pre class="cython line score-0">&#xA0;<span class="">542</span>:                 # in double-height mode, sprite table is set by bottom bit of 2nd byte in OAM</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">543</span>:                 prev_table_base = table_base</pre>
<pre class='cython code score-0 '>      __pyx_v_prev_table_base = __pyx_v_table_base;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">544</span>:                 table_base = (self.oam[(address + 1) &amp; 0xFF] &amp; 1) * 0x1000</pre>
<pre class='cython code score-0 '>      __pyx_v_table_base = (((__pyx_v_self-&gt;oam[((__pyx_v_address + 1) &amp; 0xFF)]) &amp; 1) * 0x1000);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">545</span>:                 if prev_table_base==0 and table_base &gt; 0:</pre>
<pre class='cython code score-0 '>      __pyx_t_8 = (__pyx_v_prev_table_base == 0);
      if (__pyx_t_8) {
      } else {
        __pyx_t_2 = __pyx_t_8;
        goto __pyx_L9_bool_binop_done;
      }
      __pyx_t_8 = (__pyx_v_table_base &gt; 0);
      __pyx_t_2 = __pyx_t_8;
      __pyx_L9_bool_binop_done:;
      if (__pyx_t_2) {
/* … */
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">546</span>:                     # rising edge on the table selecting address line triggers the irq_counter</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">547</span>:                     self.irq_tick_triggers[i * 8] = True</pre>
<pre class='cython code score-0 '>        (__pyx_v_self-&gt;irq_tick_triggers[(__pyx_v_i * 8)]) = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">548</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">549</span>:                 if line &gt;= 8:</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = (__pyx_v_line &gt;= 8);
      if (__pyx_t_2) {
/* … */
      }
    }
    __pyx_L7:;
</pre><pre class="cython line score-0">&#xA0;<span class="">550</span>:                     # in the lower tile</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">551</span>:                     tile_ix += 1</pre>
<pre class='cython code score-0 '>        __pyx_v_tile_ix = (__pyx_v_tile_ix + 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">552</span>:                     line -= 8</pre>
<pre class='cython code score-0 '>        __pyx_v_line = (__pyx_v_line - 8);
</pre><pre class="cython line score-0">&#xA0;<span class="">553</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">554</span>:             tile_base = table_base + tile_ix * PATTERN_SIZE_BYTES</pre>
<pre class='cython code score-0 '>    __pyx_v_tile_base = (__pyx_v_table_base + (__pyx_v_tile_ix * __pyx_e_3nes_6cycore_3ppu_PATTERN_SIZE_BYTES));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">555</span>:             sprite_pattern_lo = self.vram.read(tile_base + line)</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((struct __pyx_vtabstruct_3nes_6cycore_6memory_NESVRAM *)__pyx_v_self-&gt;vram-&gt;__pyx_base.__pyx_vtab)-&gt;__pyx_base.read(((struct __pyx_obj_3nes_6cycore_6memory_MemoryBase *)__pyx_v_self-&gt;vram), (__pyx_v_tile_base + __pyx_v_line));<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 555, __pyx_L1_error)</span>
    __pyx_v_sprite_pattern_lo = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">556</span>:             sprite_pattern_hi = self.vram.read(tile_base + 8 + line)</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((struct __pyx_vtabstruct_3nes_6cycore_6memory_NESVRAM *)__pyx_v_self-&gt;vram-&gt;__pyx_base.__pyx_vtab)-&gt;__pyx_base.read(((struct __pyx_obj_3nes_6cycore_6memory_MemoryBase *)__pyx_v_self-&gt;vram), ((__pyx_v_tile_base + 8) + __pyx_v_line));<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 556, __pyx_L1_error)</span>
    __pyx_v_sprite_pattern_hi = __pyx_t_9;
</pre><pre class="cython line score-0">&#xA0;<span class="">557</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">558</span>:             for x in range(8):</pre>
<pre class='cython code score-0 '>    for (__pyx_t_6 = 0; __pyx_t_6 &lt; 8; __pyx_t_6+=1) {
      __pyx_v_x = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">559</span>:                 c = bit_high(sprite_pattern_hi, x) * 2 + bit_high(sprite_pattern_lo, x)</pre>
<pre class='cython code score-0 '>      __pyx_t_10 = __pyx_f_3nes_6cycore_7bitwise_bit_high(__pyx_v_sprite_pattern_hi, __pyx_v_x);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 559, __pyx_L1_error)</span>
      __pyx_t_11 = __pyx_f_3nes_6cycore_7bitwise_bit_high(__pyx_v_sprite_pattern_lo, __pyx_v_x);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 559, __pyx_L1_error)</span>
      __pyx_v_c = ((__pyx_t_10 * 2) + __pyx_t_11);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">560</span>:                 self._sprite_pattern[i][x if flip_h else 7 - x] = palette[c] if c else self.transparent_color</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = (__pyx_v_c != 0);
      if (__pyx_t_2) {
        __pyx_t_11 = (__pyx_v_palette[__pyx_v_c]);
      } else {
        __pyx_t_11 = __pyx_v_self-&gt;transparent_color;
      }
      __pyx_t_2 = (__pyx_v_flip_h != 0);
      if (__pyx_t_2) {
        __pyx_t_7 = __pyx_v_x;
      } else {
        __pyx_t_7 = (7 - __pyx_v_x);
      }
      ((__pyx_v_self-&gt;_sprite_pattern[__pyx_v_i])[__pyx_t_7]) = __pyx_t_11;
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">561</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">562</span>:         if double_sprites and self._num_active_sprites &lt; 8:</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = (__pyx_v_double_sprites != 0);
  if (__pyx_t_8) {
  } else {
    __pyx_t_2 = __pyx_t_8;
    goto __pyx_L15_bool_binop_done;
  }
  __pyx_t_8 = (__pyx_v_self-&gt;_num_active_sprites &lt; 8);
  __pyx_t_2 = __pyx_t_8;
  __pyx_L15_bool_binop_done:;
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">563</span>:             # at this point, the PPU does some reads from table 1 that are discarded, but that means that if the table</pre>
<pre class="cython line score-0">&#xA0;<span class="">564</span>:             # base was zero, it will then go high, triggering an irq tick</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">565</span>:             if table_base == 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_2 = (__pyx_v_table_base == 0);
    if (__pyx_t_2) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">566</span>:                 self.irq_tick_triggers[self._num_active_sprites * 8] = True</pre>
<pre class='cython code score-0 '>      (__pyx_v_self-&gt;irq_tick_triggers[(__pyx_v_self-&gt;_num_active_sprites * 8)]) = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">567</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">568</span>:     cdef int _overlay_sprites(self, int bkg_pixel):</pre>
<pre class='cython code score-2 '>static int __pyx_f_3nes_6cycore_3ppu_6NESPPU__overlay_sprites(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self, int __pyx_v_bkg_pixel) {
  int __pyx_v_sprite_c_out;
  int __pyx_v_c;
  int __pyx_v_top_sprite;
  int __pyx_v_sprite_addr;
  int __pyx_v_sprite_x;
  int __pyx_v_pix;
  int __pyx_v_s0_visible;
  int __pyx_v_c_out;
  long __pyx_v_i;
  int __pyx_r;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU._overlay_sprites", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">569</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">570</span>:         Cycle-correct (ish) sprite rendering for the pixel at y=line, pixel=pixel.  Includes sprite 0 collision detection.</pre>
<pre class="cython line score-0">&#xA0;<span class="">571</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">572</span>:         cdef int sprite_c_out=0, c=0, top_sprite=0, sprite_addr=0, sprite_x=0, pix=0</pre>
<pre class='cython code score-0 '>  __pyx_v_sprite_c_out = 0;
  __pyx_v_c = 0;
  __pyx_v_top_sprite = 0;
  __pyx_v_sprite_addr = 0;
  __pyx_v_sprite_x = 0;
  __pyx_v_pix = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">573</span>:         cdef bint s0_visible=False</pre>
<pre class='cython code score-0 '>  __pyx_v_s0_visible = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">574</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">575</span>:         c_out = bkg_pixel</pre>
<pre class='cython code score-0 '>  __pyx_v_c_out = __pyx_v_bkg_pixel;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">576</span>:         if (self.ppu_mask &amp; RENDER_SPRITES_MASK) == 0 \</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_self-&gt;ppu_mask &amp; __pyx_e_3nes_6cycore_3ppu_RENDER_SPRITES_MASK) == 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
/* … */
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">577</span>:             or (self.pixel - 1 &lt; 8 and bit_low(self.ppu_mask, RENDER_LEFT8_SPRITES_BIT)):</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_self-&gt;pixel - 1) &lt; 8);
  if (__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_3 = __pyx_f_3nes_6cycore_7bitwise_bit_low(__pyx_v_self-&gt;ppu_mask, __pyx_e_3nes_6cycore_3ppu_RENDER_LEFT8_SPRITES_BIT);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 577, __pyx_L1_error)</span>
  __pyx_t_2 = (__pyx_t_3 != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L4_bool_binop_done:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">578</span>:             return c_out</pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_v_c_out;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">579</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">580</span>:         sprite_c_out = self.transparent_color</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = __pyx_v_self-&gt;transparent_color;
  __pyx_v_sprite_c_out = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">581</span>:         top_sprite = -1</pre>
<pre class='cython code score-0 '>  __pyx_v_top_sprite = -1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">582</span>:         for i in range(self._num_active_sprites - 1, -1, -1):  # iterate from backmost to frontmost sprite #reversed(range(self._num_active_sprites)):</pre>
<pre class='cython code score-0 '>  for (__pyx_t_4 = (__pyx_v_self-&gt;_num_active_sprites - 1); __pyx_t_4 &gt; -1L; __pyx_t_4-=1) {
    __pyx_v_i = __pyx_t_4;
</pre><pre class="cython line score-0">&#xA0;<span class="">583</span>:             # render in reverse to make overwriting easier</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">584</span>:             sprite_addr = self._active_sprite_addrs[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_sprite_addr = (__pyx_v_self-&gt;_active_sprite_addrs[__pyx_v_i]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">585</span>:             sprite_x = self.oam[sprite_addr + 3]</pre>
<pre class='cython code score-0 '>    __pyx_v_sprite_x = (__pyx_v_self-&gt;oam[(__pyx_v_sprite_addr + 3)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">586</span>:             if sprite_x &lt;= self.pixel - 1 &lt; sprite_x + 8:</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = (__pyx_v_self-&gt;pixel - 1);
    __pyx_t_1 = (__pyx_v_sprite_x &lt;= __pyx_t_5);
    if (__pyx_t_1) {
      __pyx_t_1 = (__pyx_t_5 &lt; (__pyx_v_sprite_x + 8));
    }
    if (__pyx_t_1) {
/* … */
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">587</span>:                 pix = self.pixel - 1 - sprite_x</pre>
<pre class='cython code score-0 '>      __pyx_v_pix = ((__pyx_v_self-&gt;pixel - 1) - __pyx_v_sprite_x);
</pre><pre class="cython line score-0">&#xA0;<span class="">588</span>:                 # this sprite is visible now</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">589</span>:                 c = self._sprite_pattern[i][pix]</pre>
<pre class='cython code score-0 '>      __pyx_v_c = ((__pyx_v_self-&gt;_sprite_pattern[__pyx_v_i])[__pyx_v_pix]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">590</span>:                 if c != self.transparent_color:</pre>
<pre class='cython code score-0 '>      __pyx_t_1 = (__pyx_v_c != __pyx_v_self-&gt;transparent_color);
      if (__pyx_t_1) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">591</span>:                     top_sprite = i</pre>
<pre class='cython code score-0 '>        __pyx_v_top_sprite = __pyx_v_i;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">592</span>:                     sprite_c_out = c</pre>
<pre class='cython code score-0 '>        __pyx_v_sprite_c_out = __pyx_v_c;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">593</span>:                     if sprite_addr == 0:</pre>
<pre class='cython code score-0 '>        __pyx_t_1 = (__pyx_v_sprite_addr == 0);
        if (__pyx_t_1) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">594</span>:                         s0_visible = True</pre>
<pre class='cython code score-0 '>          __pyx_v_s0_visible = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">595</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">596</span>:         # sprite zero collision detection</pre>
<pre class="cython line score-0">&#xA0;<span class="">597</span>:         # Details: https://wiki.nesdev.com/w/index.php/PPU_OAM#Sprite_zero_hits</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">598</span>:         if not self.sprite_zero_hit and s0_visible and bkg_pixel != self.transparent_color:</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = (!__pyx_v_self-&gt;sprite_zero_hit);
  if (__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L13_bool_binop_done;
  }
  if (__pyx_v_s0_visible) {
  } else {
    __pyx_t_1 = __pyx_v_s0_visible;
    goto __pyx_L13_bool_binop_done;
  }
  __pyx_t_2 = (__pyx_v_bkg_pixel != __pyx_v_self-&gt;transparent_color);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L13_bool_binop_done:;
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">599</span>:             # todo: there are some more fine details here</pre>
<pre class="cython line score-0">&#xA0;<span class="">600</span>:             #print("s0 hit ", self.line, self.pixel)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">601</span>:             self.sprite_zero_hit = True</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;sprite_zero_hit = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">602</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">603</span>:         # now decide whether to keep sprite or bkg pixel</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">604</span>:         if sprite_c_out != self.transparent_color and (not self._sprite_bkg_priority[top_sprite] or bkg_pixel == self.transparent_color):</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = (__pyx_v_sprite_c_out != __pyx_v_self-&gt;transparent_color);
  if (__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L17_bool_binop_done;
  }
  __pyx_t_2 = (!((__pyx_v_self-&gt;_sprite_bkg_priority[__pyx_v_top_sprite]) != 0));
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L17_bool_binop_done;
  }
  __pyx_t_2 = (__pyx_v_bkg_pixel == __pyx_v_self-&gt;transparent_color);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L17_bool_binop_done:;
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">605</span>:             c_out = sprite_c_out</pre>
<pre class='cython code score-0 '>    __pyx_v_c_out = __pyx_v_sprite_c_out;
</pre><pre class="cython line score-0">&#xA0;<span class="">606</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">607</span>:         return c_out #if c_out != self.transparent_color else self.bkg_color  # background color</pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_c_out;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">608</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">609</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">610</span>:     ################ Background rendering ##############################################################################</pre>
<pre class="cython line score-0">&#xA0;<span class="">611</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">612</span>:     cdef void fill_bkg_latches(self):</pre>
<pre class='cython code score-2 '>static void __pyx_f_3nes_6cycore_3ppu_6NESPPU_fill_bkg_latches(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self) {
  int __pyx_v_ntbl_base;
  int __pyx_v_tile_addr;
  int __pyx_v_tile_line;
  int __pyx_v_tile_index;
  int __pyx_v_tile_bank;
  int __pyx_v_tile_base;
  int __pyx_v_i;
  int __pyx_v_shift;
  int __pyx_v_palette_id;
  int __pyx_v_table_base;
  int __pyx_v_attr_addr;
  unsigned char __pyx_v_attribute_byte;
  unsigned char __pyx_v_mask;
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.fill_bkg_latches", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">613</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">614</span>:         Fill the ppu's rendering latches with the next tile to be rendered.  Relies on the correct values in</pre>
<pre class="cython line score-0">&#xA0;<span class="">615</span>:         the internal _effective_x and _effective_y variables.</pre>
<pre class="cython line score-0">&#xA0;<span class="">616</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">617</span>:         cdef int ntbl_base=0, tile_addr=0, tile_line=0, tile_index=0, tile_bank=0, tile_base=0</pre>
<pre class='cython code score-0 '>  __pyx_v_ntbl_base = 0;
  __pyx_v_tile_addr = 0;
  __pyx_v_tile_line = 0;
  __pyx_v_tile_index = 0;
  __pyx_v_tile_bank = 0;
  __pyx_v_tile_base = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">618</span>:         cdef int i=0, shift=0, palette_id=0, table_base=0, attr_addr=0</pre>
<pre class='cython code score-0 '>  __pyx_v_i = 0;
  __pyx_v_shift = 0;
  __pyx_v_palette_id = 0;
  __pyx_v_table_base = 0;
  __pyx_v_attr_addr = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">619</span>:         cdef unsigned char attribute_byte=0, mask=0</pre>
<pre class='cython code score-0 '>  __pyx_v_attribute_byte = 0;
  __pyx_v_mask = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">620</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">621</span>:         # which nametable are we currently on?</pre>
<pre class="cython line score-0">&#xA0;<span class="">622</span>:         ntbl_base = (NAMETABLE_START                                  # nametable start</pre>
<pre class="cython line score-0">&#xA0;<span class="">623</span>:                      + (((self._effective_y &gt;&gt; 8) &amp; 1) &lt;&lt; 11)         # y nametable bit</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">624</span>:                      + (((self._effective_x &gt;&gt; 8) &amp; 1) &lt;&lt; 10)         # x nametable bit</pre>
<pre class='cython code score-0 '>  __pyx_v_ntbl_base = ((__pyx_e_3nes_6cycore_6memory_NAMETABLE_START + (((__pyx_v_self-&gt;_effective_y &gt;&gt; 8) &amp; 1) &lt;&lt; 11)) + (((__pyx_v_self-&gt;_effective_x &gt;&gt; 8) &amp; 1) &lt;&lt; 10));
</pre><pre class="cython line score-0">&#xA0;<span class="">625</span>:                      )</pre>
<pre class="cython line score-0">&#xA0;<span class="">626</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">627</span>:         ##### Tile reading</pre>
<pre class="cython line score-0">&#xA0;<span class="">628</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">629</span>:         tile_addr = (ntbl_base</pre>
<pre class="cython line score-0">&#xA0;<span class="">630</span>:                      + (((self._effective_y &gt;&gt; 3) &amp; 0b11111) &lt;&lt; 5)    # coarse y   { &amp; 0b11111 necessary because of</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">631</span>:                      + ((self._effective_x &gt;&gt; 3) &amp; 0b11111)           # coarse x   { nametable carry in effective x/y</pre>
<pre class='cython code score-0 '>  __pyx_v_tile_addr = ((__pyx_v_ntbl_base + (((__pyx_v_self-&gt;_effective_y &gt;&gt; 3) &amp; 31) &lt;&lt; 5)) + ((__pyx_v_self-&gt;_effective_x &gt;&gt; 3) &amp; 31));
</pre><pre class="cython line score-0">&#xA0;<span class="">632</span>:                      )</pre>
<pre class="cython line score-0">&#xA0;<span class="">633</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">634</span>:         tile_line = self._effective_y &amp; 0b111                         # offset within the tile</pre>
<pre class='cython code score-0 '>  __pyx_v_tile_line = (__pyx_v_self-&gt;_effective_y &amp; 7);
</pre><pre class="cython line score-0">&#xA0;<span class="">635</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">636</span>:         # read the tile id from the nametable</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">637</span>:         tile_index = self.vram.read(tile_addr)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((struct __pyx_vtabstruct_3nes_6cycore_6memory_NESVRAM *)__pyx_v_self-&gt;vram-&gt;__pyx_base.__pyx_vtab)-&gt;__pyx_base.read(((struct __pyx_obj_3nes_6cycore_6memory_MemoryBase *)__pyx_v_self-&gt;vram), __pyx_v_tile_addr);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 637, __pyx_L1_error)</span>
  __pyx_v_tile_index = __pyx_t_1;
</pre><pre class="cython line score-0">&#xA0;<span class="">638</span>:         # now figure out where the data for that tile is located in the memory</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">639</span>:         tile_bank = (self.ppu_ctrl &amp; BKG_PATTERN_TABLE_MASK) &gt; 0</pre>
<pre class='cython code score-0 '>  __pyx_v_tile_bank = ((__pyx_v_self-&gt;ppu_ctrl &amp; __pyx_e_3nes_6cycore_3ppu_BKG_PATTERN_TABLE_MASK) &gt; 0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">640</span>:         table_base = tile_bank * 0x1000</pre>
<pre class='cython code score-0 '>  __pyx_v_table_base = (__pyx_v_tile_bank * 0x1000);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">641</span>:         tile_base = table_base + tile_index * PATTERN_SIZE_BYTES</pre>
<pre class='cython code score-0 '>  __pyx_v_tile_base = (__pyx_v_table_base + (__pyx_v_tile_index * __pyx_e_3nes_6cycore_3ppu_PATTERN_SIZE_BYTES));
</pre><pre class="cython line score-0">&#xA0;<span class="">642</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">643</span>:         # shift up the lower bits of the background latches ready to be refilled</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">644</span>:         self._pattern_hi &lt;&lt;= 8</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;_pattern_hi = (__pyx_v_self-&gt;_pattern_hi &lt;&lt; 8);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">645</span>:         self._pattern_lo &lt;&lt;= 8</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;_pattern_lo = (__pyx_v_self-&gt;_pattern_lo &lt;&lt; 8);
</pre><pre class="cython line score-0">&#xA0;<span class="">646</span>:         # then read the new lower pattern byte</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">647</span>:         self._pattern_lo = (self._pattern_lo &amp; 0xFF00) + self.vram.read(tile_base + tile_line)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((struct __pyx_vtabstruct_3nes_6cycore_6memory_NESVRAM *)__pyx_v_self-&gt;vram-&gt;__pyx_base.__pyx_vtab)-&gt;__pyx_base.read(((struct __pyx_obj_3nes_6cycore_6memory_MemoryBase *)__pyx_v_self-&gt;vram), (__pyx_v_tile_base + __pyx_v_tile_line));<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 647, __pyx_L1_error)</span>
  __pyx_v_self-&gt;_pattern_lo = ((__pyx_v_self-&gt;_pattern_lo &amp; 0xFF00) + __pyx_t_1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">648</span>:         self._pattern_hi = (self._pattern_hi &amp; 0xFF00) + self.vram.read(tile_base + tile_line + 8)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((struct __pyx_vtabstruct_3nes_6cycore_6memory_NESVRAM *)__pyx_v_self-&gt;vram-&gt;__pyx_base.__pyx_vtab)-&gt;__pyx_base.read(((struct __pyx_obj_3nes_6cycore_6memory_MemoryBase *)__pyx_v_self-&gt;vram), ((__pyx_v_tile_base + __pyx_v_tile_line) + 8));<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 648, __pyx_L1_error)</span>
  __pyx_v_self-&gt;_pattern_hi = ((__pyx_v_self-&gt;_pattern_hi &amp; 0xFF00) + __pyx_t_1);
</pre><pre class="cython line score-0">&#xA0;<span class="">649</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">650</span>:         ##### Attribute (palette) for this block</pre>
<pre class="cython line score-0">&#xA0;<span class="">651</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">652</span>:         attr_addr = (ntbl_base</pre>
<pre class="cython line score-0">&#xA0;<span class="">653</span>:                      + ATTRIBUTE_TABLE_OFFSET                         # go to the attribute table</pre>
<pre class="cython line score-0">&#xA0;<span class="">654</span>:                      + (((self._effective_y &gt;&gt; 5) &amp; 0b111) &lt;&lt; 3)      # top 3 bits of coarse y  (== coarse y / 4)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">655</span>:                      + ((self._effective_x &gt;&gt; 5) &amp; 0b111)             # top 3 bits of coarse x  (== coarse x / 4)</pre>
<pre class='cython code score-0 '>  __pyx_v_attr_addr = (((__pyx_v_ntbl_base + __pyx_e_3nes_6cycore_6memory_ATTRIBUTE_TABLE_OFFSET) + (((__pyx_v_self-&gt;_effective_y &gt;&gt; 5) &amp; 7) &lt;&lt; 3)) + ((__pyx_v_self-&gt;_effective_x &gt;&gt; 5) &amp; 7));
</pre><pre class="cython line score-0">&#xA0;<span class="">656</span>:                      )</pre>
<pre class="cython line score-0">&#xA0;<span class="">657</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">658</span>:         attribute_byte = self.vram.read(attr_addr)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((struct __pyx_vtabstruct_3nes_6cycore_6memory_NESVRAM *)__pyx_v_self-&gt;vram-&gt;__pyx_base.__pyx_vtab)-&gt;__pyx_base.read(((struct __pyx_obj_3nes_6cycore_6memory_MemoryBase *)__pyx_v_self-&gt;vram), __pyx_v_attr_addr);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 658, __pyx_L1_error)</span>
  __pyx_v_attribute_byte = __pyx_t_1;
</pre><pre class="cython line score-0">&#xA0;<span class="">659</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">660</span>:         shift = (((self._effective_y &gt;&gt; 4) &amp; 1) * 4                   # 4th bit of effective_y gives 2-tile block</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">661</span>:                  + ((self._effective_x &gt;&gt; 4) &amp; 1) * 2)                # 4th bit of effective_x gives 2-tile block</pre>
<pre class='cython code score-0 '>  __pyx_v_shift = ((((__pyx_v_self-&gt;_effective_y &gt;&gt; 4) &amp; 1) * 4) + (((__pyx_v_self-&gt;_effective_x &gt;&gt; 4) &amp; 1) * 2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">662</span>:         mask = 0b00000011 &lt;&lt; shift</pre>
<pre class='cython code score-0 '>  __pyx_v_mask = (3 &lt;&lt; __pyx_v_shift);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">663</span>:         palette_id = (attribute_byte &amp; mask) &gt;&gt; shift</pre>
<pre class='cython code score-0 '>  __pyx_v_palette_id = ((__pyx_v_attribute_byte &amp; __pyx_v_mask) &gt;&gt; __pyx_v_shift);
</pre><pre class="cython line score-0">&#xA0;<span class="">664</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">665</span>:         for i in range(4):</pre>
<pre class='cython code score-0 '>  for (__pyx_t_2 = 0; __pyx_t_2 &lt; 4; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">666</span>:             self._palette[0][i] = self._palette[1][i]</pre>
<pre class='cython code score-0 '>    ((__pyx_v_self-&gt;_palette[0])[__pyx_v_i]) = ((__pyx_v_self-&gt;_palette[1])[__pyx_v_i]);
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">667</span>:         self.decode_palette(self._palette[1], palette_id, False)</pre>
<pre class='cython code score-0 '>  ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;decode_palette(__pyx_v_self, (__pyx_v_self-&gt;_palette[1]), __pyx_v_palette_id, 0);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 667, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">668</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">669</span>:         # after a read, increment the effective x so that we can read the next tile along next time</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">670</span>:         self._effective_x += 8</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;_effective_x = (__pyx_v_self-&gt;_effective_x + 8);
</pre><pre class="cython line score-0">&#xA0;<span class="">671</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">672</span>:     cdef int _get_bkg_pixel(self):</pre>
<pre class='cython code score-2 '>static int __pyx_f_3nes_6cycore_3ppu_6NESPPU__get_bkg_pixel(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self) {
  int __pyx_v_fine_x;
  int __pyx_v_px;
  int __pyx_v_v;
  int __pyx_v_mask;
  int __pyx_r;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU._get_bkg_pixel", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">673</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">674</span>:         Determine the current background pixel to draw based on the current internal state of the PPU</pre>
<pre class="cython line score-0">&#xA0;<span class="">675</span>:         :return:</pre>
<pre class="cython line score-0">&#xA0;<span class="">676</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">677</span>:         cdef int fine_x=0, px=0, v=0, mask=0</pre>
<pre class='cython code score-0 '>  __pyx_v_fine_x = 0;
  __pyx_v_px = 0;
  __pyx_v_v = 0;
  __pyx_v_mask = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">678</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">679</span>:         if (   self.ppu_mask &amp; RENDER_BACKGROUND_MASK) == 0 \</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_self-&gt;ppu_mask &amp; __pyx_e_3nes_6cycore_3ppu_RENDER_BACKGROUND_MASK) == 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
/* … */
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">680</span>:             or (self.pixel - 1 &lt; 8 and bit_low(self.ppu_mask, RENDER_LEFT8_BKG_BIT)):</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_self-&gt;pixel - 1) &lt; 8);
  if (__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_3 = __pyx_f_3nes_6cycore_7bitwise_bit_low(__pyx_v_self-&gt;ppu_mask, __pyx_e_3nes_6cycore_3ppu_RENDER_LEFT8_BKG_BIT);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 680, __pyx_L1_error)</span>
  __pyx_t_2 = (__pyx_t_3 != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L4_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">681</span>:             # in this case, background rendering is off for this pixel, so just return</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">682</span>:             return self.transparent_color</pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_v_self-&gt;transparent_color;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">683</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">684</span>:         fine_x = self.ppu_scroll[PPU_SCROLL_X] &amp; 0b00000111</pre>
<pre class='cython code score-0 '>  __pyx_v_fine_x = ((__pyx_v_self-&gt;ppu_scroll[__pyx_e_3nes_6cycore_3ppu_PPU_SCROLL_X]) &amp; 7);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">685</span>:         px = (self.pixel - 1) % 8 + fine_x</pre>
<pre class='cython code score-0 '>  __pyx_v_px = (((__pyx_v_self-&gt;pixel - 1) % 8) + __pyx_v_fine_x);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">686</span>:         mask = 1 &lt;&lt; (15 - px)</pre>
<pre class='cython code score-0 '>  __pyx_v_mask = (1 &lt;&lt; (15 - __pyx_v_px));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">687</span>:         v = ((self._pattern_lo &amp; mask) &gt; 0) + ((self._pattern_hi &amp; mask) &gt; 0) * 2</pre>
<pre class='cython code score-0 '>  __pyx_v_v = (((__pyx_v_self-&gt;_pattern_lo &amp; __pyx_v_mask) &gt; 0) + (((__pyx_v_self-&gt;_pattern_hi &amp; __pyx_v_mask) &gt; 0) * 2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">688</span>:         return self._palette[px &gt;&gt; 3][v] if v &gt; 0 else self.transparent_color</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_v &gt; 0);
  if (__pyx_t_1) {
    __pyx_t_3 = ((__pyx_v_self-&gt;_palette[(__pyx_v_px &gt;&gt; 3)])[__pyx_v_v]);
  } else {
    __pyx_t_3 = __pyx_v_self-&gt;transparent_color;
  }
  __pyx_r = __pyx_t_3;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">689</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">690</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">691</span>:     ################ Palette Decoder ###################################################################################</pre>
<pre class="cython line score-0">&#xA0;<span class="">692</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">693</span>:     cdef void invalidate_palette_cache(self):</pre>
<pre class='cython code score-0 '>static void __pyx_f_3nes_6cycore_3ppu_6NESPPU_invalidate_palette_cache(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self) {
  int __pyx_v_i;
/* … */
  /* function exit code */
}
</pre><pre class="cython line score-0">&#xA0;<span class="">694</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">695</span>:         Invalidates the entire palette cache; could be more efficient by only invalidating entries that have been</pre>
<pre class="cython line score-0">&#xA0;<span class="">696</span>:         rewritten.</pre>
<pre class="cython line score-0">&#xA0;<span class="">697</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">698</span>:         cdef int i=0</pre>
<pre class='cython code score-0 '>  __pyx_v_i = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">699</span>:         for i in range(8):</pre>
<pre class='cython code score-0 '>  for (__pyx_t_1 = 0; __pyx_t_1 &lt; 8; __pyx_t_1+=1) {
    __pyx_v_i = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">700</span>:             self._palette_cache_valid[i] = False</pre>
<pre class='cython code score-0 '>    (__pyx_v_self-&gt;_palette_cache_valid[__pyx_v_i]) = 0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">701</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">702</span>:     cdef void decode_palette(self, int* palette_out, int palette_id, bint is_sprite):</pre>
<pre class='cython code score-2 '>static void __pyx_f_3nes_6cycore_3ppu_6NESPPU_decode_palette(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self, int *__pyx_v_palette_out, int __pyx_v_palette_id, int __pyx_v_is_sprite) {
  int __pyx_v_palette_address;
  int __pyx_v_i;
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.decode_palette", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">703</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">704</span>:         If is_sprite is true, then decodes palette from the sprite palettes, otherwise</pre>
<pre class="cython line score-0">&#xA0;<span class="">705</span>:         decodes from the background palette tables.</pre>
<pre class="cython line score-0">&#xA0;<span class="">706</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">707</span>:         cdef int palette_address, i, cmask</pre>
<pre class="cython line score-0">&#xA0;<span class="">708</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">709</span>:         if self._palette_cache_valid[is_sprite * 4 + palette_id]:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_self-&gt;_palette_cache_valid[((__pyx_v_is_sprite * 4) + __pyx_v_palette_id)]) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">710</span>:             palette_out[0] = self._palette_cache[is_sprite * 4 + palette_id][0]</pre>
<pre class='cython code score-0 '>    (__pyx_v_palette_out[0]) = ((__pyx_v_self-&gt;_palette_cache[((__pyx_v_is_sprite * 4) + __pyx_v_palette_id)])[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">711</span>:             palette_out[1] = self._palette_cache[is_sprite * 4 + palette_id][1]</pre>
<pre class='cython code score-0 '>    (__pyx_v_palette_out[1]) = ((__pyx_v_self-&gt;_palette_cache[((__pyx_v_is_sprite * 4) + __pyx_v_palette_id)])[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">712</span>:             palette_out[2] = self._palette_cache[is_sprite * 4 + palette_id][2]</pre>
<pre class='cython code score-0 '>    (__pyx_v_palette_out[2]) = ((__pyx_v_self-&gt;_palette_cache[((__pyx_v_is_sprite * 4) + __pyx_v_palette_id)])[2]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">713</span>:             palette_out[3] = self._palette_cache[is_sprite * 4 + palette_id][3]</pre>
<pre class='cython code score-0 '>    (__pyx_v_palette_out[3]) = ((__pyx_v_self-&gt;_palette_cache[((__pyx_v_is_sprite * 4) + __pyx_v_palette_id)])[3]);
</pre><pre class="cython line score-0">&#xA0;<span class="">714</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">715</span>:         # get the palette colours (these are in hue (chroma) / value (luma) format.)</pre>
<pre class="cython line score-0">&#xA0;<span class="">716</span>:         # palette_id is in range 0..3, and gives an offset into one of the four background palettes,</pre>
<pre class="cython line score-0">&#xA0;<span class="">717</span>:         # each of which consists of three colors, each of which is represented by a singe byte</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">718</span>:         palette_address = PALETTE_START + 16 * is_sprite + 4 * palette_id</pre>
<pre class='cython code score-0 '>  __pyx_v_palette_address = ((__pyx_e_3nes_6cycore_6memory_PALETTE_START + (16 * __pyx_v_is_sprite)) + (4 * __pyx_v_palette_id));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">719</span>:         for i in range(4):</pre>
<pre class='cython code score-0 '>  for (__pyx_t_2 = 0; __pyx_t_2 &lt; 4; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">720</span>:             palette_out[i] = (self.vram.read(palette_address + i) &amp; 0b00111111)</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = ((struct __pyx_vtabstruct_3nes_6cycore_6memory_NESVRAM *)__pyx_v_self-&gt;vram-&gt;__pyx_base.__pyx_vtab)-&gt;__pyx_base.read(((struct __pyx_obj_3nes_6cycore_6memory_MemoryBase *)__pyx_v_self-&gt;vram), (__pyx_v_palette_address + __pyx_v_i));<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 720, __pyx_L1_error)</span>
    (__pyx_v_palette_out[__pyx_v_i]) = (__pyx_t_3 &amp; 63);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">721</span>:             self._palette_cache[is_sprite * 4 + palette_id][i] = palette_out[i]</pre>
<pre class='cython code score-0 '>    ((__pyx_v_self-&gt;_palette_cache[((__pyx_v_is_sprite * 4) + __pyx_v_palette_id)])[__pyx_v_i]) = (__pyx_v_palette_out[__pyx_v_i]);
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">722</span>:         self._palette_cache_valid[is_sprite * 4 + palette_id] = True</pre>
<pre class='cython code score-0 '>  (__pyx_v_self-&gt;_palette_cache_valid[((__pyx_v_is_sprite * 4) + __pyx_v_palette_id)]) = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">723</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">724</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">725</span>:     ################ Logging ###########################################################################################</pre>
<pre class="cython line score-0">&#xA0;<span class="">726</span>: </pre>
<pre class="cython line score-31" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">727</span>:     def log_line(self):</pre>
<pre class='cython code score-31 '>/* Python wrapper */
static PyObject *__pyx_pw_3nes_6cycore_3ppu_6NESPPU_7log_line(PyObject *__pyx_v_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_3nes_6cycore_3ppu_6NESPPU_6log_line, "\n        Generate a log line from the CPU\n        ");
static PyMethodDef __pyx_mdef_3nes_6cycore_3ppu_6NESPPU_7log_line = {"log_line", (PyCFunction)(void(*)(void))(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_3nes_6cycore_3ppu_6NESPPU_7log_line, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_3nes_6cycore_3ppu_6NESPPU_6log_line};
static PyObject *__pyx_pw_3nes_6cycore_3ppu_6NESPPU_7log_line(PyObject *__pyx_v_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("log_line (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_SIZE
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  if (unlikely(__pyx_nargs &gt; 0)) { <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("log_line", 1, 0, 0, __pyx_nargs); return NULL; }
  const Py_ssize_t __pyx_kwds_len = unlikely(__pyx_kwds) ? <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds) : 0;
  if (unlikely(__pyx_kwds_len &lt; 0)) return NULL;
  if (unlikely(__pyx_kwds_len &gt; 0)) {<span class='pyx_c_api'>__Pyx_RejectKeywords</span>("log_line", __pyx_kwds); return NULL;}
  __pyx_r = __pyx_pf_3nes_6cycore_3ppu_6NESPPU_6log_line(((struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3nes_6cycore_3ppu_6NESPPU_6log_line(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self) {
  PyObject *__pyx_v_log = NULL;
  PyObject *__pyx_r = NULL;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.log_line", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_log);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_3nes_6cycore_3ppu_6NESPPU_7log_line, __Pyx_CYFUNCTION_CCLASS, __pyx_mstate_global-&gt;__pyx_n_u_NESPPU_log_line, NULL, __pyx_mstate_global-&gt;__pyx_n_u_nes_cycore_ppu, __pyx_mstate_global-&gt;__pyx_d, ((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[3]));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 727, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  if (<span class='pyx_c_api'>__Pyx_SetItemOnTypeDict</span>(__pyx_mstate_global-&gt;__pyx_ptype_3nes_6cycore_3ppu_NESPPU, __pyx_mstate_global-&gt;__pyx_n_u_log_line, __pyx_t_5) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 727, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">728</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">729</span>:         Generate a log line from the CPU</pre>
<pre class="cython line score-0">&#xA0;<span class="">730</span>:         """</pre>
<pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">731</span>:         log = "{:5d}, {:3d}, {:3d}   ".format(self.frames_since_reset, self.line, self.pixel)</pre>
<pre class='cython code score-13 '>  __pyx_t_2 = __pyx_mstate_global-&gt;__pyx_kp_u_5d_3d_3d;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>(__pyx_v_self-&gt;frames_since_reset);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 731, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>(__pyx_v_self-&gt;line);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 731, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>(__pyx_v_self-&gt;pixel);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 731, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = 0;
  {
    PyObject *__pyx_callargs[4] = {__pyx_t_2, __pyx_t_3, __pyx_t_4, __pyx_t_5};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCallMethod</span>(__pyx_mstate_global-&gt;__pyx_n_u_format, __pyx_callargs+__pyx_t_6, (4-__pyx_t_6) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 731, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  }
  __pyx_v_log = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">732</span>:         log += "C:{:02X} M:{:02X} S:{:02X} OA:{:02X} OD:{:02X} ".format(self.ppu_ctrl,</pre>
<pre class='cython code score-7 '>  __pyx_t_5 = __pyx_mstate_global-&gt;__pyx_kp_u_C_02X_M_02X_S_02X_OA_02X_OD_02X;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyLong_From_unsigned_char</span>(__pyx_v_self-&gt;ppu_ctrl);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 732, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
/* … */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyUnicode_ConcatInPlaceSafe</span>(__pyx_v_log, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 732, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_log, ((PyObject*)__pyx_t_2));
  __pyx_t_2 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">733</span>:                                                                         self.ppu_mask,</pre>
<pre class='cython code score-2 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyLong_From_unsigned_char</span>(__pyx_v_self-&gt;ppu_mask);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 733, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">734</span>:                                                                         self.ppu_status,</pre>
<pre class='cython code score-5 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_self);
  __pyx_t_7 = __pyx_v_self;
  __pyx_t_2 = __Pyx_CFunc_ed1085__3nes_6cycore_3ppu_6NESPPU_unsigned__space_char__etc_to_py_4self(((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_t_7-&gt;__pyx_vtab)-&gt;ppu_status);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 734, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_8 = ((PyObject *)__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
  __pyx_t_9 = __Pyx_PyMethod_New2Arg(__pyx_t_2, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 734, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>((PyObject *)__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">735</span>:                                                                         self.oam_addr,</pre>
<pre class='cython code score-2 '>  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyLong_From_unsigned_char</span>(__pyx_v_self-&gt;oam_addr);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 735, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">736</span>:                                                                         self.oam_data)</pre>
<pre class='cython code score-10 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyLong_From_unsigned_char</span>(__pyx_v_self-&gt;oam_data);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 736, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_6 = 0;
  {
    PyObject *__pyx_callargs[6] = {__pyx_t_5, __pyx_t_4, __pyx_t_3, __pyx_t_9, __pyx_t_8, __pyx_t_2};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCallMethod</span>(__pyx_mstate_global-&gt;__pyx_n_u_format, __pyx_callargs+__pyx_t_6, (6-__pyx_t_6) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 732, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">737</span>: </pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">738</span>:         log += "SC:{:02X},{:02X} PA:{:04X}".format(self.ppu_scroll[0],</pre>
<pre class='cython code score-7 '>  __pyx_t_1 = __pyx_mstate_global-&gt;__pyx_kp_u_SC_02X_02X_PA_04X;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyLong_From_unsigned_char</span>((__pyx_v_self-&gt;ppu_scroll[0]));<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 738, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
/* … */
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyUnicode_ConcatInPlaceSafe</span>(__pyx_v_log, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 738, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_log, ((PyObject*)__pyx_t_3));
  __pyx_t_3 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">739</span>:                                                    self.ppu_scroll[1],</pre>
<pre class='cython code score-2 '>  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyLong_From_unsigned_char</span>((__pyx_v_self-&gt;ppu_scroll[1]));<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 739, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">740</span>:                                                    self.ppu_addr)</pre>
<pre class='cython code score-8 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyLong_From_unsigned_int</span>(__pyx_v_self-&gt;ppu_addr);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 740, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_6 = 0;
  {
    PyObject *__pyx_callargs[4] = {__pyx_t_1, __pyx_t_8, __pyx_t_9, __pyx_t_3};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_FastCallMethod</span>(__pyx_mstate_global-&gt;__pyx_n_u_format, __pyx_callargs+__pyx_t_6, (4-__pyx_t_6) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 738, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">741</span>:         return log</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_log);
  __pyx_r = __pyx_v_log;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">742</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">743</span>:     ################ Debug #############################################################################################</pre>
<pre class="cython line score-0">&#xA0;<span class="">744</span>: </pre>
<pre class="cython line score-74" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">745</span>:     cpdef void debug_render_nametables(self, unsigned int[:, :] dest):</pre>
<pre class='cython code score-74 '>static PyObject *__pyx_pw_3nes_6cycore_3ppu_6NESPPU_9debug_render_nametables(PyObject *__pyx_v_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static void __pyx_f_3nes_6cycore_3ppu_6NESPPU_debug_render_nametables(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self, __Pyx_memviewslice __pyx_v_dest, int __pyx_skip_dispatch) {
  int __pyx_v_nx;
  int __pyx_v_ny;
  int __pyx_v_nametable;
  int __pyx_v_addr_base;
  int __pyx_v_row;
  int __pyx_v_vblock;
  int __pyx_v_v_subblock_ix;
  int __pyx_v_col;
  int __pyx_v_tile_index;
  int __pyx_v_hblock;
  int __pyx_v_h_subblock_ix;
  int __pyx_v_shift;
  int __pyx_v_mask;
  CYTHON_UNUSED int __pyx_v_palette_id;
  int __pyx_v_tile_bank;
  CYTHON_UNUSED int __pyx_v_x;
  CYTHON_UNUSED int __pyx_v_y;
  int __pyx_v_x0;
  int __pyx_v_xe;
  int __pyx_v_y0;
  int __pyx_v_ye;
  unsigned char __pyx_v_attribute_byte;
  CYTHON_UNUSED PyObject *__pyx_v_tile = NULL;
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (
  #if !CYTHON_USE_TYPE_SLOTS
  unlikely(Py_TYPE(((PyObject *)__pyx_v_self)) != __pyx_mstate_global-&gt;__pyx_ptype_3nes_6cycore_3ppu_NESPPU &amp;&amp;
  <span class='pyx_c_api'>__Pyx_PyType_HasFeature</span>(Py_TYPE(((PyObject *)__pyx_v_self)), Py_TPFLAGS_HAVE_GC))
  #else
  unlikely(Py_TYPE(((PyObject *)__pyx_v_self))-&gt;tp_dictoffset != 0 || <span class='pyx_c_api'>__Pyx_PyType_HasFeature</span>(Py_TYPE(((PyObject *)__pyx_v_self)), (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))
  #endif
  ) {
    #if CYTHON_USE_DICT_VERSIONS &amp;&amp; CYTHON_USE_PYTYPE_LOOKUP &amp;&amp; CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_typedict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_self), __pyx_mstate_global-&gt;__pyx_n_u_debug_render_nametables);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 745, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      if (!<span class='pyx_c_api'>__Pyx_IsSameCFunction</span>(__pyx_t_1, (void(*)(void)) __pyx_pw_3nes_6cycore_3ppu_6NESPPU_9debug_render_nametables)) {
        __pyx_t_3 = NULL;
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
        __pyx_t_4 = __pyx_t_1; 
        if (unlikely(!__pyx_v_dest.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("dest"); <span class='error_goto'>__PYX_ERR(0, 745, __pyx_L1_error)</span> }
        __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_dest, 2, (PyObject *(*)(char *)) __pyx_memview_get_unsigned_int, (int (*)(char *, PyObject *)) __pyx_memview_set_unsigned_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 745, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        __pyx_t_6 = 1;
        #if CYTHON_UNPACK_METHODS
        if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
          __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
          assert(__pyx_t_3);
          PyObject* __pyx__function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx__function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, __pyx__function);
          __pyx_t_6 = 0;
        }
        #endif
        {
          PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_5};
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_4, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 745, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS &amp;&amp; CYTHON_USE_PYTYPE_LOOKUP &amp;&amp; CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_typedict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS &amp;&amp; CYTHON_USE_PYTYPE_LOOKUP &amp;&amp; CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_22, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.debug_render_nametables", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_tile);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_3nes_6cycore_3ppu_6NESPPU_9debug_render_nametables(PyObject *__pyx_v_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_3nes_6cycore_3ppu_6NESPPU_8debug_render_nametables, "\n        Reads the nametable and attribute table and then sends the result of that for each\n        tile on the screen to render_tile to actually render the tile (reading the pattern tables, etc.)\n        ");
static PyMethodDef __pyx_mdef_3nes_6cycore_3ppu_6NESPPU_9debug_render_nametables = {"debug_render_nametables", (PyCFunction)(void(*)(void))(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_3nes_6cycore_3ppu_6NESPPU_9debug_render_nametables, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_3nes_6cycore_3ppu_6NESPPU_8debug_render_nametables};
static PyObject *__pyx_pw_3nes_6cycore_3ppu_6NESPPU_9debug_render_nametables(PyObject *__pyx_v_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_dest = { 0, 0, { 0 }, { 0 }, { 0 } };
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("debug_render_nametables (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_SIZE
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject ** const __pyx_pyargnames[] = {&amp;__pyx_mstate_global-&gt;__pyx_n_u_dest,0};
  PyObject* values[1] = {0};
    const Py_ssize_t __pyx_kwds_len = (__pyx_kwds) ? <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds) : 0;
    if (unlikely(__pyx_kwds_len) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 745, __pyx_L3_error)</span>
    if (__pyx_kwds_len &gt; 0) {
      switch (__pyx_nargs) {
        case  1:
        values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 0);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 745, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      const Py_ssize_t kwd_pos_args = __pyx_nargs;
      if (<span class='pyx_c_api'>__Pyx_ParseKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values, kwd_pos_args, __pyx_kwds_len, "debug_render_nametables", 0) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 745, __pyx_L3_error)</span>
      for (Py_ssize_t i = __pyx_nargs; i &lt; 1; i++) {
        if (unlikely(!values[i])) { <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("debug_render_nametables", 1, 1, 1, i); <span class='error_goto'>__PYX_ERR(0, 745, __pyx_L3_error)</span> }
      }
    } else if (unlikely(__pyx_nargs != 1)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 0);
      if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 745, __pyx_L3_error)</span>
    }
    __pyx_v_dest = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_unsigned_int</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_dest.memview)) __PYX_ERR(0, 745, __pyx_L3_error)</span>
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("debug_render_nametables", 1, 1, 1, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 745, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_dest, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.debug_render_nametables", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3nes_6cycore_3ppu_6NESPPU_8debug_render_nametables(((struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self), __pyx_v_dest);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_dest, 1);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3nes_6cycore_3ppu_6NESPPU_8debug_render_nametables(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self, __Pyx_memviewslice __pyx_v_dest) {
  PyObject *__pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  if (unlikely(!__pyx_v_dest.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("dest"); <span class='error_goto'>__PYX_ERR(0, 745, __pyx_L1_error)</span> }
  __pyx_f_3nes_6cycore_3ppu_6NESPPU_debug_render_nametables(__pyx_v_self, __pyx_v_dest, 1);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 745, __pyx_L1_error)</span>
  __pyx_t_1 = __Pyx_void_to_None(NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 745, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.debug_render_nametables", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_3nes_6cycore_3ppu_6NESPPU_9debug_render_nametables, __Pyx_CYFUNCTION_CCLASS, __pyx_mstate_global-&gt;__pyx_n_u_NESPPU_debug_render_nametables, NULL, __pyx_mstate_global-&gt;__pyx_n_u_nes_cycore_ppu, __pyx_mstate_global-&gt;__pyx_d, ((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[4]));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 745, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  if (<span class='pyx_c_api'>__Pyx_SetItemOnTypeDict</span>(__pyx_mstate_global-&gt;__pyx_ptype_3nes_6cycore_3ppu_NESPPU, __pyx_mstate_global-&gt;__pyx_n_u_debug_render_nametables, __pyx_t_5) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 745, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">746</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">747</span>:         Reads the nametable and attribute table and then sends the result of that for each</pre>
<pre class="cython line score-0">&#xA0;<span class="">748</span>:         tile on the screen to render_tile to actually render the tile (reading the pattern tables, etc.)</pre>
<pre class="cython line score-0">&#xA0;<span class="">749</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">750</span>:         cdef int nx=0, ny=0, nametable=0, addr_base=0, row=0, vblock=0, v_subblock_ix=0, col=0, tile_index=0, hblock=0, h_subblock_ix=0, shift=0</pre>
<pre class='cython code score-0 '>  __pyx_v_nx = 0;
  __pyx_v_ny = 0;
  __pyx_v_nametable = 0;
  __pyx_v_addr_base = 0;
  __pyx_v_row = 0;
  __pyx_v_vblock = 0;
  __pyx_v_v_subblock_ix = 0;
  __pyx_v_col = 0;
  __pyx_v_tile_index = 0;
  __pyx_v_hblock = 0;
  __pyx_v_h_subblock_ix = 0;
  __pyx_v_shift = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">751</span>:         cdef int mask=0, palette_id=0, tile_bank=0, x=0, y=0, x0=0, xe=0, y0=0, ye=0</pre>
<pre class='cython code score-0 '>  __pyx_v_mask = 0;
  __pyx_v_palette_id = 0;
  __pyx_v_tile_bank = 0;
  __pyx_v_x = 0;
  __pyx_v_y = 0;
  __pyx_v_x0 = 0;
  __pyx_v_xe = 0;
  __pyx_v_y0 = 0;
  __pyx_v_ye = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">752</span>:         cdef unsigned char attribute_byte=0</pre>
<pre class='cython code score-0 '>  __pyx_v_attribute_byte = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">753</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">754</span>:         dest[:, :] = self.get_background_color()</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;get_background_color(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 754, __pyx_L1_error)</span>
  {
      unsigned int __pyx_temp_scalar = __pyx_t_7;
      {
          Py_ssize_t __pyx_temp_extent_0 = __pyx_v_dest.shape[0];
          Py_ssize_t __pyx_temp_stride_0 = __pyx_v_dest.strides[0];
          char *__pyx_temp_pointer_0;
          Py_ssize_t __pyx_temp_idx_0;
          Py_ssize_t __pyx_temp_extent_1 = __pyx_v_dest.shape[1];
          Py_ssize_t __pyx_temp_stride_1 = __pyx_v_dest.strides[1];
          char *__pyx_temp_pointer_1;
          Py_ssize_t __pyx_temp_idx_1;
          __pyx_temp_pointer_0 = __pyx_v_dest.data;
          for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 &lt; __pyx_temp_extent_0; __pyx_temp_idx_0++) {
            __pyx_temp_pointer_1 = __pyx_temp_pointer_0;
            for (__pyx_temp_idx_1 = 0; __pyx_temp_idx_1 &lt; __pyx_temp_extent_1; __pyx_temp_idx_1++) {
              *((unsigned int *) __pyx_temp_pointer_1) = __pyx_temp_scalar;
              __pyx_temp_pointer_1 += __pyx_temp_stride_1;
            }
            __pyx_temp_pointer_0 += __pyx_temp_stride_0;
          }
      }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">755</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">756</span>:         for ny in range(2):</pre>
<pre class='cython code score-0 '>  for (__pyx_t_7 = 0; __pyx_t_7 &lt; 2; __pyx_t_7+=1) {
    __pyx_v_ny = __pyx_t_7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">757</span>:             for nx in range(2):</pre>
<pre class='cython code score-0 '>    for (__pyx_t_8 = 0; __pyx_t_8 &lt; 2; __pyx_t_8+=1) {
      __pyx_v_nx = __pyx_t_8;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">758</span>:                 nametable = ny * 2 + nx</pre>
<pre class='cython code score-0 '>      __pyx_v_nametable = ((__pyx_v_ny * 2) + __pyx_v_nx);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">759</span>:                 addr_base = NAMETABLE_START + nametable * NAMETABLE_LENGTH_BYTES</pre>
<pre class='cython code score-0 '>      __pyx_v_addr_base = (__pyx_e_3nes_6cycore_6memory_NAMETABLE_START + (__pyx_v_nametable * __pyx_e_3nes_6cycore_6memory_NAMETABLE_LENGTH_BYTES));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">760</span>:                 for row in range(SCREEN_TILE_ROWS):</pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_e_3nes_6cycore_3ppu_SCREEN_TILE_ROWS;
      __pyx_t_10 = __pyx_t_9;
      for (__pyx_t_11 = 0; __pyx_t_11 &lt; __pyx_t_10; __pyx_t_11+=1) {
        __pyx_v_row = __pyx_t_11;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">761</span>:                     vblock = int(row / 2)</pre>
<pre class='cython code score-0 '>        __pyx_v_vblock = ((int)(((long)__pyx_v_row) / 2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">762</span>:                     v_subblock_ix = vblock % 2</pre>
<pre class='cython code score-0 '>        __pyx_v_v_subblock_ix = (__pyx_v_vblock % 2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">763</span>:                     for col in range(SCREEN_TILE_COLS):</pre>
<pre class='cython code score-0 '>        __pyx_t_12 = __pyx_e_3nes_6cycore_3ppu_SCREEN_TILE_COLS;
        __pyx_t_13 = __pyx_t_12;
        for (__pyx_t_14 = 0; __pyx_t_14 &lt; __pyx_t_13; __pyx_t_14+=1) {
          __pyx_v_col = __pyx_t_14;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">764</span>:                         tile_index = self.vram.read(addr_base + row * SCREEN_TILE_COLS + col)</pre>
<pre class='cython code score-0 '>          __pyx_t_15 = ((struct __pyx_vtabstruct_3nes_6cycore_6memory_NESVRAM *)__pyx_v_self-&gt;vram-&gt;__pyx_base.__pyx_vtab)-&gt;__pyx_base.read(((struct __pyx_obj_3nes_6cycore_6memory_MemoryBase *)__pyx_v_self-&gt;vram), ((__pyx_v_addr_base + (__pyx_v_row * __pyx_e_3nes_6cycore_3ppu_SCREEN_TILE_COLS)) + __pyx_v_col));<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 764, __pyx_L1_error)</span>
          __pyx_v_tile_index = __pyx_t_15;
</pre><pre class="cython line score-0">&#xA0;<span class="">765</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">766</span>:                         # get attribute byte from the attribute table at the end of the nametable</pre>
<pre class="cython line score-0">&#xA0;<span class="">767</span>:                         # these tables compress the palette id into two bits for each 2x2 tile block of 16x16px.</pre>
<pre class="cython line score-0">&#xA0;<span class="">768</span>:                         # the attribute bytes each contain the palette id for a 2x2 block of these 16x16 blocks</pre>
<pre class="cython line score-0">&#xA0;<span class="">769</span>:                         # so get the correct byte and then extract the actual palette id from that</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">770</span>:                         hblock = int(col / 2)</pre>
<pre class='cython code score-0 '>          __pyx_v_hblock = ((int)(((long)__pyx_v_col) / 2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">771</span>:                         attribute_byte = self.vram.read(addr_base</pre>
<pre class='cython code score-0 '>          __pyx_t_15 = ((struct __pyx_vtabstruct_3nes_6cycore_6memory_NESVRAM *)__pyx_v_self-&gt;vram-&gt;__pyx_base.__pyx_vtab)-&gt;__pyx_base.read(((struct __pyx_obj_3nes_6cycore_6memory_MemoryBase *)__pyx_v_self-&gt;vram), __pyx_t_17);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 771, __pyx_L1_error)</span>
          __pyx_v_attribute_byte = __pyx_t_15;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">772</span>:                                                         + ATTRIBUTE_TABLE_OFFSET</pre>
<pre class='cython code score-2 '>          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>((__pyx_v_addr_base + __pyx_e_3nes_6cycore_6memory_ATTRIBUTE_TABLE_OFFSET));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 772, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
</pre><pre class="cython line score-41" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">773</span>:                                                         + (int(vblock / 2) * 8 + int(hblock / 2))</pre>
<pre class='cython code score-41 '>          __pyx_t_4 = NULL;
          <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)(&amp;PyLong_Type));
          __pyx_t_5 = ((PyObject *)(&amp;PyLong_Type)); 
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyLong_From_long</span>((((long)__pyx_v_vblock) / 2));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 773, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          __pyx_t_6 = 1;
          {
            PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_3};
            __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_5, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
            if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 773, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          }
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyLong_MultiplyObjC</span>(__pyx_t_2, __pyx_mstate_global-&gt;__pyx_int_8, 8, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 773, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_3 = NULL;
          <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)(&amp;PyLong_Type));
          __pyx_t_4 = ((PyObject *)(&amp;PyLong_Type)); 
          __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyLong_From_long</span>((((long)__pyx_v_hblock) / 2));<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 773, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
          __pyx_t_6 = 1;
          {
            PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_16};
            __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_4, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
            <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
            if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 773, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          }
          __pyx_t_4 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_5, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 773, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 773, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyLong_As_int</span>(__pyx_t_2); if (unlikely((__pyx_t_17 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 773, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">774</span>:                                                        )</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">775</span>:                         h_subblock_ix = hblock % 2</pre>
<pre class='cython code score-0 '>          __pyx_v_h_subblock_ix = (__pyx_v_hblock % 2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">776</span>:                         shift = 4 * v_subblock_ix + 2 * h_subblock_ix</pre>
<pre class='cython code score-0 '>          __pyx_v_shift = ((4 * __pyx_v_v_subblock_ix) + (2 * __pyx_v_h_subblock_ix));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">777</span>:                         mask = 0b00000011 &lt;&lt; shift</pre>
<pre class='cython code score-0 '>          __pyx_v_mask = (3 &lt;&lt; __pyx_v_shift);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">778</span>:                         palette_id = (attribute_byte &amp; mask) &gt;&gt; shift</pre>
<pre class='cython code score-0 '>          __pyx_v_palette_id = ((__pyx_v_attribute_byte &amp; __pyx_v_mask) &gt;&gt; __pyx_v_shift);
</pre><pre class="cython line score-0">&#xA0;<span class="">779</span>:                         # ppu_ctrl tells us whether to read the left or right pattern table, so let's fetch that</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">780</span>:                         tile_bank = (self.ppu_ctrl &amp; BKG_PATTERN_TABLE_MASK) &gt; 0</pre>
<pre class='cython code score-0 '>          __pyx_v_tile_bank = ((__pyx_v_self-&gt;ppu_ctrl &amp; __pyx_e_3nes_6cycore_3ppu_BKG_PATTERN_TABLE_MASK) &gt; 0);
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">781</span>:                         tile = self.debug_render_tile(dest,</pre>
<pre class='cython code score-1 '>          ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;debug_render_tile(__pyx_v_self, __pyx_v_dest, (((__pyx_v_nx * __pyx_e_3nes_6cycore_3ppu_SCREEN_TILE_COLS) + __pyx_v_col) * __pyx_e_3nes_6cycore_3ppu_TILE_WIDTH_PX), (((__pyx_v_ny * __pyx_e_3nes_6cycore_3ppu_SCREEN_TILE_ROWS) + __pyx_v_row) * __pyx_e_3nes_6cycore_3ppu_TILE_HEIGHT_PX), __pyx_v_tile_index, __pyx_v_tile_bank, -1, 0, 0, 0);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 781, __pyx_L1_error)</span>
          __pyx_t_2 = __Pyx_void_to_None(NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 781, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_tile, __pyx_t_2);
          __pyx_t_2 = 0;
        }
      }
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">782</span>:                                                       (nx * SCREEN_TILE_COLS + col) * TILE_WIDTH_PX,</pre>
<pre class="cython line score-0">&#xA0;<span class="">783</span>:                                                       (ny * SCREEN_TILE_ROWS + row) * TILE_HEIGHT_PX,</pre>
<pre class="cython line score-0">&#xA0;<span class="">784</span>:                                                       tile_index,</pre>
<pre class="cython line score-0">&#xA0;<span class="">785</span>:                                                       tile_bank,</pre>
<pre class="cython line score-0">&#xA0;<span class="">786</span>:                                                       -1,</pre>
<pre class="cython line score-0">&#xA0;<span class="">787</span>:                                                       #palette_id,</pre>
<pre class="cython line score-0">&#xA0;<span class="">788</span>:                                                       False,</pre>
<pre class="cython line score-0">&#xA0;<span class="">789</span>:                                                       False</pre>
<pre class="cython line score-0">&#xA0;<span class="">790</span>:                                                      )</pre>
<pre class="cython line score-0">&#xA0;<span class="">791</span>:         # draw a box around the active window</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">792</span>:         x0 = (self.ppu_scroll[PPU_SCROLL_X] + (bit_high(self.ppu_ctrl, BIT_NAMETABLE_X) &lt;&lt; 8)) % 512</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = __pyx_f_3nes_6cycore_7bitwise_bit_high(__pyx_v_self-&gt;ppu_ctrl, __pyx_e_3nes_6cycore_3ppu_BIT_NAMETABLE_X);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 792, __pyx_L1_error)</span>
  __pyx_v_x0 = (((__pyx_v_self-&gt;ppu_scroll[__pyx_e_3nes_6cycore_3ppu_PPU_SCROLL_X]) + (__pyx_t_7 &lt;&lt; 8)) % 0x200);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">793</span>:         y0 = (self.ppu_scroll[PPU_SCROLL_Y] + (bit_high(self.ppu_ctrl, BIT_NAMETABLE_Y) * 240)) % 480</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = __pyx_f_3nes_6cycore_7bitwise_bit_high(__pyx_v_self-&gt;ppu_ctrl, __pyx_e_3nes_6cycore_3ppu_BIT_NAMETABLE_Y);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 793, __pyx_L1_error)</span>
  __pyx_v_y0 = (((__pyx_v_self-&gt;ppu_scroll[__pyx_e_3nes_6cycore_3ppu_PPU_SCROLL_Y]) + (__pyx_t_7 * 0xF0)) % 0x1E0);
</pre><pre class="cython line score-0">&#xA0;<span class="">794</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">795</span>:         xe = (x0 + 256) % 512</pre>
<pre class='cython code score-0 '>  __pyx_v_xe = ((__pyx_v_x0 + 0x100) % 0x200);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">796</span>:         ye = (y0 + 240) % 480</pre>
<pre class='cython code score-0 '>  __pyx_v_ye = ((__pyx_v_y0 + 0xF0) % 0x1E0);
</pre><pre class="cython line score-0">&#xA0;<span class="">797</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">798</span>:         dest[x0:min(512, x0 + 256), y0] = 255 &lt;&lt; 8</pre>
<pre class='cython code score-0 '>  __pyx_t_18 = (__pyx_v_x0 + 0x100);
  __pyx_t_19 = 0x200;
  __pyx_t_21 = (__pyx_t_18 &lt; __pyx_t_19);
  if (__pyx_t_21) {
    __pyx_t_20 = __pyx_t_18;
  } else {
    __pyx_t_20 = __pyx_t_19;
  }
  __pyx_t_22.data = __pyx_v_dest.data;
  __pyx_t_22.memview = __pyx_v_dest.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_22, 1);
  __pyx_t_7 = -1;
  if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_22,
    __pyx_v_dest.shape[0], __pyx_v_dest.strides[0], __pyx_v_dest.suboffsets[0],
    0,
    0,
    &amp;__pyx_t_7,
    __pyx_v_x0,
    __pyx_t_20,
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 798, __pyx_L1_error)</span>
}

{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_y0;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_dest.shape[1];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_dest.strides[1];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        __pyx_t_22.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

{
      unsigned int __pyx_temp_scalar = 0xff00;
      {
          Py_ssize_t __pyx_temp_extent_0 = __pyx_t_22.shape[0];
          Py_ssize_t __pyx_temp_stride_0 = __pyx_t_22.strides[0];
          char *__pyx_temp_pointer_0;
          Py_ssize_t __pyx_temp_idx_0;
          __pyx_temp_pointer_0 = __pyx_t_22.data;
          for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 &lt; __pyx_temp_extent_0; __pyx_temp_idx_0++) {
            *((unsigned int *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
            __pyx_temp_pointer_0 += __pyx_temp_stride_0;
          }
      }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_22, 1);
  __pyx_t_22.memview = NULL; __pyx_t_22.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">799</span>:         dest[x0:min(512, x0 + 256), ye] = 255 &lt;&lt; 8</pre>
<pre class='cython code score-0 '>  __pyx_t_20 = (__pyx_v_x0 + 0x100);
  __pyx_t_18 = 0x200;
  __pyx_t_21 = (__pyx_t_20 &lt; __pyx_t_18);
  if (__pyx_t_21) {
    __pyx_t_19 = __pyx_t_20;
  } else {
    __pyx_t_19 = __pyx_t_18;
  }
  __pyx_t_22.data = __pyx_v_dest.data;
  __pyx_t_22.memview = __pyx_v_dest.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_22, 1);
  __pyx_t_7 = -1;
  if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_22,
    __pyx_v_dest.shape[0], __pyx_v_dest.strides[0], __pyx_v_dest.suboffsets[0],
    0,
    0,
    &amp;__pyx_t_7,
    __pyx_v_x0,
    __pyx_t_19,
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 799, __pyx_L1_error)</span>
}

{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_ye;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_dest.shape[1];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_dest.strides[1];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        __pyx_t_22.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

{
      unsigned int __pyx_temp_scalar = 0xff00;
      {
          Py_ssize_t __pyx_temp_extent_0 = __pyx_t_22.shape[0];
          Py_ssize_t __pyx_temp_stride_0 = __pyx_t_22.strides[0];
          char *__pyx_temp_pointer_0;
          Py_ssize_t __pyx_temp_idx_0;
          __pyx_temp_pointer_0 = __pyx_t_22.data;
          for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 &lt; __pyx_temp_extent_0; __pyx_temp_idx_0++) {
            *((unsigned int *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
            __pyx_temp_pointer_0 += __pyx_temp_stride_0;
          }
      }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_22, 1);
  __pyx_t_22.memview = NULL; __pyx_t_22.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">800</span>:         if x0 + 256 &gt; 512:</pre>
<pre class='cython code score-0 '>  __pyx_t_21 = ((__pyx_v_x0 + 0x100) &gt; 0x200);
  if (__pyx_t_21) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">801</span>:             dest[0:xe, y0] = 255 &lt;&lt; 8</pre>
<pre class='cython code score-0 '>    __pyx_t_22.data = __pyx_v_dest.data;
    __pyx_t_22.memview = __pyx_v_dest.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_22, 1);
    __pyx_t_7 = -1;
    if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_22,
    __pyx_v_dest.shape[0], __pyx_v_dest.strides[0], __pyx_v_dest.suboffsets[0],
    0,
    0,
    &amp;__pyx_t_7,
    0,
    __pyx_v_xe,
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 801, __pyx_L1_error)</span>
}

{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_y0;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_dest.shape[1];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_dest.strides[1];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        __pyx_t_22.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

{
        unsigned int __pyx_temp_scalar = 0xff00;
        {
            Py_ssize_t __pyx_temp_extent_0 = __pyx_t_22.shape[0];
            Py_ssize_t __pyx_temp_stride_0 = __pyx_t_22.strides[0];
            char *__pyx_temp_pointer_0;
            Py_ssize_t __pyx_temp_idx_0;
            __pyx_temp_pointer_0 = __pyx_t_22.data;
            for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 &lt; __pyx_temp_extent_0; __pyx_temp_idx_0++) {
              *((unsigned int *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
              __pyx_temp_pointer_0 += __pyx_temp_stride_0;
            }
        }
    }
    __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_22, 1);
    __pyx_t_22.memview = NULL; __pyx_t_22.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">802</span>:             dest[0:xe, ye] = 255 &lt;&lt; 8</pre>
<pre class='cython code score-0 '>    __pyx_t_22.data = __pyx_v_dest.data;
    __pyx_t_22.memview = __pyx_v_dest.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_22, 1);
    __pyx_t_7 = -1;
    if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_22,
    __pyx_v_dest.shape[0], __pyx_v_dest.strides[0], __pyx_v_dest.suboffsets[0],
    0,
    0,
    &amp;__pyx_t_7,
    0,
    __pyx_v_xe,
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 802, __pyx_L1_error)</span>
}

{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_ye;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_dest.shape[1];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_dest.strides[1];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        __pyx_t_22.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

{
        unsigned int __pyx_temp_scalar = 0xff00;
        {
            Py_ssize_t __pyx_temp_extent_0 = __pyx_t_22.shape[0];
            Py_ssize_t __pyx_temp_stride_0 = __pyx_t_22.strides[0];
            char *__pyx_temp_pointer_0;
            Py_ssize_t __pyx_temp_idx_0;
            __pyx_temp_pointer_0 = __pyx_t_22.data;
            for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 &lt; __pyx_temp_extent_0; __pyx_temp_idx_0++) {
              *((unsigned int *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
              __pyx_temp_pointer_0 += __pyx_temp_stride_0;
            }
        }
    }
    __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_22, 1);
    __pyx_t_22.memview = NULL; __pyx_t_22.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">803</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">804</span>:         dest[x0, y0:min(480, y0 + 240)] = 255 &lt;&lt; 8</pre>
<pre class='cython code score-0 '>  __pyx_t_19 = (__pyx_v_y0 + 0xF0);
  __pyx_t_20 = 0x1E0;
  __pyx_t_21 = (__pyx_t_19 &lt; __pyx_t_20);
  if (__pyx_t_21) {
    __pyx_t_18 = __pyx_t_19;
  } else {
    __pyx_t_18 = __pyx_t_20;
  }
  __pyx_t_22.data = __pyx_v_dest.data;
  __pyx_t_22.memview = __pyx_v_dest.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_22, 1);
  {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_x0;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_dest.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_dest.strides[0];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        __pyx_t_22.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_7 = -1;
  if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_22,
    __pyx_v_dest.shape[1], __pyx_v_dest.strides[1], __pyx_v_dest.suboffsets[1],
    1,
    0,
    &amp;__pyx_t_7,
    __pyx_v_y0,
    __pyx_t_18,
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 804, __pyx_L1_error)</span>
}

{
      unsigned int __pyx_temp_scalar = 0xff00;
      {
          Py_ssize_t __pyx_temp_extent_0 = __pyx_t_22.shape[0];
          Py_ssize_t __pyx_temp_stride_0 = __pyx_t_22.strides[0];
          char *__pyx_temp_pointer_0;
          Py_ssize_t __pyx_temp_idx_0;
          __pyx_temp_pointer_0 = __pyx_t_22.data;
          for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 &lt; __pyx_temp_extent_0; __pyx_temp_idx_0++) {
            *((unsigned int *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
            __pyx_temp_pointer_0 += __pyx_temp_stride_0;
          }
      }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_22, 1);
  __pyx_t_22.memview = NULL; __pyx_t_22.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">805</span>:         dest[xe, y0:min(480, y0 + 240)] = 255 &lt;&lt; 8</pre>
<pre class='cython code score-0 '>  __pyx_t_18 = (__pyx_v_y0 + 0xF0);
  __pyx_t_19 = 0x1E0;
  __pyx_t_21 = (__pyx_t_18 &lt; __pyx_t_19);
  if (__pyx_t_21) {
    __pyx_t_20 = __pyx_t_18;
  } else {
    __pyx_t_20 = __pyx_t_19;
  }
  __pyx_t_22.data = __pyx_v_dest.data;
  __pyx_t_22.memview = __pyx_v_dest.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_22, 1);
  {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_xe;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_dest.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_dest.strides[0];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        __pyx_t_22.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_7 = -1;
  if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_22,
    __pyx_v_dest.shape[1], __pyx_v_dest.strides[1], __pyx_v_dest.suboffsets[1],
    1,
    0,
    &amp;__pyx_t_7,
    __pyx_v_y0,
    __pyx_t_20,
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 805, __pyx_L1_error)</span>
}

{
      unsigned int __pyx_temp_scalar = 0xff00;
      {
          Py_ssize_t __pyx_temp_extent_0 = __pyx_t_22.shape[0];
          Py_ssize_t __pyx_temp_stride_0 = __pyx_t_22.strides[0];
          char *__pyx_temp_pointer_0;
          Py_ssize_t __pyx_temp_idx_0;
          __pyx_temp_pointer_0 = __pyx_t_22.data;
          for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 &lt; __pyx_temp_extent_0; __pyx_temp_idx_0++) {
            *((unsigned int *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
            __pyx_temp_pointer_0 += __pyx_temp_stride_0;
          }
      }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_22, 1);
  __pyx_t_22.memview = NULL; __pyx_t_22.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">806</span>:         if y0 + 240 &gt; 480:</pre>
<pre class='cython code score-0 '>  __pyx_t_21 = ((__pyx_v_y0 + 0xF0) &gt; 0x1E0);
  if (__pyx_t_21) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">807</span>:             dest[x0, 0:ye] = 255 &lt;&lt; 8</pre>
<pre class='cython code score-0 '>    __pyx_t_22.data = __pyx_v_dest.data;
    __pyx_t_22.memview = __pyx_v_dest.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_22, 1);
    {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_x0;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_dest.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_dest.strides[0];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        __pyx_t_22.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_7 = -1;
    if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_22,
    __pyx_v_dest.shape[1], __pyx_v_dest.strides[1], __pyx_v_dest.suboffsets[1],
    1,
    0,
    &amp;__pyx_t_7,
    0,
    __pyx_v_ye,
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 807, __pyx_L1_error)</span>
}

{
        unsigned int __pyx_temp_scalar = 0xff00;
        {
            Py_ssize_t __pyx_temp_extent_0 = __pyx_t_22.shape[0];
            Py_ssize_t __pyx_temp_stride_0 = __pyx_t_22.strides[0];
            char *__pyx_temp_pointer_0;
            Py_ssize_t __pyx_temp_idx_0;
            __pyx_temp_pointer_0 = __pyx_t_22.data;
            for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 &lt; __pyx_temp_extent_0; __pyx_temp_idx_0++) {
              *((unsigned int *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
              __pyx_temp_pointer_0 += __pyx_temp_stride_0;
            }
        }
    }
    __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_22, 1);
    __pyx_t_22.memview = NULL; __pyx_t_22.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">808</span>:             dest[xe, 0:ye] = 255 &lt;&lt; 8</pre>
<pre class='cython code score-0 '>    __pyx_t_22.data = __pyx_v_dest.data;
    __pyx_t_22.memview = __pyx_v_dest.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_22, 1);
    {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_xe;
        Py_ssize_t __pyx_tmp_shape = __pyx_v_dest.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_dest.strides[0];
        if (__pyx_tmp_idx &lt; 0)
            __pyx_tmp_idx += __pyx_tmp_shape;
        __pyx_t_22.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_7 = -1;
    if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_22,
    __pyx_v_dest.shape[1], __pyx_v_dest.strides[1], __pyx_v_dest.suboffsets[1],
    1,
    0,
    &amp;__pyx_t_7,
    0,
    __pyx_v_ye,
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 808, __pyx_L1_error)</span>
}

{
        unsigned int __pyx_temp_scalar = 0xff00;
        {
            Py_ssize_t __pyx_temp_extent_0 = __pyx_t_22.shape[0];
            Py_ssize_t __pyx_temp_stride_0 = __pyx_t_22.strides[0];
            char *__pyx_temp_pointer_0;
            Py_ssize_t __pyx_temp_idx_0;
            __pyx_temp_pointer_0 = __pyx_t_22.data;
            for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 &lt; __pyx_temp_extent_0; __pyx_temp_idx_0++) {
              *((unsigned int *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
              __pyx_temp_pointer_0 += __pyx_temp_stride_0;
            }
        }
    }
    __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_22, 1);
    __pyx_t_22.memview = NULL; __pyx_t_22.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">809</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">810</span>: </pre>
<pre class="cython line score-177" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">811</span>:     cpdef void debug_render_tile(self, unsigned int[:, :] dest, int x0, int y0, int tile_index, int tile_bank, int palette_id, bint flip_h, bint flip_v):</pre>
<pre class='cython code score-177 '>static PyObject *__pyx_pw_3nes_6cycore_3ppu_6NESPPU_11debug_render_tile(PyObject *__pyx_v_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static void __pyx_f_3nes_6cycore_3ppu_6NESPPU_debug_render_tile(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self, __Pyx_memviewslice __pyx_v_dest, int __pyx_v_x0, int __pyx_v_y0, int __pyx_v_tile_index, int __pyx_v_tile_bank, int __pyx_v_palette_id, int __pyx_v_flip_h, int __pyx_v_flip_v, int __pyx_skip_dispatch) {
  int __pyx_v_x;
  int __pyx_v_y;
  int __pyx_v_xx;
  int __pyx_v_yy;
  int __pyx_v_pixel_color_ix;
  int __pyx_v_plane;
  int __pyx_v_table_base;
  int __pyx_v_tile_base;
  int __pyx_v_palette[4];
  /* Check if called by wrapper */
  if (unlikely(__pyx_skip_dispatch)) ;
  /* Check if overridden in Python */
  else if (
  #if !CYTHON_USE_TYPE_SLOTS
  unlikely(Py_TYPE(((PyObject *)__pyx_v_self)) != __pyx_mstate_global-&gt;__pyx_ptype_3nes_6cycore_3ppu_NESPPU &amp;&amp;
  <span class='pyx_c_api'>__Pyx_PyType_HasFeature</span>(Py_TYPE(((PyObject *)__pyx_v_self)), Py_TPFLAGS_HAVE_GC))
  #else
  unlikely(Py_TYPE(((PyObject *)__pyx_v_self))-&gt;tp_dictoffset != 0 || <span class='pyx_c_api'>__Pyx_PyType_HasFeature</span>(Py_TYPE(((PyObject *)__pyx_v_self)), (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))
  #endif
  ) {
    #if CYTHON_USE_DICT_VERSIONS &amp;&amp; CYTHON_USE_PYTYPE_LOOKUP &amp;&amp; CYTHON_USE_TYPE_SLOTS
    static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
    if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
      PY_UINT64_T __pyx_typedict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      #endif
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_self), __pyx_mstate_global-&gt;__pyx_n_u_debug_render_tile);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 811, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      if (!<span class='pyx_c_api'>__Pyx_IsSameCFunction</span>(__pyx_t_1, (void(*)(void)) __pyx_pw_3nes_6cycore_3ppu_6NESPPU_11debug_render_tile)) {
        __pyx_t_3 = NULL;
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
        __pyx_t_4 = __pyx_t_1; 
        if (unlikely(!__pyx_v_dest.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("dest"); <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L1_error)</span> }
        __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_dest, 2, (PyObject *(*)(char *)) __pyx_memview_get_unsigned_int, (int (*)(char *, PyObject *)) __pyx_memview_set_unsigned_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 811, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>(__pyx_v_x0);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 811, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>(__pyx_v_y0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 811, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>(__pyx_v_tile_index);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 811, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
        __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>(__pyx_v_tile_bank);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 811, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
        __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>(__pyx_v_palette_id);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 811, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(__pyx_v_flip_h);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 811, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(__pyx_v_flip_v);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 811, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
        __pyx_t_13 = 1;
        #if CYTHON_UNPACK_METHODS
        if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
          __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
          assert(__pyx_t_3);
          PyObject* __pyx__function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx__function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, __pyx__function);
          __pyx_t_13 = 0;
        }
        #endif
        {
          PyObject *__pyx_callargs[9] = {__pyx_t_3, __pyx_t_5, __pyx_t_6, __pyx_t_7, __pyx_t_8, __pyx_t_9, __pyx_t_10, __pyx_t_11, __pyx_t_12};
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_4, __pyx_callargs+__pyx_t_13, (9-__pyx_t_13) | (__pyx_t_13*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L0;
      }
      #if CYTHON_USE_DICT_VERSIONS &amp;&amp; CYTHON_USE_PYTYPE_LOOKUP &amp;&amp; CYTHON_USE_TYPE_SLOTS
      __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
      __pyx_obj_dict_version = __Pyx_get_object_dict_version(((PyObject *)__pyx_v_self));
      if (unlikely(__pyx_typedict_guard != __pyx_tp_dict_version)) {
        __pyx_tp_dict_version = __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
      }
      #endif
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      #if CYTHON_USE_DICT_VERSIONS &amp;&amp; CYTHON_USE_PYTYPE_LOOKUP &amp;&amp; CYTHON_USE_TYPE_SLOTS
    }
    #endif
  }
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.debug_render_tile", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_3nes_6cycore_3ppu_6NESPPU_11debug_render_tile(PyObject *__pyx_v_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_3nes_6cycore_3ppu_6NESPPU_10debug_render_tile, "\n        Decodes a tile given by tile_index from the pattern table specified by tile_bank to an array of RGB color value,\n        using the palette supplied.  Transparent pixels (value 0 in the tile) are replaced with self.transparent_color.\n        This makes them ready to be blitted to the screen.\n        ");
static PyMethodDef __pyx_mdef_3nes_6cycore_3ppu_6NESPPU_11debug_render_tile = {"debug_render_tile", (PyCFunction)(void(*)(void))(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_3nes_6cycore_3ppu_6NESPPU_11debug_render_tile, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_3nes_6cycore_3ppu_6NESPPU_10debug_render_tile};
static PyObject *__pyx_pw_3nes_6cycore_3ppu_6NESPPU_11debug_render_tile(PyObject *__pyx_v_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_dest = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_x0;
  int __pyx_v_y0;
  int __pyx_v_tile_index;
  int __pyx_v_tile_bank;
  int __pyx_v_palette_id;
  int __pyx_v_flip_h;
  int __pyx_v_flip_v;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("debug_render_tile (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_SIZE
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject ** const __pyx_pyargnames[] = {&amp;__pyx_mstate_global-&gt;__pyx_n_u_dest,&amp;__pyx_mstate_global-&gt;__pyx_n_u_x0,&amp;__pyx_mstate_global-&gt;__pyx_n_u_y0,&amp;__pyx_mstate_global-&gt;__pyx_n_u_tile_index,&amp;__pyx_mstate_global-&gt;__pyx_n_u_tile_bank,&amp;__pyx_mstate_global-&gt;__pyx_n_u_palette_id,&amp;__pyx_mstate_global-&gt;__pyx_n_u_flip_h,&amp;__pyx_mstate_global-&gt;__pyx_n_u_flip_v,0};
  PyObject* values[8] = {0,0,0,0,0,0,0,0};
    const Py_ssize_t __pyx_kwds_len = (__pyx_kwds) ? <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds) : 0;
    if (unlikely(__pyx_kwds_len) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
    if (__pyx_kwds_len &gt; 0) {
      switch (__pyx_nargs) {
        case  8:
        values[7] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 7);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[7])) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  7:
        values[6] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 6);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[6])) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  6:
        values[5] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 5);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[5])) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  5:
        values[4] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 4);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[4])) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  4:
        values[3] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 3);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[3])) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  3:
        values[2] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 2);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[2])) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  2:
        values[1] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 1);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[1])) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  1:
        values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 0);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      const Py_ssize_t kwd_pos_args = __pyx_nargs;
      if (<span class='pyx_c_api'>__Pyx_ParseKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values, kwd_pos_args, __pyx_kwds_len, "debug_render_tile", 0) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
      for (Py_ssize_t i = __pyx_nargs; i &lt; 8; i++) {
        if (unlikely(!values[i])) { <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("debug_render_tile", 1, 8, 8, i); <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span> }
      }
    } else if (unlikely(__pyx_nargs != 8)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 0);
      if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
      values[1] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 1);
      if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[1])) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
      values[2] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 2);
      if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[2])) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
      values[3] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 3);
      if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[3])) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
      values[4] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 4);
      if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[4])) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
      values[5] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 5);
      if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[5])) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
      values[6] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 6);
      if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[6])) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
      values[7] = <span class='pyx_c_api'>__Pyx_ArgRef_FASTCALL</span>(__pyx_args, 7);
      if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[7])) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
    }
    __pyx_v_dest = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_unsigned_int</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_dest.memview)) __PYX_ERR(0, 811, __pyx_L3_error)</span>
    __pyx_v_x0 = <span class='pyx_c_api'>__Pyx_PyLong_As_int</span>(values[1]); if (unlikely((__pyx_v_x0 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
    __pyx_v_y0 = <span class='pyx_c_api'>__Pyx_PyLong_As_int</span>(values[2]); if (unlikely((__pyx_v_y0 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
    __pyx_v_tile_index = <span class='pyx_c_api'>__Pyx_PyLong_As_int</span>(values[3]); if (unlikely((__pyx_v_tile_index == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
    __pyx_v_tile_bank = <span class='pyx_c_api'>__Pyx_PyLong_As_int</span>(values[4]); if (unlikely((__pyx_v_tile_bank == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
    __pyx_v_palette_id = <span class='pyx_c_api'>__Pyx_PyLong_As_int</span>(values[5]); if (unlikely((__pyx_v_palette_id == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
    __pyx_v_flip_h = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[6]); if (unlikely((__pyx_v_flip_h == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
    __pyx_v_flip_v = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[7]); if (unlikely((__pyx_v_flip_v == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("debug_render_tile", 1, 8, 8, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_dest, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.debug_render_tile", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3nes_6cycore_3ppu_6NESPPU_10debug_render_tile(((struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self), __pyx_v_dest, __pyx_v_x0, __pyx_v_y0, __pyx_v_tile_index, __pyx_v_tile_bank, __pyx_v_palette_id, __pyx_v_flip_h, __pyx_v_flip_v);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_dest, 1);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3nes_6cycore_3ppu_6NESPPU_10debug_render_tile(struct __pyx_obj_3nes_6cycore_3ppu_NESPPU *__pyx_v_self, __Pyx_memviewslice __pyx_v_dest, int __pyx_v_x0, int __pyx_v_y0, int __pyx_v_tile_index, int __pyx_v_tile_bank, int __pyx_v_palette_id, int __pyx_v_flip_h, int __pyx_v_flip_v) {
  PyObject *__pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  if (unlikely(!__pyx_v_dest.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("dest"); <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L1_error)</span> }
  __pyx_f_3nes_6cycore_3ppu_6NESPPU_debug_render_tile(__pyx_v_self, __pyx_v_dest, __pyx_v_x0, __pyx_v_y0, __pyx_v_tile_index, __pyx_v_tile_bank, __pyx_v_palette_id, __pyx_v_flip_h, __pyx_v_flip_v, 1);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 811, __pyx_L1_error)</span>
  __pyx_t_1 = __Pyx_void_to_None(NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 811, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.ppu.NESPPU.debug_render_tile", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_3nes_6cycore_3ppu_6NESPPU_11debug_render_tile, __Pyx_CYFUNCTION_CCLASS, __pyx_mstate_global-&gt;__pyx_n_u_NESPPU_debug_render_tile, NULL, __pyx_mstate_global-&gt;__pyx_n_u_nes_cycore_ppu, __pyx_mstate_global-&gt;__pyx_d, ((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[5]));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 811, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  if (<span class='pyx_c_api'>__Pyx_SetItemOnTypeDict</span>(__pyx_mstate_global-&gt;__pyx_ptype_3nes_6cycore_3ppu_NESPPU, __pyx_mstate_global-&gt;__pyx_n_u_debug_render_tile, __pyx_t_5) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 811, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">812</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">813</span>:         Decodes a tile given by tile_index from the pattern table specified by tile_bank to an array of RGB color value,</pre>
<pre class="cython line score-0">&#xA0;<span class="">814</span>:         using the palette supplied.  Transparent pixels (value 0 in the tile) are replaced with self.transparent_color.</pre>
<pre class="cython line score-0">&#xA0;<span class="">815</span>:         This makes them ready to be blitted to the screen.</pre>
<pre class="cython line score-0">&#xA0;<span class="">816</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">817</span>:         cdef int x=0, y=0, xx=0, yy=0, pixel_color_ix=0, plane=0, table_base=0, tile_base=0</pre>
<pre class='cython code score-0 '>  __pyx_v_x = 0;
  __pyx_v_y = 0;
  __pyx_v_xx = 0;
  __pyx_v_yy = 0;
  __pyx_v_pixel_color_ix = 0;
  __pyx_v_plane = 0;
  __pyx_v_table_base = 0;
  __pyx_v_tile_base = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">818</span>:         cdef int palette[4]</pre>
<pre class="cython line score-0">&#xA0;<span class="">819</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">820</span>:         if palette_id &gt; 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_14 = (__pyx_v_palette_id &gt; 0);
  if (__pyx_t_14) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">821</span>:             self.decode_palette(palette, palette_id, is_sprite=False)</pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_3nes_6cycore_3ppu_NESPPU *)__pyx_v_self-&gt;__pyx_vtab)-&gt;decode_palette(__pyx_v_self, __pyx_v_palette, __pyx_v_palette_id, 0);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 821, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">822</span>:         else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">823</span>:             palette[0] = 0x01</pre>
<pre class='cython code score-0 '>  /*else*/ {
    (__pyx_v_palette[0]) = 0x01;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">824</span>:             palette[1] = 0x11</pre>
<pre class='cython code score-0 '>    (__pyx_v_palette[1]) = 0x11;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">825</span>:             palette[2] = 0x21</pre>
<pre class='cython code score-0 '>    (__pyx_v_palette[2]) = 0x21;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">826</span>:             palette[3] = 0x31</pre>
<pre class='cython code score-0 '>    (__pyx_v_palette[3]) = 0x31;
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">827</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">828</span>:         # now decode the tile</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">829</span>:         table_base = tile_bank * 0x1000</pre>
<pre class='cython code score-0 '>  __pyx_v_table_base = (__pyx_v_tile_bank * 0x1000);
</pre><pre class="cython line score-0">&#xA0;<span class="">830</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">831</span>:         # tile index tells us which pattern table to read</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">832</span>:         tile_base = table_base + tile_index * PATTERN_SIZE_BYTES</pre>
<pre class='cython code score-0 '>  __pyx_v_tile_base = (__pyx_v_table_base + (__pyx_v_tile_index * __pyx_e_3nes_6cycore_3ppu_PATTERN_SIZE_BYTES));
</pre><pre class="cython line score-0">&#xA0;<span class="">833</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">834</span>:         # the (palettized) tile is stored as 2x8byte bit planes, each representing an 8x8 bitmap of depth 1 bit</pre>
<pre class="cython line score-0">&#xA0;<span class="">835</span>:         # tile here is indexed tile[row][column], *not* tile[x][y]</pre>
<pre class="cython line score-0">&#xA0;<span class="">836</span>:         #tile = [[0] * TILE_WIDTH_PX for _ in range(TILE_HEIGHT_PX)]</pre>
<pre class="cython line score-0">&#xA0;<span class="">837</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">838</span>:         for y in range(TILE_HEIGHT_PX):</pre>
<pre class='cython code score-0 '>  __pyx_t_15 = __pyx_e_3nes_6cycore_3ppu_TILE_HEIGHT_PX;
  __pyx_t_16 = __pyx_t_15;
  for (__pyx_t_17 = 0; __pyx_t_17 &lt; __pyx_t_16; __pyx_t_17+=1) {
    __pyx_v_y = __pyx_t_17;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">839</span>:             for x in range(TILE_WIDTH_PX):</pre>
<pre class='cython code score-0 '>    __pyx_t_18 = __pyx_e_3nes_6cycore_3ppu_TILE_WIDTH_PX;
    __pyx_t_19 = __pyx_t_18;
    for (__pyx_t_20 = 0; __pyx_t_20 &lt; __pyx_t_19; __pyx_t_20+=1) {
      __pyx_v_x = __pyx_t_20;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">840</span>:                 xx = x if not flip_h else TILE_WIDTH_PX - 1 - x</pre>
<pre class='cython code score-0 '>      __pyx_t_14 = (!__pyx_v_flip_h);
      if (__pyx_t_14) {
        __pyx_t_21 = __pyx_v_x;
      } else {
        __pyx_t_21 = ((__pyx_e_3nes_6cycore_3ppu_TILE_WIDTH_PX - 1) - __pyx_v_x);
      }
      __pyx_v_xx = __pyx_t_21;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">841</span>:                 yy = y if not flip_v else TILE_HEIGHT_PX - 1 - y</pre>
<pre class='cython code score-0 '>      __pyx_t_14 = (!__pyx_v_flip_v);
      if (__pyx_t_14) {
        __pyx_t_21 = __pyx_v_y;
      } else {
        __pyx_t_21 = ((__pyx_e_3nes_6cycore_3ppu_TILE_HEIGHT_PX - 1) - __pyx_v_y);
      }
      __pyx_v_yy = __pyx_t_21;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">842</span>:                 pixel_color_ix = 0</pre>
<pre class='cython code score-0 '>      __pyx_v_pixel_color_ix = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">843</span>:                 for plane in range(2):</pre>
<pre class='cython code score-0 '>      for (__pyx_t_22 = 0; __pyx_t_22 &lt; 2; __pyx_t_22+=1) {
        __pyx_v_plane = __pyx_t_22;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">844</span>:                     pixel_color_ix += ((self.vram.read(tile_base + plane * 8 + y) &amp; (0x1 &lt;&lt; (7 - x))) &gt; 0) * (plane + 1)</pre>
<pre class='cython code score-0 '>        __pyx_t_23 = ((struct __pyx_vtabstruct_3nes_6cycore_6memory_NESVRAM *)__pyx_v_self-&gt;vram-&gt;__pyx_base.__pyx_vtab)-&gt;__pyx_base.read(((struct __pyx_obj_3nes_6cycore_6memory_MemoryBase *)__pyx_v_self-&gt;vram), ((__pyx_v_tile_base + (__pyx_v_plane * 8)) + __pyx_v_y));<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 844, __pyx_L1_error)</span>
        __pyx_v_pixel_color_ix = (__pyx_v_pixel_color_ix + (((__pyx_t_23 &amp; (0x1 &lt;&lt; (7 - __pyx_v_x))) &gt; 0) * (__pyx_v_plane + 1)));
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">845</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">846</span>:                 if pixel_color_ix &gt; 0:</pre>
<pre class='cython code score-0 '>      __pyx_t_14 = (__pyx_v_pixel_color_ix &gt; 0);
      if (__pyx_t_14) {
/* … */
      }
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">847</span>:                     dest[x0 + xx, y0 + yy] = self.hex_palette[palette[pixel_color_ix]]</pre>
<pre class='cython code score-0 '>        __pyx_t_24 = (__pyx_v_x0 + __pyx_v_xx);
        __pyx_t_25 = (__pyx_v_y0 + __pyx_v_yy);
        if (__pyx_t_24 &lt; 0) __pyx_t_24 += __pyx_v_dest.shape[0];
        if (__pyx_t_25 &lt; 0) __pyx_t_25 += __pyx_v_dest.shape[1];
        *((unsigned int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_dest.data + __pyx_t_24 * __pyx_v_dest.strides[0]) ) + __pyx_t_25 * __pyx_v_dest.strides[1]) )) = (__pyx_v_self-&gt;hex_palette[(__pyx_v_palette[__pyx_v_pixel_color_ix])]);
</pre><pre class="cython line score-0">&#xA0;<span class="">848</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">849</span>: </pre>
</div></body></html>
