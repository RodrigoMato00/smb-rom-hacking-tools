<!DOCTYPE html>
<!-- Generated by Cython 3.1.6 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: carts.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { color: #000000; margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 3.1.6</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="carts.c">carts.c</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: # cython: profile=True, boundscheck=True, nonecheck=False, language_level=3</pre>
<pre class='cython code score-8 '>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_mstate_global-&gt;__pyx_d, __pyx_mstate_global-&gt;__pyx_n_u_test, __pyx_t_5) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: #import pyximport; pyximport.install()</pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">004</span>: import logging</pre>
<pre class='cython code score-8 '>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_ImportDottedModule</span>(__pyx_mstate_global-&gt;__pyx_n_u_logging, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_mstate_global-&gt;__pyx_d, __pyx_mstate_global-&gt;__pyx_n_u_logging, __pyx_t_5) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 4, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">005</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: DEF MIRROR_HORIZONTAL = (0, 0, 1, 1)</pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: DEF MIRROR_VERTICAL = (0, 1, 0, 1)</pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: DEF MIRROR_ONE_LOWER = (0, 0, 0, 0)</pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: DEF MIRROR_ONE_UPPER = (1, 1, 1, 1)</pre>
<pre class="cython line score-0">&#xA0;<span class="">010</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">011</span>: from .bitwise cimport bit_high</pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">013</span>: cdef class NESCart:</pre>
<pre class='cython code score-0 '>struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart {
  unsigned char (*read)(struct __pyx_obj_3nes_6cycore_5carts_NESCart *, int);
  void (*write)(struct __pyx_obj_3nes_6cycore_5carts_NESCart *, int, unsigned char);
  unsigned char (*read_ppu)(struct __pyx_obj_3nes_6cycore_5carts_NESCart *, int);
  void (*write_ppu)(struct __pyx_obj_3nes_6cycore_5carts_NESCart *, int, unsigned char);
  void (*irq_tick)(struct __pyx_obj_3nes_6cycore_5carts_NESCart *);
};
static struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart *__pyx_vtabptr_3nes_6cycore_5carts_NESCart;

</pre><pre class="cython line score-0">&#xA0;<span class="">014</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>:     NES Cartridge interface</pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>:     """</pre>
<pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">017</span>:     def __init__(self):</pre>
<pre class='cython code score-18 '>/* Python wrapper */
static int __pyx_pw_3nes_6cycore_5carts_7NESCart_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_3nes_6cycore_5carts_7NESCart_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__init__ (wrapper)", 0);
  #if CYTHON_ASSUME_SAFE_SIZE
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return -1;
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_VARARGS</span>(__pyx_args, __pyx_nargs);
  if (unlikely(__pyx_nargs &gt; 0)) { <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 0, 0, __pyx_nargs); return -1; }
  const Py_ssize_t __pyx_kwds_len = unlikely(__pyx_kwds) ? <span class='pyx_c_api'>__Pyx_NumKwargs_VARARGS</span>(__pyx_kwds) : 0;
  if (unlikely(__pyx_kwds_len &lt; 0)) return -1;
  if (unlikely(__pyx_kwds_len &gt; 0)) {<span class='pyx_c_api'>__Pyx_RejectKeywords</span>("__init__", __pyx_kwds); return -1;}
  __pyx_r = __pyx_pf_3nes_6cycore_5carts_7NESCart___init__(((struct __pyx_obj_3nes_6cycore_5carts_NESCart *)__pyx_v_self));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static int __pyx_pf_3nes_6cycore_5carts_7NESCart___init__(CYTHON_UNUSED struct __pyx_obj_3nes_6cycore_5carts_NESCart *__pyx_v_self) {
  int __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[22]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("__init__", __pyx_f[0], 17, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 17, __pyx_L1_error)</span>);

  /* function exit code */
  __pyx_r = 0;
  <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_Owned_Py_None, 0, 0, <span class='error_goto'>__PYX_ERR(0, 17, __pyx_L1_error)</span>);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 17, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">018</span>:         pass</pre>
<pre class="cython line score-0">&#xA0;<span class="">019</span>: </pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">020</span>:     cdef unsigned char read(self, int address):</pre>
<pre class='cython code score-7 '>static unsigned char __pyx_f_3nes_6cycore_5carts_7NESCart_read(CYTHON_UNUSED struct __pyx_obj_3nes_6cycore_5carts_NESCart *__pyx_v_self, CYTHON_UNUSED int __pyx_v_address) {
  unsigned char __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[23]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("read", __pyx_f[0], 20, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 20, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart.read", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">021</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">022</span>:         Read from cartridge memory attached to the CPU's memory bus at the (CPU) address specified</pre>
<pre class="cython line score-0">&#xA0;<span class="">023</span>:         """</pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">024</span>:         raise NotImplementedError()</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_NotImplementedError);
  __pyx_t_3 = __pyx_builtin_NotImplementedError; 
  __pyx_t_4 = 1;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, NULL};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+__pyx_t_4, (1-__pyx_t_4) | (__pyx_t_4*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  }
  <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">025</span>: </pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">026</span>:     cdef void write(self, int address, unsigned char value):</pre>
<pre class='cython code score-7 '>static void __pyx_f_3nes_6cycore_5carts_7NESCart_write(CYTHON_UNUSED struct __pyx_obj_3nes_6cycore_5carts_NESCart *__pyx_v_self, CYTHON_UNUSED int __pyx_v_address, CYTHON_UNUSED unsigned char __pyx_v_value) {
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[24]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("write", __pyx_f[0], 26, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 26, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 26, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart.write", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}
</pre><pre class="cython line score-0">&#xA0;<span class="">027</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">028</span>:         Write the given byte to cartridge memory attached to the CPU's memory bus at the (CPU) address specified</pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>:         """</pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">030</span>:         raise NotImplementedError()</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_NotImplementedError);
  __pyx_t_3 = __pyx_builtin_NotImplementedError; 
  __pyx_t_4 = 1;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, NULL};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+__pyx_t_4, (1-__pyx_t_4) | (__pyx_t_4*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 30, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  }
  <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='error_goto'>__PYX_ERR(0, 30, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">031</span>: </pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">032</span>:     cdef unsigned char read_ppu(self, int address):</pre>
<pre class='cython code score-7 '>static unsigned char __pyx_f_3nes_6cycore_5carts_7NESCart_read_ppu(CYTHON_UNUSED struct __pyx_obj_3nes_6cycore_5carts_NESCart *__pyx_v_self, CYTHON_UNUSED int __pyx_v_address) {
  unsigned char __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[25]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("read_ppu", __pyx_f[0], 32, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 32, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 32, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart.read_ppu", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">033</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">034</span>:         Read from cartridge memory attached to the PPU's memory bus (i.e. in the VRAM address space) at the address</pre>
<pre class="cython line score-0">&#xA0;<span class="">035</span>:         specified</pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>:         """</pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">037</span>:         raise NotImplementedError()</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_NotImplementedError);
  __pyx_t_3 = __pyx_builtin_NotImplementedError; 
  __pyx_t_4 = 1;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, NULL};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+__pyx_t_4, (1-__pyx_t_4) | (__pyx_t_4*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 37, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  }
  <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='error_goto'>__PYX_ERR(0, 37, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">038</span>: </pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">039</span>:     cdef void write_ppu(self, int address, unsigned char value):</pre>
<pre class='cython code score-7 '>static void __pyx_f_3nes_6cycore_5carts_7NESCart_write_ppu(CYTHON_UNUSED struct __pyx_obj_3nes_6cycore_5carts_NESCart *__pyx_v_self, CYTHON_UNUSED int __pyx_v_address, CYTHON_UNUSED unsigned char __pyx_v_value) {
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[26]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("write_ppu", __pyx_f[0], 39, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 39, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 39, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart.write_ppu", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}
</pre><pre class="cython line score-0">&#xA0;<span class="">040</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">041</span>:         Write a byte to the cartridge memory attached to the PPU's memory bus (i.e. in the VRAM address space) at the</pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>:         address specified</pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>:         """</pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">044</span>:         raise NotImplementedError()</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_NotImplementedError);
  __pyx_t_3 = __pyx_builtin_NotImplementedError; 
  __pyx_t_4 = 1;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, NULL};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+__pyx_t_4, (1-__pyx_t_4) | (__pyx_t_4*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 44, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  }
  <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='error_goto'>__PYX_ERR(0, 44, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">045</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">046</span>:     cdef void irq_tick(self):</pre>
<pre class='cython code score-4 '>static void __pyx_f_3nes_6cycore_5carts_7NESCart_irq_tick(CYTHON_UNUSED struct __pyx_obj_3nes_6cycore_5carts_NESCart *__pyx_v_self) {
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[27]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("irq_tick", __pyx_f[0], 46, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 46, __pyx_L1_error)</span>);

  /* function exit code */
  <span class='trace'>__Pyx_TraceReturnValue</span>(Py_None, 0, 0, <span class='error_goto'>__PYX_ERR(0, 46, __pyx_L1_error)</span>);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 46, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart.irq_tick", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
}
</pre><pre class="cython line score-0">&#xA0;<span class="">047</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">048</span>:         Function called on rising edges of PPU address line A12, which is used in some carts (MMC3 and derivatives) to</pre>
<pre class="cython line score-0">&#xA0;<span class="">049</span>:         tick an IRQ counter.  Carts without PPU triggered IRQ functionality can ignore this.</pre>
<pre class="cython line score-0">&#xA0;<span class="">050</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>:         pass</pre>
<pre class="cython line score-0">&#xA0;<span class="">052</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">053</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">054</span>: ### Mapper 0 (aka NROM) ################################################################################################</pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">056</span>: cdef class NESCart0(NESCart):</pre>
<pre class='cython code score-0 '>struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart0 {
  struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart __pyx_base;
};
static struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart0 *__pyx_vtabptr_3nes_6cycore_5carts_NESCart0;

</pre><pre class="cython line score-0">&#xA0;<span class="">057</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>:     Basic NES Cartridge (Type 0 / MMC0).  Consists of up to 8kB RAM, 32kB PRG ROM, 8kB CHR ROM</pre>
<pre class="cython line score-0">&#xA0;<span class="">059</span>:     """</pre>
<pre class="cython line score-31" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">060</span>:     def __init__(self,</pre>
<pre class='cython code score-31 '>/* Python wrapper */
static int __pyx_pw_3nes_6cycore_5carts_8NESCart0_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_3nes_6cycore_5carts_8NESCart0_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_prg_rom_data = 0;
  PyObject *__pyx_v_chr_rom_data = 0;
  PyObject *__pyx_v_prg_rom_writeable = 0;
  PyObject *__pyx_v_ram_size_kb = 0;
  PyObject *__pyx_v_nametable_mirror_pattern = 0;
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__init__ (wrapper)", 0);
  #if CYTHON_ASSUME_SAFE_SIZE
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return -1;
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_VARARGS</span>(__pyx_args, __pyx_nargs);
  {
    PyObject ** const __pyx_pyargnames[] = {&amp;__pyx_mstate_global-&gt;__pyx_n_u_prg_rom_data,&amp;__pyx_mstate_global-&gt;__pyx_n_u_chr_rom_data,&amp;__pyx_mstate_global-&gt;__pyx_n_u_prg_rom_writeable,&amp;__pyx_mstate_global-&gt;__pyx_n_u_ram_size_kb,&amp;__pyx_mstate_global-&gt;__pyx_n_u_nametable_mirror_pattern,0};
  PyObject* values[5] = {0,0,0,0,0};
    const Py_ssize_t __pyx_kwds_len = (__pyx_kwds) ? <span class='pyx_c_api'>__Pyx_NumKwargs_VARARGS</span>(__pyx_kwds) : 0;
    if (unlikely(__pyx_kwds_len) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 60, __pyx_L3_error)</span>
    if (__pyx_kwds_len &gt; 0) {
      switch (__pyx_nargs) {
        case  5:
        values[4] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 4);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[4])) <span class='error_goto'>__PYX_ERR(0, 60, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  4:
        values[3] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 3);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[3])) <span class='error_goto'>__PYX_ERR(0, 60, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  3:
        values[2] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 2);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[2])) <span class='error_goto'>__PYX_ERR(0, 60, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  2:
        values[1] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 1);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[1])) <span class='error_goto'>__PYX_ERR(0, 60, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  1:
        values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 0);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 60, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      const Py_ssize_t kwd_pos_args = __pyx_nargs;
      if (<span class='pyx_c_api'>__Pyx_ParseKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values, kwd_pos_args, __pyx_kwds_len, "__init__", 0) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 60, __pyx_L3_error)</span>
/* … */
  /* function exit code */
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static int __pyx_pf_3nes_6cycore_5carts_8NESCart0___init__(struct __pyx_obj_3nes_6cycore_5carts_NESCart0 *__pyx_v_self, PyObject *__pyx_v_prg_rom_data, PyObject *__pyx_v_chr_rom_data, PyObject *__pyx_v_prg_rom_writeable, PyObject *__pyx_v_ram_size_kb, PyObject *__pyx_v_nametable_mirror_pattern) {
  long __pyx_v_i;
  int __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[30]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("__init__", __pyx_f[0], 60, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 60, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_r = 0;
  <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_Owned_Py_None, 0, 0, <span class='error_goto'>__PYX_ERR(0, 60, __pyx_L1_error)</span>);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 60, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart0.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">061</span>:                  prg_rom_data=None,</pre>
<pre class='cython code score-4 '>      if (!values[0]) values[0] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
/* … */
      if (!values[0]) values[0] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">062</span>:                  chr_rom_data=None,</pre>
<pre class='cython code score-4 '>      if (!values[1]) values[1] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
/* … */
      if (!values[1]) values[1] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">063</span>:                  prg_rom_writeable=False,   # whether or not the program memory is ROM or RAM</pre>
<pre class='cython code score-8 '>      if (!values[2]) values[2] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_False));
      if (!values[3]) values[3] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_int_8));
/* … */
      if (!values[2]) values[2] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_False));
      if (!values[3]) values[3] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_int_8));
</pre><pre class="cython line score-0">&#xA0;<span class="">064</span>:                  ram_size_kb=8,</pre>
<pre class="cython line score-23" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">065</span>:                  nametable_mirror_pattern=(0, 0, 1, 1)</pre>
<pre class='cython code score-23 '>      if (!values[4]) values[4] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_tuple[2]));
    } else {
      switch (__pyx_nargs) {
        case  5:
        values[4] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 4);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[4])) <span class='error_goto'>__PYX_ERR(0, 60, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  4:
        values[3] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 3);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[3])) <span class='error_goto'>__PYX_ERR(0, 60, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  3:
        values[2] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 2);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[2])) <span class='error_goto'>__PYX_ERR(0, 60, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  2:
        values[1] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 1);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[1])) <span class='error_goto'>__PYX_ERR(0, 60, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  1:
        values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 0);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 60, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
/* … */
      if (!values[4]) values[4] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_tuple[2]));
    }
    __pyx_v_prg_rom_data = values[0];
    __pyx_v_chr_rom_data = values[1];
    __pyx_v_prg_rom_writeable = values[2];
    __pyx_v_ram_size_kb = values[3];
    __pyx_v_nametable_mirror_pattern = values[4];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 5, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 60, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart0.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3nes_6cycore_5carts_8NESCart0___init__(((struct __pyx_obj_3nes_6cycore_5carts_NESCart0 *)__pyx_v_self), __pyx_v_prg_rom_data, __pyx_v_chr_rom_data, __pyx_v_prg_rom_writeable, __pyx_v_ram_size_kb, __pyx_v_nametable_mirror_pattern);
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[2] = <span class='py_c_api'>PyTuple_Pack</span>(4, __pyx_mstate_global-&gt;__pyx_int_0, __pyx_mstate_global-&gt;__pyx_int_0, __pyx_mstate_global-&gt;__pyx_int_1, __pyx_mstate_global-&gt;__pyx_int_1); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[2])) <span class='error_goto'>__PYX_ERR(0, 65, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[2]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[2]);
</pre><pre class="cython line score-0">&#xA0;<span class="">066</span>:                  ):</pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">067</span>:         super().__init__()</pre>
<pre class='cython code score-11 '>  __pyx_t_4 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_super);
  __pyx_t_5 = __pyx_builtin_super; 
  __pyx_t_6 = 1;
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_4, ((PyObject *)__pyx_mstate_global-&gt;__pyx_ptype_3nes_6cycore_5carts_NESCart0), ((PyObject *)__pyx_v_self)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_5, __pyx_callargs+__pyx_t_6, (3-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 67, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  }
  __pyx_t_2 = __pyx_t_3;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
  __pyx_t_6 = 0;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, NULL};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCallMethod</span>(__pyx_mstate_global-&gt;__pyx_n_u_init, __pyx_callargs+__pyx_t_6, (1-__pyx_t_6) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 67, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">068</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">069</span>:         # initialize ram (this ram is on the CPU bus)</pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">070</span>:         if ram_size_kb not in [2, 4, 8]:</pre>
<pre class='cython code score-8 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_ram_size_kb);
  __pyx_t_1 = __pyx_v_ram_size_kb;
  __pyx_t_8 = (<span class='pyx_c_api'>__Pyx_PyLong_BoolNeObjC</span>(__pyx_t_1, __pyx_mstate_global-&gt;__pyx_int_2, 2, 0)); if (unlikely((__pyx_t_8 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L1_error)</span>
  if (__pyx_t_8) {
  } else {
    __pyx_t_7 = __pyx_t_8;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_8 = (<span class='pyx_c_api'>__Pyx_PyLong_BoolNeObjC</span>(__pyx_t_1, __pyx_mstate_global-&gt;__pyx_int_4, 4, 0)); if (unlikely((__pyx_t_8 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L1_error)</span>
  if (__pyx_t_8) {
  } else {
    __pyx_t_7 = __pyx_t_8;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_8 = (<span class='pyx_c_api'>__Pyx_PyLong_BoolNeObjC</span>(__pyx_t_1, __pyx_mstate_global-&gt;__pyx_int_8, 8, 0)); if (unlikely((__pyx_t_8 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L1_error)</span>
  __pyx_t_7 = __pyx_t_8;
  __pyx_L4_bool_binop_done:;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_8 = __pyx_t_7;
  if (unlikely(__pyx_t_8)) {
/* … */
  }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">071</span>:             raise ValueError("Cart 0 ram size should be exactly 2, 4 or 8kB")</pre>
<pre class='cython code score-8 '>    __pyx_t_3 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_ValueError);
    __pyx_t_2 = __pyx_builtin_ValueError; 
    __pyx_t_6 = 1;
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_mstate_global-&gt;__pyx_kp_u_Cart_0_ram_size_should_be_exactl};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_2, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 71, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    }
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='error_goto'>__PYX_ERR(0, 71, __pyx_L1_error)</span>
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">072</span>:         self.ram_size = ram_size_kb * 1024</pre>
<pre class='cython code score-10 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyLong_MultiplyObjC</span>(__pyx_v_ram_size_kb, __pyx_mstate_global-&gt;__pyx_int_1024, 0x400, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 72, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyLong_As_int</span>(__pyx_t_1); if (unlikely((__pyx_t_9 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 72, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self-&gt;ram_size = __pyx_t_9;
</pre><pre class="cython line score-0">&#xA0;<span class="">073</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">074</span>:         # initialize prg rom from supplied data  (CPU connected)</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">075</span>:         if prg_rom_data:</pre>
<pre class='cython code score-2 '>  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_prg_rom_data); if (unlikely((__pyx_t_8 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 75, __pyx_L1_error)</span>
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">076</span>:             # can use a None value to skip this initializing if calling from e.g. other mappers</pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">077</span>:             self.prg_rom_size = len(prg_rom_data)</pre>
<pre class='cython code score-5 '>    __pyx_t_10 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_prg_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 77, __pyx_L1_error)</span>
    __pyx_v_self-&gt;prg_rom_size = __pyx_t_10;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">078</span>:             if self.prg_rom_size not in [16 * 1024, 32 * 1024]:</pre>
<pre class='cython code score-0 '>    switch (__pyx_v_self-&gt;prg_rom_size) {
      case 0x4000:
      case 0x8000:
      __pyx_t_8 = 0;
      break;
      default:
      __pyx_t_8 = 1;
      break;
    }
    __pyx_t_7 = __pyx_t_8;
    if (unlikely(__pyx_t_7)) {
/* … */
    }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">079</span>:                 raise ValueError("Cart 0 program rom size should be exactly 16 or 32kB")</pre>
<pre class='cython code score-8 '>      __pyx_t_2 = NULL;
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_ValueError);
      __pyx_t_3 = __pyx_builtin_ValueError; 
      __pyx_t_6 = 1;
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_mstate_global-&gt;__pyx_kp_u_Cart_0_program_rom_size_should_b};
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 79, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      }
      <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='error_goto'>__PYX_ERR(0, 79, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">080</span>:             for i in range(self.prg_rom_size):</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = __pyx_v_self-&gt;prg_rom_size;
    __pyx_t_11 = __pyx_t_9;
    for (__pyx_t_12 = 0; __pyx_t_12 &lt; __pyx_t_11; __pyx_t_12+=1) {
      __pyx_v_i = __pyx_t_12;
</pre><pre class="cython line score-0">&#xA0;<span class="">081</span>:                 # could use e.g. memcpy, but this syntax is clearer and don't care about speed here</pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">082</span>:                 self.prg_rom[i] = prg_rom_data[i]   # copy prg rom data into the prg ROM</pre>
<pre class='cython code score-10 '>      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_prg_rom_data, __pyx_v_i, long, 1, __Pyx_PyLong_From_long, 0, 1, 1, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyLong_As_unsigned_char</span>(__pyx_t_1); if (unlikely((__pyx_t_13 == (unsigned char)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 82, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      (__pyx_v_self-&gt;prg_rom[__pyx_v_i]) = __pyx_t_13;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">083</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">084</span>:         # initialize chr rom from supplied data (or create empty RAM if no data supplied)</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">085</span>:         if chr_rom_data:</pre>
<pre class='cython code score-2 '>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_chr_rom_data); if (unlikely((__pyx_t_7 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 85, __pyx_L1_error)</span>
  if (__pyx_t_7) {
/* … */
    goto __pyx_L11;
  }
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">086</span>:             if len(chr_rom_data) != M0_CHR_MEM_SIZE:</pre>
<pre class='cython code score-5 '>    __pyx_t_10 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_chr_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 86, __pyx_L1_error)</span>
    __pyx_t_7 = (__pyx_t_10 != __pyx_e_3nes_6cycore_5carts_M0_CHR_MEM_SIZE);
    if (unlikely(__pyx_t_7)) {
/* … */
    }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">087</span>:                 raise ValueError("Cart 0 chr rom size should be exactly 8kB")</pre>
<pre class='cython code score-8 '>      __pyx_t_3 = NULL;
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_ValueError);
      __pyx_t_2 = __pyx_builtin_ValueError; 
      __pyx_t_6 = 1;
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_mstate_global-&gt;__pyx_kp_u_Cart_0_chr_rom_size_should_be_ex};
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_2, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 87, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      }
      <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='error_goto'>__PYX_ERR(0, 87, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">088</span>:             for i in range(M0_CHR_MEM_SIZE):</pre>
<pre class='cython code score-0 '>    __pyx_t_14 = __pyx_e_3nes_6cycore_5carts_M0_CHR_MEM_SIZE;
    __pyx_t_15 = __pyx_t_14;
    for (__pyx_t_12 = 0; __pyx_t_12 &lt; __pyx_t_15; __pyx_t_12+=1) {
      __pyx_v_i = __pyx_t_12;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">089</span>:                 self.chr_mem[i] = chr_rom_data[i]</pre>
<pre class='cython code score-10 '>      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_chr_rom_data, __pyx_v_i, long, 1, __Pyx_PyLong_From_long, 0, 1, 1, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 89, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyLong_As_unsigned_char</span>(__pyx_t_1); if (unlikely((__pyx_t_13 == (unsigned char)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 89, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      (__pyx_v_self-&gt;chr_mem[__pyx_v_i]) = __pyx_t_13;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">090</span>:             # ROM data was supplied, so this is a ROM chip and is not writeable</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">091</span>:             self.chr_mem_writeable = False</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;chr_mem_writeable = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">092</span>:         else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">093</span>:             # if no chr_rom_data is supplied, chr_mem should be a RAM chip</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">094</span>:             self.chr_mem_writeable = True</pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_v_self-&gt;chr_mem_writeable = 1;
  }
  __pyx_L11:;
</pre><pre class="cython line score-0">&#xA0;<span class="">095</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">096</span>:         self.prg_start_addr = PRG_ROM_START</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;prg_start_addr = __pyx_e_3nes_6cycore_5carts_PRG_ROM_START;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">097</span>:         for i in range(4):</pre>
<pre class='cython code score-0 '>  for (__pyx_t_12 = 0; __pyx_t_12 &lt; 4; __pyx_t_12+=1) {
    __pyx_v_i = __pyx_t_12;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">098</span>:             self.nametable_mirror_pattern[i] = nametable_mirror_pattern[i]</pre>
<pre class='cython code score-10 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_nametable_mirror_pattern, __pyx_v_i, long, 1, __Pyx_PyLong_From_long, 0, 1, 1, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 98, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyLong_As_int</span>(__pyx_t_1); if (unlikely((__pyx_t_9 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 98, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    (__pyx_v_self-&gt;__pyx_base.nametable_mirror_pattern[__pyx_v_i]) = __pyx_t_9;
  }
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">099</span>:         self.prg_rom_writeable = prg_rom_writeable</pre>
<pre class='cython code score-7 '>  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyLong_As_int</span>(__pyx_v_prg_rom_writeable); if (unlikely((__pyx_t_9 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 99, __pyx_L1_error)</span>
  __pyx_v_self-&gt;prg_rom_writeable = __pyx_t_9;
</pre><pre class="cython line score-0">&#xA0;<span class="">100</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">101</span>:     cdef unsigned char read(self, int address):</pre>
<pre class='cython code score-4 '>static unsigned char __pyx_f_3nes_6cycore_5carts_8NESCart0_read(struct __pyx_obj_3nes_6cycore_5carts_NESCart0 *__pyx_v_self, int __pyx_v_address) {
  unsigned char __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[31]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("read", __pyx_f[0], 101, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 101, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 101, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart0.read", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">102</span>:         if address &lt; PRG_ROM_START:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_address &lt; __pyx_e_3nes_6cycore_5carts_PRG_ROM_START);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">103</span>:             # RAM access</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">104</span>:             return self.ram[address % self.ram_size]</pre>
<pre class='cython code score-0 '>    __pyx_r = (__pyx_v_self-&gt;ram[(__pyx_v_address % __pyx_v_self-&gt;ram_size)]);
    <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_PyLong_From_unsigned_char, 5, 0, <span class='error_goto'>__PYX_ERR(0, 104, __pyx_L1_error)</span>);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">105</span>:         else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">106</span>:             # program ROM access</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">107</span>:             return self.prg_rom[address % self.prg_rom_size]</pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_r = (__pyx_v_self-&gt;prg_rom[(__pyx_v_address % __pyx_v_self-&gt;prg_rom_size)]);
    <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_PyLong_From_unsigned_char, 13, 0, <span class='error_goto'>__PYX_ERR(0, 107, __pyx_L1_error)</span>);
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">108</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">109</span>:     cdef void write(self, int address, unsigned char value):</pre>
<pre class='cython code score-4 '>static void __pyx_f_3nes_6cycore_5carts_8NESCart0_write(struct __pyx_obj_3nes_6cycore_5carts_NESCart0 *__pyx_v_self, int __pyx_v_address, unsigned char __pyx_v_value) {
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[32]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("write", __pyx_f[0], 109, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 109, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  <span class='trace'>__Pyx_TraceReturnValue</span>(Py_None, 0, 0, <span class='error_goto'>__PYX_ERR(0, 109, __pyx_L1_error)</span>);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 109, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart0.write", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">110</span>:         if address &lt; PRG_ROM_START:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_address &lt; __pyx_e_3nes_6cycore_5carts_PRG_ROM_START);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">111</span>:             # RAM access</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">112</span>:             self.ram[address % self.ram_size] = value</pre>
<pre class='cython code score-0 '>    (__pyx_v_self-&gt;ram[(__pyx_v_address % __pyx_v_self-&gt;ram_size)]) = __pyx_v_value;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">113</span>:         elif self.prg_rom_writeable:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_self-&gt;prg_rom_writeable != 0);
  if (__pyx_t_1) {
/* … */
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">114</span>:             # program ROM access (but only if allowed to be written, otherwise ignored)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">115</span>:             self.prg_rom[address % self.prg_rom_size] = value</pre>
<pre class='cython code score-0 '>    (__pyx_v_self-&gt;prg_rom[(__pyx_v_address % __pyx_v_self-&gt;prg_rom_size)]) = __pyx_v_value;
</pre><pre class="cython line score-0">&#xA0;<span class="">116</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">117</span>:     cdef unsigned char read_ppu(self, int address):</pre>
<pre class='cython code score-4 '>static unsigned char __pyx_f_3nes_6cycore_5carts_8NESCart0_read_ppu(struct __pyx_obj_3nes_6cycore_5carts_NESCart0 *__pyx_v_self, int __pyx_v_address) {
  unsigned char __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[33]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("read_ppu", __pyx_f[0], 117, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 117, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 117, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart0.read_ppu", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">118</span>:         return self.chr_mem[address % M0_CHR_MEM_SIZE]</pre>
<pre class='cython code score-0 '>  __pyx_r = (__pyx_v_self-&gt;chr_mem[(__pyx_v_address % __pyx_e_3nes_6cycore_5carts_M0_CHR_MEM_SIZE)]);
  <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_PyLong_From_unsigned_char, 1, 0, <span class='error_goto'>__PYX_ERR(0, 118, __pyx_L1_error)</span>);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">119</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">120</span>:     cdef void write_ppu(self, int address, unsigned char value):</pre>
<pre class='cython code score-4 '>static void __pyx_f_3nes_6cycore_5carts_8NESCart0_write_ppu(struct __pyx_obj_3nes_6cycore_5carts_NESCart0 *__pyx_v_self, int __pyx_v_address, unsigned char __pyx_v_value) {
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[34]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("write_ppu", __pyx_f[0], 120, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 120, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  <span class='trace'>__Pyx_TraceReturnValue</span>(Py_None, 0, 0, <span class='error_goto'>__PYX_ERR(0, 120, __pyx_L1_error)</span>);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 120, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart0.write_ppu", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">121</span>:         if self.chr_mem_writeable:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_self-&gt;chr_mem_writeable != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">122</span>:             self.chr_mem[address % M0_CHR_MEM_SIZE] = value</pre>
<pre class='cython code score-0 '>    (__pyx_v_self-&gt;chr_mem[(__pyx_v_address % __pyx_e_3nes_6cycore_5carts_M0_CHR_MEM_SIZE)]) = __pyx_v_value;
</pre><pre class="cython line score-0">&#xA0;<span class="">123</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">124</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>: ### Mapper 1 (aka MMC1, SxROM) #########################################################################################</pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">127</span>: cdef class NESCart1(NESCart):</pre>
<pre class='cython code score-0 '>struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart1 {
  struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart __pyx_base;
  void (*_write_shift)(struct __pyx_obj_3nes_6cycore_5carts_NESCart1 *, int, unsigned char);
  void (*_set_nametable_mirror_pattern)(struct __pyx_obj_3nes_6cycore_5carts_NESCart1 *);
  int (*_get_chr_bank)(struct __pyx_obj_3nes_6cycore_5carts_NESCart1 *, int);
};
static struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart1 *__pyx_vtabptr_3nes_6cycore_5carts_NESCart1;

</pre><pre class="cython line score-0">&#xA0;<span class="">128</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">129</span>:     NES Cartridge type 1 (MMC1).  Common cartridge with bank-switched prg and chr rom.  Controlled by an internal shift</pre>
<pre class="cython line score-0">&#xA0;<span class="">130</span>:     register that writes one of four five-bit internal registers (ctrl, prg_bank, chr_bank[2]) depending on the address</pre>
<pre class="cython line score-0">&#xA0;<span class="">131</span>:     of the fifth write.</pre>
<pre class="cython line score-0">&#xA0;<span class="">132</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">133</span>:     There are several MMC1 variants!  Not sure how to tell these all of these apart from iNES v1 header...</pre>
<pre class="cython line score-0">&#xA0;<span class="">134</span>:         MMC1A always has PRG RAM enabled</pre>
<pre class="cython line score-0">&#xA0;<span class="">135</span>:         MMC1B has PRG RAM enabled by default</pre>
<pre class="cython line score-0">&#xA0;<span class="">136</span>:         MMC1C has PRG RAM disabled by default</pre>
<pre class="cython line score-0">&#xA0;<span class="">137</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">138</span>:     Of the many MMC1 (SxROM) variants [4], a few have unusual properties that require additional modelling:</pre>
<pre class="cython line score-0">&#xA0;<span class="">139</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">140</span>:         - SOROM, SXROM and SZROM have bank switched RAM, and of these, only SOROM was available outside Japan [4].</pre>
<pre class="cython line score-0">&#xA0;<span class="">141</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">142</span>:         - SOROM has 16kb of PRG RAM (2 banks); bank selection is by bit 3 of the chr_bank register</pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>:           - this is the only bank-switched prg_ram variant supported at present</pre>
<pre class="cython line score-0">&#xA0;<span class="">144</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">145</span>:         - SXROM only has two Japan only games [5] and so it is not supported</pre>
<pre class="cython line score-0">&#xA0;<span class="">146</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>:         - SUROM has 512kb PRG ROM</pre>
<pre class="cython line score-0">&#xA0;<span class="">148</span>:            - there are only two games listed for this config in the cart database [2], and only a couple in the list [3]</pre>
<pre class="cython line score-0">&#xA0;<span class="">149</span>:              therefore, it is not (yet?) supported</pre>
<pre class="cython line score-0">&#xA0;<span class="">150</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">151</span>:         - SZROM (not implemented) has a different control bit for PRG RAM</pre>
<pre class="cython line score-0">&#xA0;<span class="">152</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">153</span>:     References:</pre>
<pre class="cython line score-0">&#xA0;<span class="">154</span>:         [1] https://wiki.nesdev.com/w/index.php/MMC1</pre>
<pre class="cython line score-0">&#xA0;<span class="">155</span>:         [2] http://bootgod.dyndns.org:7777/</pre>
<pre class="cython line score-0">&#xA0;<span class="">156</span>:         [3] http://tuxnes.sourceforge.net/nesmapper.txt</pre>
<pre class="cython line score-0">&#xA0;<span class="">157</span>:         [4] https://wiki.nesdev.com/w/index.php/SxROM</pre>
<pre class="cython line score-0">&#xA0;<span class="">158</span>:         [5] http://bootgod.dyndns.org:7777/search.php?unif_op=LIKE+`%25%40%25`&amp;unif=SXROM</pre>
<pre class="cython line score-0">&#xA0;<span class="">159</span>:     """</pre>
<pre class="cython line score-35" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">160</span>:     def __init__(self,</pre>
<pre class='cython code score-35 '>/* Python wrapper */
static int __pyx_pw_3nes_6cycore_5carts_8NESCart1_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_3nes_6cycore_5carts_8NESCart1_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_prg_rom_data = 0;
  PyObject *__pyx_v_chr_rom_data = 0;
  PyObject *__pyx_v_chr_mem_writeable = 0;
  PyObject *__pyx_v_prg_ram_size_kb = 0;
  PyObject *__pyx_v_nametable_mirror_pattern = 0;
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__init__ (wrapper)", 0);
  #if CYTHON_ASSUME_SAFE_SIZE
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return -1;
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_VARARGS</span>(__pyx_args, __pyx_nargs);
  {
    PyObject ** const __pyx_pyargnames[] = {&amp;__pyx_mstate_global-&gt;__pyx_n_u_prg_rom_data,&amp;__pyx_mstate_global-&gt;__pyx_n_u_chr_rom_data,&amp;__pyx_mstate_global-&gt;__pyx_n_u_chr_mem_writeable,&amp;__pyx_mstate_global-&gt;__pyx_n_u_prg_ram_size_kb,&amp;__pyx_mstate_global-&gt;__pyx_n_u_nametable_mirror_pattern,0};
  PyObject* values[5] = {0,0,0,0,0};
    const Py_ssize_t __pyx_kwds_len = (__pyx_kwds) ? <span class='pyx_c_api'>__Pyx_NumKwargs_VARARGS</span>(__pyx_kwds) : 0;
    if (unlikely(__pyx_kwds_len) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L3_error)</span>
    if (__pyx_kwds_len &gt; 0) {
      switch (__pyx_nargs) {
        case  5:
        values[4] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 4);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[4])) <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  4:
        values[3] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 3);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[3])) <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  3:
        values[2] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 2);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[2])) <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  2:
        values[1] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 1);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[1])) <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  1:
        values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 0);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      const Py_ssize_t kwd_pos_args = __pyx_nargs;
      if (<span class='pyx_c_api'>__Pyx_ParseKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values, kwd_pos_args, __pyx_kwds_len, "__init__", 0) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L3_error)</span>
/* … */
  /* function exit code */
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static int __pyx_pf_3nes_6cycore_5carts_8NESCart1___init__(struct __pyx_obj_3nes_6cycore_5carts_NESCart1 *__pyx_v_self, PyObject *__pyx_v_prg_rom_data, PyObject *__pyx_v_chr_rom_data, PyObject *__pyx_v_chr_mem_writeable, PyObject *__pyx_v_prg_ram_size_kb, PyObject *__pyx_v_nametable_mirror_pattern) {
  PyObject *__pyx_v_bnk = NULL;
  PyObject *__pyx_v_i = NULL;
  int __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[37]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("__init__", __pyx_f[0], 160, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_r = 0;
  <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_Owned_Py_None, 0, 0, <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L1_error)</span>);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart1.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_bnk);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">161</span>:                  prg_rom_data=None,</pre>
<pre class='cython code score-4 '>      if (!values[0]) values[0] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
/* … */
      if (!values[0]) values[0] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">162</span>:                  chr_rom_data=None,</pre>
<pre class='cython code score-4 '>      if (!values[1]) values[1] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
/* … */
      if (!values[1]) values[1] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">163</span>:                  chr_mem_writeable=False, # if True, the CHR memory is actually RAM, not ROM</pre>
<pre class='cython code score-8 '>      if (!values[2]) values[2] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_False));
      if (!values[3]) values[3] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_int_8));
/* … */
      if (!values[2]) values[2] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_False));
      if (!values[3]) values[3] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_int_8));
</pre><pre class="cython line score-0">&#xA0;<span class="">164</span>:                  prg_ram_size_kb=8,       # size of prg RAM; must be in 8kb multiples, can be 0. RAM is at 0x6000-0x7FFF</pre>
<pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">165</span>:                  nametable_mirror_pattern=MIRROR_HORIZONTAL,</pre>
<pre class='cython code score-18 '>      if (!values[4]) values[4] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_tuple[2]));
    } else {
      switch (__pyx_nargs) {
        case  5:
        values[4] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 4);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[4])) <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  4:
        values[3] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 3);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[3])) <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  3:
        values[2] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 2);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[2])) <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  2:
        values[1] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 1);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[1])) <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  1:
        values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 0);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
/* … */
      if (!values[4]) values[4] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_tuple[2]));
    }
    __pyx_v_prg_rom_data = values[0];
    __pyx_v_chr_rom_data = values[1];
    __pyx_v_chr_mem_writeable = values[2];
    __pyx_v_prg_ram_size_kb = values[3];
    __pyx_v_nametable_mirror_pattern = values[4];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 5, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart1.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3nes_6cycore_5carts_8NESCart1___init__(((struct __pyx_obj_3nes_6cycore_5carts_NESCart1 *)__pyx_v_self), __pyx_v_prg_rom_data, __pyx_v_chr_rom_data, __pyx_v_chr_mem_writeable, __pyx_v_prg_ram_size_kb, __pyx_v_nametable_mirror_pattern);
</pre><pre class="cython line score-0">&#xA0;<span class="">166</span>:                 ):</pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">167</span>:         super().__init__()</pre>
<pre class='cython code score-11 '>  __pyx_t_4 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_super);
  __pyx_t_5 = __pyx_builtin_super; 
  __pyx_t_6 = 1;
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_4, ((PyObject *)__pyx_mstate_global-&gt;__pyx_ptype_3nes_6cycore_5carts_NESCart1), ((PyObject *)__pyx_v_self)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_5, __pyx_callargs+__pyx_t_6, (3-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 167, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  }
  __pyx_t_2 = __pyx_t_3;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
  __pyx_t_6 = 0;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, NULL};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCallMethod</span>(__pyx_mstate_global-&gt;__pyx_n_u_init, __pyx_callargs+__pyx_t_6, (1-__pyx_t_6) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 167, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">168</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">169</span>:         # copy the prg rom data to the memory banks</pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">170</span>:         self.num_prg_banks = int(len(prg_rom_data) / M1_PRG_ROM_BANK_SIZE)</pre>
<pre class='cython code score-5 '>  __pyx_t_7 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_prg_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 170, __pyx_L1_error)</span>
  __pyx_v_self-&gt;num_prg_banks = ((int)(__pyx_t_7 / ((Py_ssize_t)__pyx_e_3nes_6cycore_5carts_M1_PRG_ROM_BANK_SIZE)));
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">171</span>:         if self.num_prg_banks * M1_PRG_ROM_BANK_SIZE != len(prg_rom_data):</pre>
<pre class='cython code score-5 '>  __pyx_t_7 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_prg_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  __pyx_t_8 = ((__pyx_v_self-&gt;num_prg_banks * __pyx_e_3nes_6cycore_5carts_M1_PRG_ROM_BANK_SIZE) != __pyx_t_7);
  if (unlikely(__pyx_t_8)) {
/* … */
  }
</pre><pre class="cython line score-27" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">172</span>:             raise ValueError("prg_rom_data size ({} bytes) is not an exact multiple of bank size ({} bytes)".format(len(prg_rom_data), M1_PRG_ROM_BANK_SIZE))</pre>
<pre class='cython code score-27 '>    __pyx_t_3 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_ValueError);
    __pyx_t_2 = __pyx_builtin_ValueError; 
    __pyx_t_4 = __pyx_mstate_global-&gt;__pyx_kp_u_prg_rom_data_size_bytes_is_not_a;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
    __pyx_t_7 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_prg_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 172, __pyx_L1_error)</span>
    __pyx_t_9 = <span class='py_c_api'>PyLong_FromSsize_t</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyLong_From___pyx_anon_enum</span>(__pyx_e_3nes_6cycore_5carts_M1_PRG_ROM_BANK_SIZE);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_6 = 0;
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_4, __pyx_t_9, __pyx_t_10};
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCallMethod</span>(__pyx_mstate_global-&gt;__pyx_n_u_format, __pyx_callargs+__pyx_t_6, (3-__pyx_t_6) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 172, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    }
    __pyx_t_6 = 1;
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_5};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_2, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 172, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    }
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='error_goto'>__PYX_ERR(0, 172, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">173</span>: </pre>
<pre class="cython line score-57" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">174</span>:         for bnk in range(self.num_prg_banks):</pre>
<pre class='cython code score-57 '>  __pyx_t_2 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_range);
  __pyx_t_5 = __pyx_builtin_range; 
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>(__pyx_v_self-&gt;num_prg_banks);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 174, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_6 = 1;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_t_3};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_5, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 174, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  }
  if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
    __pyx_t_5 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
    __pyx_t_7 = 0;
    __pyx_t_11 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_5 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 174, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_11 = (CYTHON_COMPILING_IN_LIMITED_API) ? PyIter_Next : <span class='pyx_c_api'>__Pyx_PyObject_GetIterNextFunc</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 174, __pyx_L1_error)</span>
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_11)) {
      if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5))) {
        {
          Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyList_GET_SIZE</span>(__pyx_t_5);
          #if !CYTHON_ASSUME_SAFE_SIZE
          if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 174, __pyx_L1_error)</span>
          #endif
          if (__pyx_t_7 &gt;= __pyx_temp) break;
        }
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyList_GetItemRef</span>(__pyx_t_5, __pyx_t_7);
        ++__pyx_t_7;
      } else {
        {
          Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyTuple_GET_SIZE</span>(__pyx_t_5);
          #if !CYTHON_ASSUME_SAFE_SIZE
          if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 174, __pyx_L1_error)</span>
          #endif
          if (__pyx_t_7 &gt;= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_NewRef</span>(<span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_5, __pyx_t_7));
        #else
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PySequence_ITEM</span>(__pyx_t_5, __pyx_t_7);
        #endif
        ++__pyx_t_7;
      }
      if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 174, __pyx_L1_error)</span>
    } else {
      __pyx_t_1 = __pyx_t_11(__pyx_t_5);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (unlikely(!<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='error_goto'>__PYX_ERR(0, 174, __pyx_L1_error)</span>
          <span class='py_c_api'>PyErr_Clear</span>();
        }
        break;
      }
    }
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_bnk, __pyx_t_1);
    __pyx_t_1 = 0;
/* … */
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-57" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">175</span>:             for i in range(M1_PRG_ROM_BANK_SIZE):</pre>
<pre class='cython code score-57 '>    __pyx_t_3 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_range);
    __pyx_t_2 = __pyx_builtin_range; 
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyLong_From___pyx_anon_enum</span>(__pyx_e_3nes_6cycore_5carts_M1_PRG_ROM_BANK_SIZE);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_6 = 1;
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_10};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_2, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    }
    if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      __pyx_t_2 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      __pyx_t_12 = 0;
      __pyx_t_13 = NULL;
    } else {
      __pyx_t_12 = -1; __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_13 = (CYTHON_COMPILING_IN_LIMITED_API) ? PyIter_Next : <span class='pyx_c_api'>__Pyx_PyObject_GetIterNextFunc</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    for (;;) {
      if (likely(!__pyx_t_13)) {
        if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2))) {
          {
            Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyList_GET_SIZE</span>(__pyx_t_2);
            #if !CYTHON_ASSUME_SAFE_SIZE
            if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
            #endif
            if (__pyx_t_12 &gt;= __pyx_temp) break;
          }
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyList_GetItemRef</span>(__pyx_t_2, __pyx_t_12);
          ++__pyx_t_12;
        } else {
          {
            Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyTuple_GET_SIZE</span>(__pyx_t_2);
            #if !CYTHON_ASSUME_SAFE_SIZE
            if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
            #endif
            if (__pyx_t_12 &gt;= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_NewRef</span>(<span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_12));
          #else
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PySequence_ITEM</span>(__pyx_t_2, __pyx_t_12);
          #endif
          ++__pyx_t_12;
        }
        if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
      } else {
        __pyx_t_1 = __pyx_t_13(__pyx_t_2);
        if (unlikely(!__pyx_t_1)) {
          PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
          if (exc_type) {
            if (unlikely(!<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
            <span class='py_c_api'>PyErr_Clear</span>();
          }
          break;
        }
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_i, __pyx_t_1);
      __pyx_t_1 = 0;
/* … */
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">176</span>:                 self.banked_prg_rom[bnk][i] = prg_rom_data[bnk * M1_PRG_ROM_BANK_SIZE + i]</pre>
<pre class='cython code score-39 '>      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyLong_From___pyx_anon_enum</span>(__pyx_e_3nes_6cycore_5carts_M1_PRG_ROM_BANK_SIZE);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 176, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_bnk, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 176, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_10, __pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 176, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(__pyx_v_prg_rom_data, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 176, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyLong_As_unsigned_char</span>(__pyx_t_10); if (unlikely((__pyx_t_14 == (unsigned char)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 176, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_bnk); if (unlikely((__pyx_t_15 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 176, __pyx_L1_error)</span>
      __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_i); if (unlikely((__pyx_t_16 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 176, __pyx_L1_error)</span>
      ((__pyx_v_self-&gt;banked_prg_rom[__pyx_t_15])[__pyx_t_16]) = __pyx_t_14;
</pre><pre class="cython line score-0">&#xA0;<span class="">177</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">178</span>:         if self.num_prg_banks &gt; M1_MAX_PRG_BANKS:</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = (__pyx_v_self-&gt;num_prg_banks &gt; __pyx_e_3nes_6cycore_5carts_M1_MAX_PRG_BANKS);
  if (unlikely(__pyx_t_8)) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">179</span>:             # this is a 512kb prg rom ROM</pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">180</span>:             raise ValueError("512kb MMC1 ROMs are not currently supported.  Sorry Dragon Warrior III/IV.")</pre>
<pre class='cython code score-8 '>    __pyx_t_2 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_ValueError);
    __pyx_t_10 = __pyx_builtin_ValueError; 
    __pyx_t_6 = 1;
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_mstate_global-&gt;__pyx_kp_u_512kb_MMC1_ROMs_are_not_currentl};
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_10, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 180, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    }
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_5, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='error_goto'>__PYX_ERR(0, 180, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">181</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">182</span>:         # copy the chr rom data to the memory banks</pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">183</span>:         self.num_chr_banks = int(len(chr_rom_data) / M1_CHR_ROM_BANK_SIZE)</pre>
<pre class='cython code score-5 '>  __pyx_t_7 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_chr_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 183, __pyx_L1_error)</span>
  __pyx_v_self-&gt;num_chr_banks = ((int)(__pyx_t_7 / ((Py_ssize_t)__pyx_e_3nes_6cycore_5carts_M1_CHR_ROM_BANK_SIZE)));
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">184</span>:         if self.num_chr_banks * M1_CHR_ROM_BANK_SIZE != len(chr_rom_data):</pre>
<pre class='cython code score-5 '>  __pyx_t_7 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_chr_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 184, __pyx_L1_error)</span>
  __pyx_t_8 = ((__pyx_v_self-&gt;num_chr_banks * __pyx_e_3nes_6cycore_5carts_M1_CHR_ROM_BANK_SIZE) != __pyx_t_7);
  if (unlikely(__pyx_t_8)) {
/* … */
  }
</pre><pre class="cython line score-27" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">185</span>:             raise ValueError("chr_rom_data size ({} bytes) is not an exact multiple of bank size ({} bytes)".format(len(chr_rom_data), M1_CHR_ROM_BANK_SIZE))</pre>
<pre class='cython code score-27 '>    __pyx_t_10 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_ValueError);
    __pyx_t_2 = __pyx_builtin_ValueError; 
    __pyx_t_3 = __pyx_mstate_global-&gt;__pyx_kp_u_chr_rom_data_size_bytes_is_not_a;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
    __pyx_t_7 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_chr_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 185, __pyx_L1_error)</span>
    __pyx_t_9 = <span class='py_c_api'>PyLong_FromSsize_t</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 185, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyLong_From___pyx_anon_enum</span>(__pyx_e_3nes_6cycore_5carts_M1_CHR_ROM_BANK_SIZE);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 185, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_6 = 0;
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_3, __pyx_t_9, __pyx_t_4};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCallMethod</span>(__pyx_mstate_global-&gt;__pyx_n_u_format, __pyx_callargs+__pyx_t_6, (3-__pyx_t_6) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 185, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    }
    __pyx_t_6 = 1;
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_t_1};
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_2, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 185, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    }
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_5, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='error_goto'>__PYX_ERR(0, 185, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">186</span>: </pre>
<pre class="cython line score-57" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">187</span>:         for bnk in range(self.num_chr_banks):</pre>
<pre class='cython code score-57 '>  __pyx_t_2 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_range);
  __pyx_t_1 = __pyx_builtin_range; 
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>(__pyx_v_self-&gt;num_chr_banks);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 187, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_6 = 1;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_t_10};
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_1, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 187, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  }
  if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_5)) {
    __pyx_t_1 = __pyx_t_5; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
    __pyx_t_7 = 0;
    __pyx_t_11 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 187, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_11 = (CYTHON_COMPILING_IN_LIMITED_API) ? PyIter_Next : <span class='pyx_c_api'>__Pyx_PyObject_GetIterNextFunc</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 187, __pyx_L1_error)</span>
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  for (;;) {
    if (likely(!__pyx_t_11)) {
      if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1))) {
        {
          Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyList_GET_SIZE</span>(__pyx_t_1);
          #if !CYTHON_ASSUME_SAFE_SIZE
          if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 187, __pyx_L1_error)</span>
          #endif
          if (__pyx_t_7 &gt;= __pyx_temp) break;
        }
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyList_GetItemRef</span>(__pyx_t_1, __pyx_t_7);
        ++__pyx_t_7;
      } else {
        {
          Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyTuple_GET_SIZE</span>(__pyx_t_1);
          #if !CYTHON_ASSUME_SAFE_SIZE
          if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 187, __pyx_L1_error)</span>
          #endif
          if (__pyx_t_7 &gt;= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_NewRef</span>(<span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_7));
        #else
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PySequence_ITEM</span>(__pyx_t_1, __pyx_t_7);
        #endif
        ++__pyx_t_7;
      }
      if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 187, __pyx_L1_error)</span>
    } else {
      __pyx_t_5 = __pyx_t_11(__pyx_t_1);
      if (unlikely(!__pyx_t_5)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (unlikely(!<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='error_goto'>__PYX_ERR(0, 187, __pyx_L1_error)</span>
          <span class='py_c_api'>PyErr_Clear</span>();
        }
        break;
      }
    }
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_bnk, __pyx_t_5);
    __pyx_t_5 = 0;
/* … */
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-57" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">188</span>:             for i in range(M1_CHR_ROM_BANK_SIZE):</pre>
<pre class='cython code score-57 '>    __pyx_t_10 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_range);
    __pyx_t_2 = __pyx_builtin_range; 
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyLong_From___pyx_anon_enum</span>(__pyx_e_3nes_6cycore_5carts_M1_CHR_ROM_BANK_SIZE);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 188, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_6 = 1;
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_t_4};
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_2, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 188, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    }
    if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_5)) {
      __pyx_t_2 = __pyx_t_5; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      __pyx_t_12 = 0;
      __pyx_t_13 = NULL;
    } else {
      __pyx_t_12 = -1; __pyx_t_2 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 188, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_13 = (CYTHON_COMPILING_IN_LIMITED_API) ? PyIter_Next : <span class='pyx_c_api'>__Pyx_PyObject_GetIterNextFunc</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 188, __pyx_L1_error)</span>
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    for (;;) {
      if (likely(!__pyx_t_13)) {
        if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2))) {
          {
            Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyList_GET_SIZE</span>(__pyx_t_2);
            #if !CYTHON_ASSUME_SAFE_SIZE
            if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 188, __pyx_L1_error)</span>
            #endif
            if (__pyx_t_12 &gt;= __pyx_temp) break;
          }
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyList_GetItemRef</span>(__pyx_t_2, __pyx_t_12);
          ++__pyx_t_12;
        } else {
          {
            Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyTuple_GET_SIZE</span>(__pyx_t_2);
            #if !CYTHON_ASSUME_SAFE_SIZE
            if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 188, __pyx_L1_error)</span>
            #endif
            if (__pyx_t_12 &gt;= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_NewRef</span>(<span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_12));
          #else
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PySequence_ITEM</span>(__pyx_t_2, __pyx_t_12);
          #endif
          ++__pyx_t_12;
        }
        if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 188, __pyx_L1_error)</span>
      } else {
        __pyx_t_5 = __pyx_t_13(__pyx_t_2);
        if (unlikely(!__pyx_t_5)) {
          PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
          if (exc_type) {
            if (unlikely(!<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='error_goto'>__PYX_ERR(0, 188, __pyx_L1_error)</span>
            <span class='py_c_api'>PyErr_Clear</span>();
          }
          break;
        }
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_i, __pyx_t_5);
      __pyx_t_5 = 0;
/* … */
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">189</span>:                 self.banked_chr_rom[bnk][i] = chr_rom_data[bnk * M1_CHR_ROM_BANK_SIZE + i]</pre>
<pre class='cython code score-39 '>      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyLong_From___pyx_anon_enum</span>(__pyx_e_3nes_6cycore_5carts_M1_CHR_ROM_BANK_SIZE);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 189, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_4 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_bnk, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 189, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_4, __pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 189, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(__pyx_v_chr_rom_data, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 189, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyLong_As_unsigned_char</span>(__pyx_t_4); if (unlikely((__pyx_t_14 == (unsigned char)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 189, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_bnk); if (unlikely((__pyx_t_16 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 189, __pyx_L1_error)</span>
      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_i); if (unlikely((__pyx_t_15 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 189, __pyx_L1_error)</span>
      ((__pyx_v_self-&gt;banked_chr_rom[__pyx_t_16])[__pyx_t_15]) = __pyx_t_14;
</pre><pre class="cython line score-0">&#xA0;<span class="">190</span>: </pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">191</span>:         self.chr_mem_writeable = chr_mem_writeable</pre>
<pre class='cython code score-7 '>  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_chr_mem_writeable); if (unlikely((__pyx_t_8 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 191, __pyx_L1_error)</span>
  __pyx_v_self-&gt;chr_mem_writeable = __pyx_t_8;
</pre><pre class="cython line score-0">&#xA0;<span class="">192</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">193</span>:         # todo is this the right thing to do here?</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">194</span>:         if self.num_chr_banks == 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = (__pyx_v_self-&gt;num_chr_banks == 0);
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">195</span>:             # if there is no chr rom, make an 8kb bank of ram</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">196</span>:             self.num_chr_banks = 2</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;num_chr_banks = 2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">197</span>:             self.chr_mem_writeable = True</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;chr_mem_writeable = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">198</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">199</span>:         # set the startup state of the cart</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">200</span>:         self.shift_ctr = 0  # shift counter, triggers when it reaches 5</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;shift_ctr = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">201</span>:         self.shift = 0      # shift register to accumulate writes to registers</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;shift = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">202</span>:         # there is only one prg bank switch, which can have one of three different effects depending on ctrl register</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">203</span>:         self.prg_bank = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;prg_bank = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">204</span>:         self.chr_bank[:] = [0, 0]  # two chr bank registers</pre>
<pre class='cython code score-0 '>  __pyx_t_17[0] = 0;
  __pyx_t_17[1] = 0;
  memcpy(&amp;(__pyx_v_self-&gt;chr_bank[0]), __pyx_t_17, sizeof(__pyx_v_self-&gt;chr_bank[0]) * (2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">205</span>:         self.prg_ram_bank = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;prg_ram_bank = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">206</span>:         self.ctrl = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;ctrl = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">207</span>: </pre>
<pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">208</span>:         self.num_prg_ram_banks = int(prg_ram_size_kb * BYTES_PER_KB / M1_PRG_RAM_BANK_SIZE)</pre>
<pre class='cython code score-25 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyLong_From___pyx_anon_enum</span>(__pyx_e_3nes_6cycore_5carts_BYTES_PER_KB);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_prg_ram_size_kb, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 208, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyLong_From___pyx_anon_enum</span>(__pyx_e_3nes_6cycore_5carts_M1_PRG_RAM_BANK_SIZE);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_t_2, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 208, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyLong_As_int</span>(__pyx_t_1); if (unlikely((__pyx_t_18 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 208, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self-&gt;num_prg_ram_banks = __pyx_t_18;
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">209</span>:         if self.num_prg_ram_banks * M1_PRG_RAM_BANK_SIZE != prg_ram_size_kb * BYTES_PER_KB:</pre>
<pre class='cython code score-20 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>((__pyx_v_self-&gt;num_prg_ram_banks * __pyx_e_3nes_6cycore_5carts_M1_PRG_RAM_BANK_SIZE));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 209, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyLong_From___pyx_anon_enum</span>(__pyx_e_3nes_6cycore_5carts_BYTES_PER_KB);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 209, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_prg_ram_size_kb, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 209, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_1, __pyx_t_2, Py_NE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 209, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_4); if (unlikely((__pyx_t_8 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 209, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(__pyx_t_8)) {
/* … */
  }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">210</span>:             raise ValueError("PRG RAM size must be a multiple of 8kb")</pre>
<pre class='cython code score-8 '>    __pyx_t_2 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_ValueError);
    __pyx_t_1 = __pyx_builtin_ValueError; 
    __pyx_t_6 = 1;
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_mstate_global-&gt;__pyx_kp_u_PRG_RAM_size_must_be_a_multiple};
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_1, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 210, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    }
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_4, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='error_goto'>__PYX_ERR(0, 210, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">211</span>:         if self.num_prg_ram_banks &gt; 2:</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = (__pyx_v_self-&gt;num_prg_ram_banks &gt; 2);
  if (unlikely(__pyx_t_8)) {
/* … */
  }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">212</span>:             raise ValueError("PRG RAM with more than two banks (&gt;16kb) is not supported.  This seems to be a rare format (SUROM or SXROM).")</pre>
<pre class='cython code score-8 '>    __pyx_t_1 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_ValueError);
    __pyx_t_2 = __pyx_builtin_ValueError; 
    __pyx_t_6 = 1;
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_mstate_global-&gt;__pyx_kp_u_PRG_RAM_with_more_than_two_banks};
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_2, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 212, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    }
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_4, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='error_goto'>__PYX_ERR(0, 212, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">213</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">214</span>:         # set the nametable mirror pattern</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">215</span>:         self.nametable_mirror_pattern[:] = nametable_mirror_pattern</pre>
<pre class='cython code score-0 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_v_nametable_mirror_pattern, __pyx_t_19, 4) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 215, __pyx_L1_error)</span>
  memcpy(&amp;(__pyx_v_self-&gt;__pyx_base.nametable_mirror_pattern[0]), __pyx_t_19, sizeof(__pyx_v_self-&gt;__pyx_base.nametable_mirror_pattern[0]) * (4));
</pre><pre class="cython line score-0">&#xA0;<span class="">216</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">217</span>:         # set the nametable mirror bits (bottom two) of ctrl to the correct value</pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">218</span>:         if tuple(nametable_mirror_pattern) == MIRROR_ONE_LOWER:</pre>
<pre class='cython code score-16 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PySequence_Tuple</span>(__pyx_v_nametable_mirror_pattern);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 218, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_4, __pyx_mstate_global-&gt;__pyx_tuple[3], Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 218, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_2); if (unlikely((__pyx_t_8 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 218, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_8) {
/* … */
    goto __pyx_L21;
  }
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[3] = <span class='py_c_api'>PyTuple_Pack</span>(4, __pyx_mstate_global-&gt;__pyx_int_0, __pyx_mstate_global-&gt;__pyx_int_0, __pyx_mstate_global-&gt;__pyx_int_0, __pyx_mstate_global-&gt;__pyx_int_0); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[3])) <span class='error_goto'>__PYX_ERR(0, 218, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[3]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[3]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">219</span>:             self.ctrl |= 0</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;ctrl = (__pyx_v_self-&gt;ctrl | 0);
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">220</span>:         elif tuple(nametable_mirror_pattern) == MIRROR_ONE_UPPER:</pre>
<pre class='cython code score-16 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PySequence_Tuple</span>(__pyx_v_nametable_mirror_pattern);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 220, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_2, __pyx_mstate_global-&gt;__pyx_tuple[4], Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 220, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_4); if (unlikely((__pyx_t_8 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 220, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_8) {
/* … */
    goto __pyx_L21;
  }
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[4] = <span class='py_c_api'>PyTuple_Pack</span>(4, __pyx_mstate_global-&gt;__pyx_int_1, __pyx_mstate_global-&gt;__pyx_int_1, __pyx_mstate_global-&gt;__pyx_int_1, __pyx_mstate_global-&gt;__pyx_int_1); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[4])) <span class='error_goto'>__PYX_ERR(0, 220, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[4]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[4]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">221</span>:             self.ctrl |= 1</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;ctrl = (__pyx_v_self-&gt;ctrl | 1);
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">222</span>:         elif tuple(nametable_mirror_pattern) == MIRROR_VERTICAL:</pre>
<pre class='cython code score-16 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PySequence_Tuple</span>(__pyx_v_nametable_mirror_pattern);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 222, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_4, __pyx_mstate_global-&gt;__pyx_tuple[5], Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 222, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_2); if (unlikely((__pyx_t_8 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 222, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_8) {
/* … */
    goto __pyx_L21;
  }
/* … */
  __pyx_mstate_global-&gt;__pyx_tuple[5] = <span class='py_c_api'>PyTuple_Pack</span>(4, __pyx_mstate_global-&gt;__pyx_int_0, __pyx_mstate_global-&gt;__pyx_int_1, __pyx_mstate_global-&gt;__pyx_int_0, __pyx_mstate_global-&gt;__pyx_int_1); if (unlikely(!__pyx_mstate_global-&gt;__pyx_tuple[5])) <span class='error_goto'>__PYX_ERR(0, 222, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[5]);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_mstate_global-&gt;__pyx_tuple[5]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">223</span>:             self.ctrl |= 2</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;ctrl = (__pyx_v_self-&gt;ctrl | 2);
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">224</span>:         elif tuple(nametable_mirror_pattern) == MIRROR_HORIZONTAL:</pre>
<pre class='cython code score-11 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PySequence_Tuple</span>(__pyx_v_nametable_mirror_pattern);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 224, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_2, __pyx_mstate_global-&gt;__pyx_tuple[2], Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 224, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_4); if (unlikely((__pyx_t_8 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_8) {
/* … */
  }
  __pyx_L21:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">225</span>:             self.ctrl |= 3</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;ctrl = (__pyx_v_self-&gt;ctrl | 3);
</pre><pre class="cython line score-0">&#xA0;<span class="">226</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">227</span>:         # sets the PRG ROM bank mode to 3 (fix last bank at 0xC000, switch 16kb bank at 0x8000)</pre>
<pre class="cython line score-0">&#xA0;<span class="">228</span>:         # see control register section in [1], which has a note on startup condition of ctrl</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">229</span>:         self.ctrl |= 0b00001100</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;ctrl = (__pyx_v_self-&gt;ctrl | 12);
</pre><pre class="cython line score-0">&#xA0;<span class="">230</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">231</span>:     cdef void write(self, int address, unsigned char value):</pre>
<pre class='cython code score-4 '>static void __pyx_f_3nes_6cycore_5carts_8NESCart1_write(struct __pyx_obj_3nes_6cycore_5carts_NESCart1 *__pyx_v_self, int __pyx_v_address, unsigned char __pyx_v_value) {
  int __pyx_v_bank;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[38]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("write", __pyx_f[0], 231, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 231, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  <span class='trace'>__Pyx_TraceReturnValue</span>(Py_None, 0, 0, <span class='error_goto'>__PYX_ERR(0, 231, __pyx_L1_error)</span>);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 231, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart1.write", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">232</span>:         cdef int bank=0</pre>
<pre class='cython code score-0 '>  __pyx_v_bank = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">233</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">234</span>:         if address &lt; M1_PRG_RAM_START:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_address &lt; __pyx_e_3nes_6cycore_5carts_M1_PRG_RAM_START);
  if (__pyx_t_1) {
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">235</span>:             # shouldn't be writing here</pre>
<pre class="cython line score-0">&#xA0;<span class="">236</span>:             pass</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">237</span>:         elif M1_PRG_RAM_START &lt;= address &lt; M1_CTRL_REG_START:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_e_3nes_6cycore_5carts_M1_PRG_RAM_START &lt;= __pyx_v_address);
  if (__pyx_t_1) {
    __pyx_t_1 = (__pyx_v_address &lt; __pyx_e_3nes_6cycore_5carts_M1_CTRL_REG_START);
  }
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">238</span>:             if self.prg_bank &amp; 0b10000 == 0:  # bit 4 being low is prg_ram enable</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_self-&gt;prg_bank &amp; 16) == 0);
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">239</span>:                 if self.num_prg_ram_banks &gt; 1 and (self.chr_bank[0] &amp; 0b1000) &gt; 0:</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = (__pyx_v_self-&gt;num_prg_ram_banks &gt; 1);
      if (__pyx_t_2) {
      } else {
        __pyx_t_1 = __pyx_t_2;
        goto __pyx_L6_bool_binop_done;
      }
      __pyx_t_2 = (((__pyx_v_self-&gt;chr_bank[0]) &amp; 8) &gt; 0);
      __pyx_t_1 = __pyx_t_2;
      __pyx_L6_bool_binop_done:;
      if (__pyx_t_1) {
/* … */
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">240</span>:                     # bank-switched prg ram; only SOROM is supported of this type, and this has the selection bit in</pre>
<pre class="cython line score-0">&#xA0;<span class="">241</span>:                     # bit 3 of the chr_bank register</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">242</span>:                     bank = (self.chr_bank[0] &gt;&gt; 3) &amp; 1</pre>
<pre class='cython code score-0 '>        __pyx_v_bank = (((__pyx_v_self-&gt;chr_bank[0]) &gt;&gt; 3) &amp; 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">243</span>:                 self.ram[bank][address % M1_PRG_RAM_BANK_SIZE] = value</pre>
<pre class='cython code score-0 '>      ((__pyx_v_self-&gt;ram[__pyx_v_bank])[(__pyx_v_address % __pyx_e_3nes_6cycore_5carts_M1_PRG_RAM_BANK_SIZE)]) = __pyx_v_value;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">244</span>:         elif address &gt;= M1_CTRL_REG_START:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_address &gt;= __pyx_e_3nes_6cycore_5carts_M1_CTRL_REG_START);
  if (__pyx_t_1) {
/* … */
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">245</span>:             # everything else is a write to the shift register:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">246</span>:             self._write_shift(address, value)</pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart1 *)__pyx_v_self-&gt;__pyx_base.__pyx_vtab)-&gt;_write_shift(__pyx_v_self, __pyx_v_address, __pyx_v_value);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 246, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">247</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">248</span>:     cdef void _write_shift(self, int address, unsigned char value):</pre>
<pre class='cython code score-4 '>static void __pyx_f_3nes_6cycore_5carts_8NESCart1__write_shift(struct __pyx_obj_3nes_6cycore_5carts_NESCart1 *__pyx_v_self, int __pyx_v_address, unsigned char __pyx_v_value) {
  unsigned char __pyx_v_data;
  unsigned char __pyx_v_reset;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[39]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("_write_shift", __pyx_f[0], 248, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 248, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  <span class='trace'>__Pyx_TraceReturnValue</span>(Py_None, 0, 0, <span class='error_goto'>__PYX_ERR(0, 248, __pyx_L1_error)</span>);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 248, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart1._write_shift", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
}
</pre><pre class="cython line score-0">&#xA0;<span class="">249</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">250</span>:         Writes one bit to the internal shift register, or resets it.  On the fifth (non-reset) write, the value in the</pre>
<pre class="cython line score-0">&#xA0;<span class="">251</span>:         shift register is written to one of the internal registers; which one is determined by the address of that</pre>
<pre class="cython line score-0">&#xA0;<span class="">252</span>:         fifth write.</pre>
<pre class="cython line score-0">&#xA0;<span class="">253</span>:         :param address:  address to write to; used on fifth write to select register to be written</pre>
<pre class="cython line score-0">&#xA0;<span class="">254</span>:         :param value: value to write, only msb (reset) and lsb (data) bits are used</pre>
<pre class="cython line score-0">&#xA0;<span class="">255</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">256</span>:         cdef unsigned char data, reset</pre>
<pre class="cython line score-0">&#xA0;<span class="">257</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">258</span>:         data = value &amp; 1          # lsb of value is the data</pre>
<pre class='cython code score-0 '>  __pyx_v_data = (__pyx_v_value &amp; 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">259</span>:         reset = (value &gt;&gt; 7) &amp; 1  # msb of value is reset bit</pre>
<pre class='cython code score-0 '>  __pyx_v_reset = ((__pyx_v_value &gt;&gt; 7) &amp; 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">260</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">261</span>:         if reset:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_reset != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">262</span>:             # "Reset shift register and write Control with (Control OR $0C), locking PRG ROM at $C000-$FFFF to the</pre>
<pre class="cython line score-0">&#xA0;<span class="">263</span>:             # last bank."</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">264</span>:             self.shift = 0</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;shift = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">265</span>:             self.shift_ctr = 0</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;shift_ctr = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">266</span>:             self.ctrl |= 0x0C   # sets the PRG ROM bank mode to 3 (fix last bank at 0xC000, switch 16kb bank at 0x8000)</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;ctrl = (__pyx_v_self-&gt;ctrl | 0x0C);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">267</span>:             return</pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceReturnValue</span>(Py_None, 22, 0, <span class='error_goto'>__PYX_ERR(0, 267, __pyx_L1_error)</span>);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">268</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">269</span>:         # put the data into the shift register, shifting the register right and putting the data in 4 (i.e. the 5th bit)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">270</span>:         self.shift = (self.shift &gt;&gt; 1) | (data &lt;&lt; 4)</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;shift = ((__pyx_v_self-&gt;shift &gt;&gt; 1) | (__pyx_v_data &lt;&lt; 4));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">271</span>:         self.shift_ctr += 1</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;shift_ctr = (__pyx_v_self-&gt;shift_ctr + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">272</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">273</span>:         #print("{:06b} in shift (#{})".format(self.shift, self.shift_ctr))</pre>
<pre class="cython line score-0">&#xA0;<span class="">274</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">275</span>:         if self.shift_ctr == 5:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_self-&gt;shift_ctr == 5);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">276</span>:             # this was the final write to the register and we can now transfer the contents of the shift register to the</pre>
<pre class="cython line score-0">&#xA0;<span class="">277</span>:             # internal register in question.  We also reset the shift register (to 0) and counter.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">278</span>:             if M1_CTRL_REG_START &lt;= address &lt; M1_CHR_REG_0_START:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = (__pyx_e_3nes_6cycore_5carts_M1_CTRL_REG_START &lt;= __pyx_v_address);
    if (__pyx_t_1) {
      __pyx_t_1 = (__pyx_v_address &lt; __pyx_e_3nes_6cycore_5carts_M1_CHR_REG_0_START);
    }
    if (__pyx_t_1) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">279</span>:                 self.ctrl = self.shift</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = __pyx_v_self-&gt;shift;
      __pyx_v_self-&gt;ctrl = __pyx_t_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">280</span>:                 # if we've written ctrl, we might have to update the mirror pattern:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">281</span>:                 self._set_nametable_mirror_pattern()</pre>
<pre class='cython code score-0 '>      ((struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart1 *)__pyx_v_self-&gt;__pyx_base.__pyx_vtab)-&gt;_set_nametable_mirror_pattern(__pyx_v_self);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 281, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">282</span>:                 #print("{:06b} written to ctrl".format(self.ctrl))</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">283</span>:             elif M1_CHR_REG_0_START &lt;= address &lt; M1_CHR_REG_1_START:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = (__pyx_e_3nes_6cycore_5carts_M1_CHR_REG_0_START &lt;= __pyx_v_address);
    if (__pyx_t_1) {
      __pyx_t_1 = (__pyx_v_address &lt; __pyx_e_3nes_6cycore_5carts_M1_CHR_REG_1_START);
    }
    if (__pyx_t_1) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">284</span>:                 self.chr_bank[0] = self.shift</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = __pyx_v_self-&gt;shift;
      (__pyx_v_self-&gt;chr_bank[0]) = __pyx_t_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">285</span>:                 #print("{} written to chr_bank[0]".format(self.chr_bank[0]))</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">286</span>:             elif M1_CHR_REG_1_START &lt;= address &lt; M1_PRG_REG_START:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = (__pyx_e_3nes_6cycore_5carts_M1_CHR_REG_1_START &lt;= __pyx_v_address);
    if (__pyx_t_1) {
      __pyx_t_1 = (__pyx_v_address &lt; __pyx_e_3nes_6cycore_5carts_M1_PRG_REG_START);
    }
    if (__pyx_t_1) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">287</span>:                 self.chr_bank[1] = self.shift</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = __pyx_v_self-&gt;shift;
      (__pyx_v_self-&gt;chr_bank[1]) = __pyx_t_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">288</span>:                 #print("{} written to chr_bank[1]".format(self.chr_bank[1]))</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">289</span>:             elif M1_PRG_REG_START &lt;= address:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = (__pyx_e_3nes_6cycore_5carts_M1_PRG_REG_START &lt;= __pyx_v_address);
    if (__pyx_t_1) {
/* … */
    }
    __pyx_L5:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">290</span>:                 self.prg_bank = self.shift</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = __pyx_v_self-&gt;shift;
      __pyx_v_self-&gt;prg_bank = __pyx_t_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">291</span>:                 #print("{} written to prg_bank".format(self.prg_bank))</pre>
<pre class="cython line score-0">&#xA0;<span class="">292</span>:             #else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">293</span>:                 #print("UNMATCHED SHIFT FINISH {:04X}".format(address))</pre>
<pre class="cython line score-0">&#xA0;<span class="">294</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">295</span>:             self.shift_ctr = 0</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;shift_ctr = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">296</span>:             self.shift = 0</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;shift = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">297</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">298</span>:     cdef void _set_nametable_mirror_pattern(self):</pre>
<pre class='cython code score-4 '>static void __pyx_f_3nes_6cycore_5carts_8NESCart1__set_nametable_mirror_pattern(struct __pyx_obj_3nes_6cycore_5carts_NESCart1 *__pyx_v_self) {
  int __pyx_v_mirror_pattern;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[40]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("_set_nametable_mirror_pattern", __pyx_f[0], 298, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  <span class='trace'>__Pyx_TraceReturnValue</span>(Py_None, 0, 0, <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L1_error)</span>);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart1._set_nametable_mirror_pattern", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
}
</pre><pre class="cython line score-0">&#xA0;<span class="">299</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">300</span>:         Updates the nametable mirror pattern to correspond to the value in ctrl</pre>
<pre class="cython line score-0">&#xA0;<span class="">301</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">302</span>:         cdef int mirror_pattern</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">303</span>:         mirror_pattern = self.ctrl &amp; 0b11</pre>
<pre class='cython code score-0 '>  __pyx_v_mirror_pattern = (__pyx_v_self-&gt;ctrl &amp; 3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">304</span>:         if mirror_pattern == 0:</pre>
<pre class='cython code score-0 '>  switch (__pyx_v_mirror_pattern) {
    case 0:
/* … */
    break;
    case 1:
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">305</span>:             self.nametable_mirror_pattern[:] = MIRROR_ONE_LOWER</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = __pyx_v_self-&gt;__pyx_base.nametable_mirror_pattern;
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_4 = 0;
    __pyx_t_5 = 0;
    (__pyx_t_1[0]) = __pyx_t_2;
    (__pyx_t_1[1]) = __pyx_t_3;
    (__pyx_t_1[2]) = __pyx_t_4;
    (__pyx_t_1[3]) = __pyx_t_5;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">306</span>:         elif mirror_pattern == 1:</pre>
<pre class='cython code score-0 '>    break;
    case 2:
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">307</span>:             self.nametable_mirror_pattern[:] = MIRROR_ONE_UPPER</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = __pyx_v_self-&gt;__pyx_base.nametable_mirror_pattern;
    __pyx_t_5 = 1;
    __pyx_t_4 = 1;
    __pyx_t_3 = 1;
    __pyx_t_2 = 1;
    (__pyx_t_1[0]) = __pyx_t_5;
    (__pyx_t_1[1]) = __pyx_t_4;
    (__pyx_t_1[2]) = __pyx_t_3;
    (__pyx_t_1[3]) = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">308</span>:         elif mirror_pattern == 2:</pre>
<pre class='cython code score-0 '>    break;
    case 3:
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">309</span>:             self.nametable_mirror_pattern[:] = MIRROR_VERTICAL</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = __pyx_v_self-&gt;__pyx_base.nametable_mirror_pattern;
    __pyx_t_2 = 0;
    __pyx_t_3 = 1;
    __pyx_t_4 = 0;
    __pyx_t_5 = 1;
    (__pyx_t_1[0]) = __pyx_t_2;
    (__pyx_t_1[1]) = __pyx_t_3;
    (__pyx_t_1[2]) = __pyx_t_4;
    (__pyx_t_1[3]) = __pyx_t_5;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">310</span>:         elif mirror_pattern == 3:</pre>
<pre class='cython code score-0 '>    break;
    default: break;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">311</span>:             self.nametable_mirror_pattern[:] = MIRROR_HORIZONTAL</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = __pyx_v_self-&gt;__pyx_base.nametable_mirror_pattern;
    __pyx_t_5 = 0;
    __pyx_t_4 = 0;
    __pyx_t_3 = 1;
    __pyx_t_2 = 1;
    (__pyx_t_1[0]) = __pyx_t_5;
    (__pyx_t_1[1]) = __pyx_t_4;
    (__pyx_t_1[2]) = __pyx_t_3;
    (__pyx_t_1[3]) = __pyx_t_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">312</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">313</span>:     cdef unsigned char read(self, int address):</pre>
<pre class='cython code score-4 '>static unsigned char __pyx_f_3nes_6cycore_5carts_8NESCart1_read(struct __pyx_obj_3nes_6cycore_5carts_NESCart1 *__pyx_v_self, int __pyx_v_address) {
  int __pyx_v_bank;
  int __pyx_v_mode;
  unsigned char __pyx_v_value;
  unsigned char __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[41]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("read", __pyx_f[0], 313, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 313, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 313, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart1.read", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">314</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">315</span>:         Read from the PRG memory (connected to CPU).  The address and the internal state of the ctrl and prg_bank</pre>
<pre class="cython line score-0">&#xA0;<span class="">316</span>:         registers determine the exact location of the memory read.</pre>
<pre class="cython line score-0">&#xA0;<span class="">317</span>:         :param address: address to read from</pre>
<pre class="cython line score-0">&#xA0;<span class="">318</span>:         :return: the one byte contents of the memory at address</pre>
<pre class="cython line score-0">&#xA0;<span class="">319</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">320</span>:         cdef int bank=0, mode=-1</pre>
<pre class='cython code score-0 '>  __pyx_v_bank = 0;
  __pyx_v_mode = -1;
</pre><pre class="cython line score-0">&#xA0;<span class="">321</span>:         cdef unsigned char value</pre>
<pre class="cython line score-0">&#xA0;<span class="">322</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">323</span>:         if M1_PRG_RAM_START &lt;= address &lt; M1_PRG_ROM_BANK0_START:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_e_3nes_6cycore_5carts_M1_PRG_RAM_START &lt;= __pyx_v_address);
  if (__pyx_t_1) {
    __pyx_t_1 = (__pyx_v_address &lt; __pyx_e_3nes_6cycore_5carts_M1_PRG_ROM_BANK0_START);
  }
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">324</span>:             # There might be more than 1 bank of RAM or non at all, need to check it is enabled</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">325</span>:             if self.prg_bank &amp; 0b10000 == 0:  # bit 4 being low is prg_ram enable</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_self-&gt;prg_bank &amp; 16) == 0);
    if (__pyx_t_1) {
/* … */
      goto __pyx_L4;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">326</span>:                 # prg-ram enabled</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">327</span>:                 if self.num_prg_ram_banks &gt; 1 and (self.chr_bank[0] &amp; 0b1000) &gt; 0:</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = (__pyx_v_self-&gt;num_prg_ram_banks &gt; 1);
      if (__pyx_t_2) {
      } else {
        __pyx_t_1 = __pyx_t_2;
        goto __pyx_L6_bool_binop_done;
      }
      __pyx_t_2 = (((__pyx_v_self-&gt;chr_bank[0]) &amp; 8) &gt; 0);
      __pyx_t_1 = __pyx_t_2;
      __pyx_L6_bool_binop_done:;
      if (__pyx_t_1) {
/* … */
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">328</span>:                     # bank-switched prg ram; only SOROM is supported of this type, and this has the selection bit in</pre>
<pre class="cython line score-0">&#xA0;<span class="">329</span>:                     # bit 3 of the chr_bank register</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">330</span>:                     bank = (self.chr_bank[0] &gt;&gt; 3) &amp; 1</pre>
<pre class='cython code score-0 '>        __pyx_v_bank = (((__pyx_v_self-&gt;chr_bank[0]) &gt;&gt; 3) &amp; 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">331</span>:                 value = self.ram[bank][address % M1_PRG_RAM_BANK_SIZE]</pre>
<pre class='cython code score-0 '>      __pyx_v_value = ((__pyx_v_self-&gt;ram[__pyx_v_bank])[(__pyx_v_address % __pyx_e_3nes_6cycore_5carts_M1_PRG_RAM_BANK_SIZE)]);
</pre><pre class="cython line score-0">&#xA0;<span class="">332</span>:             else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">333</span>:                 # open-bus behaviour</pre>
<pre class="cython line score-0">&#xA0;<span class="">334</span>:                 # todo: should be open bus behaviour, but not sure yet how to implement this</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">335</span>:                 value = 0</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_value = 0;
    }
    __pyx_L4:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">336</span>:             return value</pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_v_value;
    <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_PyLong_From_unsigned_char, 50, 0, <span class='error_goto'>__PYX_ERR(0, 336, __pyx_L1_error)</span>);
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">337</span>:         elif M1_PRG_ROM_BANK0_START &lt;= address &lt; M1_PRG_ROM_BANK1_START:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_e_3nes_6cycore_5carts_M1_PRG_ROM_BANK0_START &lt;= __pyx_v_address);
  if (__pyx_t_1) {
    __pyx_t_1 = (__pyx_v_address &lt; __pyx_e_3nes_6cycore_5carts_M1_PRG_ROM_BANK1_START);
  }
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">338</span>:             # read from prg rom bank 0 (this is an address between 0x8000 and 0xBFFF)</pre>
<pre class="cython line score-0">&#xA0;<span class="">339</span>:             # which bank is bank 0 is determined by the prg rom mode (in ctrl) and the prg_bank register</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">340</span>:             mode = (self.ctrl &amp; 0b1100) &gt;&gt; 2</pre>
<pre class='cython code score-0 '>    __pyx_v_mode = ((__pyx_v_self-&gt;ctrl &amp; 12) &gt;&gt; 2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">341</span>:             if mode == 0 or mode == 1:   # 32 kb mode</pre>
<pre class='cython code score-0 '>    switch (__pyx_v_mode) {
      case 0:
      case 1:
/* … */
      break;
      case 2:
</pre><pre class="cython line score-0">&#xA0;<span class="">342</span>:                 # in 32kb mode, ignore lower bit (and in this case we are in the lower of the two 16kb banks, so lsb=0)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">343</span>:                 bank = (self.prg_bank &amp; 0b1110) % self.num_prg_banks</pre>
<pre class='cython code score-0 '>      __pyx_v_bank = ((__pyx_v_self-&gt;prg_bank &amp; 14) % __pyx_v_self-&gt;num_prg_banks);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">344</span>:             elif mode == 2:</pre>
<pre class='cython code score-0 '>      break;
      case 3:
</pre><pre class="cython line score-0">&#xA0;<span class="">345</span>:                 # bank 0 is fixed to first bank at 0x8000 (but that is the area that address is in, so read first bank)</pre>
<pre class="cython line score-0">&#xA0;<span class="">346</span>:                 # (in 512kb ROMs, even this "fixed" bank is switched to the second page)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">347</span>:                 bank = 0</pre>
<pre class='cython code score-0 '>      __pyx_v_bank = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">348</span>:             elif mode == 3:</pre>
<pre class='cython code score-0 '>      break;
      default: break;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">349</span>:                 # bank 0 is switched according to prg_bank</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">350</span>:                 bank = (self.prg_bank &amp; 0b1111) % self.num_prg_banks</pre>
<pre class='cython code score-0 '>      __pyx_v_bank = ((__pyx_v_self-&gt;prg_bank &amp; 15) % __pyx_v_self-&gt;num_prg_banks);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">351</span>:         elif M1_PRG_ROM_BANK1_START &lt;= address:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_e_3nes_6cycore_5carts_M1_PRG_ROM_BANK1_START &lt;= __pyx_v_address);
  if (__pyx_t_1) {
/* … */
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">352</span>:             # read from prg rom bank 1 (this is an address between 0xC000 and 0xFFFF)</pre>
<pre class="cython line score-0">&#xA0;<span class="">353</span>:             # which bank is bank 1 is determined by the prg rom mode (in ctrl) and the prg_bank register</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">354</span>:             mode = (self.ctrl &amp; 0b1100) &gt;&gt; 2</pre>
<pre class='cython code score-0 '>    __pyx_v_mode = ((__pyx_v_self-&gt;ctrl &amp; 12) &gt;&gt; 2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">355</span>:             if mode == 0 or mode == 1:  # 32 kb mode</pre>
<pre class='cython code score-0 '>    switch (__pyx_v_mode) {
      case 0:
      case 1:
/* … */
      break;
      case 2:
</pre><pre class="cython line score-0">&#xA0;<span class="">356</span>:                 # in 32kb mode, ignore lower bit of the prg_bank, but now we are in the upper of the two banks, so the</pre>
<pre class="cython line score-0">&#xA0;<span class="">357</span>:                 # lsb must be set to 1</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">358</span>:                 bank = ((self.prg_bank &amp; 0b1110) + 1) % self.num_prg_banks</pre>
<pre class='cython code score-0 '>      __pyx_v_bank = (((__pyx_v_self-&gt;prg_bank &amp; 14) + 1) % __pyx_v_self-&gt;num_prg_banks);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">359</span>:             elif mode == 2:</pre>
<pre class='cython code score-0 '>      break;
      case 3:
</pre><pre class="cython line score-0">&#xA0;<span class="">360</span>:                 # bank 1 is switched according to prg_bank</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">361</span>:                 bank = (self.prg_bank &amp; 0b1111) % self.num_prg_banks</pre>
<pre class='cython code score-0 '>      __pyx_v_bank = ((__pyx_v_self-&gt;prg_bank &amp; 15) % __pyx_v_self-&gt;num_prg_banks);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">362</span>:             elif mode == 3:</pre>
<pre class='cython code score-0 '>      break;
      default: break;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">363</span>:                 # bank 1 is fixed to last bank</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">364</span>:                 bank = self.num_prg_banks - 1</pre>
<pre class='cython code score-0 '>      __pyx_v_bank = (__pyx_v_self-&gt;num_prg_banks - 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">365</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">366</span>:         value = self.banked_prg_rom[bank][address % M1_PRG_ROM_BANK_SIZE]</pre>
<pre class='cython code score-0 '>  __pyx_v_value = ((__pyx_v_self-&gt;banked_prg_rom[__pyx_v_bank])[(__pyx_v_address % __pyx_e_3nes_6cycore_5carts_M1_PRG_ROM_BANK_SIZE)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">367</span>:         return value</pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_value;
  <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_PyLong_From_unsigned_char, 151, 0, <span class='error_goto'>__PYX_ERR(0, 367, __pyx_L1_error)</span>);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">368</span>: </pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">369</span>:     cdef int _get_chr_bank(self, int address):</pre>
<pre class='cython code score-7 '>static int __pyx_f_3nes_6cycore_5carts_8NESCart1__get_chr_bank(struct __pyx_obj_3nes_6cycore_5carts_NESCart1 *__pyx_v_self, int __pyx_v_address) {
  int __pyx_v_mode_8kb;
  int __pyx_v_mask;
  PyObject *__pyx_v_address_bank = NULL;
  int __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[42]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("_get_chr_bank", __pyx_f[0], 369, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 369, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 369, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart1._get_chr_bank", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_address_bank);
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">370</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">371</span>:         Get the bank in the case of a read/write to the chr memory</pre>
<pre class="cython line score-0">&#xA0;<span class="">372</span>:         :param address:</pre>
<pre class="cython line score-0">&#xA0;<span class="">373</span>:         :return:</pre>
<pre class="cython line score-0">&#xA0;<span class="">374</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">375</span>:         cdef int mode_8kb, mask</pre>
<pre class="cython line score-0">&#xA0;<span class="">376</span>:         # which addressing mode?  8kb or (if this is false) 4kb</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">377</span>:         mode_8kb = (self.ctrl &amp; 0b10000) == 0</pre>
<pre class='cython code score-0 '>  __pyx_v_mode_8kb = ((__pyx_v_self-&gt;ctrl &amp; 16) == 0);
</pre><pre class="cython line score-0">&#xA0;<span class="">378</span>:         # is the address in bank 0 or bank 1?</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">379</span>:         address_bank = address &gt;= M1_CHR_ROM_BANK1_START</pre>
<pre class='cython code score-2 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>((__pyx_v_address &gt;= __pyx_e_3nes_6cycore_5carts_M1_CHR_ROM_BANK1_START));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 379, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_address_bank = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">380</span>:         # just use the lower line for addressing if only have 2 banks; higher lines might be in use for other things</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">381</span>:         mask = 0b00001 if self.num_chr_banks &lt;= 2 else 0b11111</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = (__pyx_v_self-&gt;num_chr_banks &lt;= 2);
  if (__pyx_t_3) {
    __pyx_t_2 = 1;
  } else {
    __pyx_t_2 = 31;
  }
  __pyx_v_mask = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">382</span>:         if mode_8kb:</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = (__pyx_v_mode_8kb != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">383</span>:             # use the address in chr_bank[0], ignoring the low bit.</pre>
<pre class="cython line score-0">&#xA0;<span class="">384</span>:             # in this case bank (chr_bank[0] &amp; 0b11110) is at 0x0000</pre>
<pre class="cython line score-0">&#xA0;<span class="">385</span>:             #               and (chr_bank[0] &amp; 0b11110) + 1 is at 0x1000</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">386</span>:             mask &amp;= 0b11110</pre>
<pre class='cython code score-0 '>    __pyx_v_mask = (__pyx_v_mask &amp; 30);
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">387</span>:             return (self.chr_bank[0] &amp; mask) + address_bank</pre>
<pre class='cython code score-16 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>(((__pyx_v_self-&gt;chr_bank[0]) &amp; __pyx_v_mask));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 387, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_v_address_bank);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 387, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyLong_As_int</span>(__pyx_t_4); if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 387, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_2;
    <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_PyLong_From_int, 23, 0, <span class='error_goto'>__PYX_ERR(0, 387, __pyx_L1_error)</span>);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">388</span>:         else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">389</span>:             # 4kb mode</pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">390</span>:             return self.chr_bank[address_bank] &amp; mask</pre>
<pre class='cython code score-7 '>  /*else*/ {
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_address_bank); if (unlikely((__pyx_t_5 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 390, __pyx_L1_error)</span>
    __pyx_r = ((__pyx_v_self-&gt;chr_bank[__pyx_t_5]) &amp; __pyx_v_mask);
    <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_PyLong_From_int, 32, 0, <span class='error_goto'>__PYX_ERR(0, 390, __pyx_L1_error)</span>);
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">391</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">392</span>:     cdef void write_ppu(self, int address, unsigned char value):</pre>
<pre class='cython code score-4 '>static void __pyx_f_3nes_6cycore_5carts_8NESCart1_write_ppu(struct __pyx_obj_3nes_6cycore_5carts_NESCart1 *__pyx_v_self, int __pyx_v_address, unsigned char __pyx_v_value) {
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[43]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("write_ppu", __pyx_f[0], 392, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  <span class='trace'>__Pyx_TraceReturnValue</span>(Py_None, 0, 0, <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L1_error)</span>);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 392, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart1.write_ppu", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
}
</pre><pre class="cython line score-0">&#xA0;<span class="">393</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">394</span>:         Write a byte to CHR memory; should only work in carts with RAM here.</pre>
<pre class="cython line score-0">&#xA0;<span class="">395</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">396</span>:         if not self.chr_mem_writeable:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (!__pyx_v_self-&gt;chr_mem_writeable);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">397</span>:             # this is a ROM, so do nothing</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">398</span>:             return</pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceReturnValue</span>(Py_None, 5, 0, <span class='error_goto'>__PYX_ERR(0, 398, __pyx_L1_error)</span>);
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">399</span>:         self.banked_chr_rom[self._get_chr_bank(address)][address % M1_CHR_ROM_BANK_SIZE] = value</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart1 *)__pyx_v_self-&gt;__pyx_base.__pyx_vtab)-&gt;_get_chr_bank(__pyx_v_self, __pyx_v_address);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 399, __pyx_L1_error)</span>
  ((__pyx_v_self-&gt;banked_chr_rom[__pyx_t_2])[(__pyx_v_address % __pyx_e_3nes_6cycore_5carts_M1_CHR_ROM_BANK_SIZE)]) = __pyx_v_value;
</pre><pre class="cython line score-0">&#xA0;<span class="">400</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">401</span>:     cdef unsigned char read_ppu(self, int address):</pre>
<pre class='cython code score-4 '>static unsigned char __pyx_f_3nes_6cycore_5carts_8NESCart1_read_ppu(struct __pyx_obj_3nes_6cycore_5carts_NESCart1 *__pyx_v_self, int __pyx_v_address) {
  unsigned char __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[44]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("read_ppu", __pyx_f[0], 401, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 401, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 401, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart1.read_ppu", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">402</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">403</span>:         Read from the chr rom; the exact piece of chr rom read depends on the internal state of the chr_bank registers</pre>
<pre class="cython line score-0">&#xA0;<span class="">404</span>:         :param address: address to read from</pre>
<pre class="cython line score-0">&#xA0;<span class="">405</span>:         :return: a byte read from chr rom</pre>
<pre class="cython line score-0">&#xA0;<span class="">406</span>:         """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">407</span>:         return self.banked_chr_rom[self._get_chr_bank(address)][address % M1_CHR_ROM_BANK_SIZE]</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart1 *)__pyx_v_self-&gt;__pyx_base.__pyx_vtab)-&gt;_get_chr_bank(__pyx_v_self, __pyx_v_address);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 407, __pyx_L1_error)</span>
  __pyx_r = ((__pyx_v_self-&gt;banked_chr_rom[__pyx_t_1])[(__pyx_v_address % __pyx_e_3nes_6cycore_5carts_M1_CHR_ROM_BANK_SIZE)]);
  <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_PyLong_From_unsigned_char, 1, 0, <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L1_error)</span>);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">408</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">409</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">410</span>: ### Mapper 2 (aka UNROM, UOROM) ########################################################################################</pre>
<pre class="cython line score-0">&#xA0;<span class="">411</span>: # ref: https://wiki.nesdev.com/w/index.php/UxROM</pre>
<pre class="cython line score-0">&#xA0;<span class="">412</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">413</span>: cdef class NESCart2(NESCart0):</pre>
<pre class='cython code score-0 '>struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart2 {
  struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart0 __pyx_base;
};
static struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart2 *__pyx_vtabptr_3nes_6cycore_5carts_NESCart2;

</pre><pre class="cython line score-0">&#xA0;<span class="">414</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">415</span>:     NES Cartridge Type 2 (UNROM / UOROM)</pre>
<pre class="cython line score-0">&#xA0;<span class="">416</span>:     Much like Mapper 0 above, but has switchable banks of 16kB prg_rom</pre>
<pre class="cython line score-0">&#xA0;<span class="">417</span>:     """</pre>
<pre class="cython line score-35" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">418</span>:     def __init__(self,</pre>
<pre class='cython code score-35 '>/* Python wrapper */
static int __pyx_pw_3nes_6cycore_5carts_8NESCart2_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_3nes_6cycore_5carts_8NESCart2_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_prg_rom_data = 0;
  PyObject *__pyx_v_chr_rom_data = 0;
  PyObject *__pyx_v_prg_rom_writeable = 0;
  PyObject *__pyx_v_ram_size_kb = 0;
  PyObject *__pyx_v_nametable_mirror_pattern = 0;
  PyObject *__pyx_v_emulate_bus_conflicts = 0;
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__init__ (wrapper)", 0);
  #if CYTHON_ASSUME_SAFE_SIZE
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return -1;
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_VARARGS</span>(__pyx_args, __pyx_nargs);
  {
    PyObject ** const __pyx_pyargnames[] = {&amp;__pyx_mstate_global-&gt;__pyx_n_u_prg_rom_data,&amp;__pyx_mstate_global-&gt;__pyx_n_u_chr_rom_data,&amp;__pyx_mstate_global-&gt;__pyx_n_u_prg_rom_writeable,&amp;__pyx_mstate_global-&gt;__pyx_n_u_ram_size_kb,&amp;__pyx_mstate_global-&gt;__pyx_n_u_nametable_mirror_pattern,&amp;__pyx_mstate_global-&gt;__pyx_n_u_emulate_bus_conflicts,0};
  PyObject* values[6] = {0,0,0,0,0,0};
    const Py_ssize_t __pyx_kwds_len = (__pyx_kwds) ? <span class='pyx_c_api'>__Pyx_NumKwargs_VARARGS</span>(__pyx_kwds) : 0;
    if (unlikely(__pyx_kwds_len) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L3_error)</span>
    if (__pyx_kwds_len &gt; 0) {
      switch (__pyx_nargs) {
        case  6:
        values[5] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 5);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[5])) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  5:
        values[4] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 4);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[4])) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  4:
        values[3] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 3);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[3])) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  3:
        values[2] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 2);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[2])) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  2:
        values[1] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 1);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[1])) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  1:
        values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 0);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      const Py_ssize_t kwd_pos_args = __pyx_nargs;
      if (<span class='pyx_c_api'>__Pyx_ParseKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values, kwd_pos_args, __pyx_kwds_len, "__init__", 0) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L3_error)</span>
/* … */
  /* function exit code */
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static int __pyx_pf_3nes_6cycore_5carts_8NESCart2___init__(struct __pyx_obj_3nes_6cycore_5carts_NESCart2 *__pyx_v_self, PyObject *__pyx_v_prg_rom_data, PyObject *__pyx_v_chr_rom_data, PyObject *__pyx_v_prg_rom_writeable, PyObject *__pyx_v_ram_size_kb, PyObject *__pyx_v_nametable_mirror_pattern, PyObject *__pyx_v_emulate_bus_conflicts) {
  PyObject *__pyx_v_bnk = NULL;
  PyObject *__pyx_v_i = NULL;
  long __pyx_7genexpr__pyx_v_i;
  int __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[47]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("__init__", __pyx_f[0], 418, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_r = 0;
  <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_Owned_Py_None, 0, 0, <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L1_error)</span>);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart2.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_bnk);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">419</span>:              prg_rom_data=None,</pre>
<pre class='cython code score-4 '>      if (!values[0]) values[0] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
/* … */
      if (!values[0]) values[0] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">420</span>:              chr_rom_data=None,</pre>
<pre class='cython code score-4 '>      if (!values[1]) values[1] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
/* … */
      if (!values[1]) values[1] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">421</span>:              prg_rom_writeable=False,   # whether or not the program memory is ROM or RAM</pre>
<pre class='cython code score-8 '>      if (!values[2]) values[2] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_False));
      if (!values[3]) values[3] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_int_8));
/* … */
      if (!values[2]) values[2] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_False));
      if (!values[3]) values[3] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_int_8));
</pre><pre class="cython line score-0">&#xA0;<span class="">422</span>:              ram_size_kb=8,</pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">423</span>:              nametable_mirror_pattern=(0, 0, 1, 1),</pre>
<pre class='cython code score-4 '>      if (!values[4]) values[4] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_tuple[2]));
/* … */
      if (!values[4]) values[4] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_tuple[2]));
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">424</span>:              emulate_bus_conflicts=False   # whether or not to emulate bus conflicts on prg_bank select writes</pre>
<pre class='cython code score-20 '>      if (!values[5]) values[5] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_False));
    } else {
      switch (__pyx_nargs) {
        case  6:
        values[5] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 5);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[5])) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  5:
        values[4] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 4);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[4])) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  4:
        values[3] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 3);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[3])) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  3:
        values[2] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 2);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[2])) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  2:
        values[1] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 1);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[1])) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  1:
        values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 0);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
/* … */
      if (!values[5]) values[5] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_False));
    }
    __pyx_v_prg_rom_data = values[0];
    __pyx_v_chr_rom_data = values[1];
    __pyx_v_prg_rom_writeable = values[2];
    __pyx_v_ram_size_kb = values[3];
    __pyx_v_nametable_mirror_pattern = values[4];
    __pyx_v_emulate_bus_conflicts = values[5];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 6, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart2.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3nes_6cycore_5carts_8NESCart2___init__(((struct __pyx_obj_3nes_6cycore_5carts_NESCart2 *)__pyx_v_self), __pyx_v_prg_rom_data, __pyx_v_chr_rom_data, __pyx_v_prg_rom_writeable, __pyx_v_ram_size_kb, __pyx_v_nametable_mirror_pattern, __pyx_v_emulate_bus_conflicts);
</pre><pre class="cython line score-0">&#xA0;<span class="">425</span>:              ):</pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">426</span>:         super().__init__(prg_rom_data=None,    # don't want to write prg_rom_data to the prg_rom because will be too big</pre>
<pre class='cython code score-6 '>  __pyx_t_4 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_super);
  __pyx_t_5 = __pyx_builtin_super; 
  __pyx_t_6 = 1;
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_4, ((PyObject *)__pyx_mstate_global-&gt;__pyx_ptype_3nes_6cycore_5carts_NESCart2), ((PyObject *)__pyx_v_self)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_5, __pyx_callargs+__pyx_t_6, (3-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 426, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  }
  __pyx_t_2 = __pyx_t_3;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
</pre><pre class="cython line score-0">&#xA0;<span class="">427</span>:                          chr_rom_data=chr_rom_data,</pre>
<pre class="cython line score-0">&#xA0;<span class="">428</span>:                          prg_rom_writeable=prg_rom_writeable,</pre>
<pre class="cython line score-0">&#xA0;<span class="">429</span>:                          ram_size_kb=ram_size_kb,</pre>
<pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">430</span>:                          nametable_mirror_pattern=nametable_mirror_pattern,</pre>
<pre class='cython code score-18 '>  __pyx_t_6 = 0;
  {
    PyObject *__pyx_callargs[2 + ((CYTHON_VECTORCALL) ? 5 : 0)] = {__pyx_t_2, NULL};
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_MakeVectorcallBuilderKwds</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 426, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    if (<span class='pyx_c_api'>__Pyx_VectorcallBuilder_AddArg</span>(__pyx_mstate_global-&gt;__pyx_n_u_prg_rom_data, Py_None, __pyx_t_5, __pyx_callargs+1, 0) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 426, __pyx_L1_error)</span>
    if (<span class='pyx_c_api'>__Pyx_VectorcallBuilder_AddArg</span>(__pyx_mstate_global-&gt;__pyx_n_u_chr_rom_data, __pyx_v_chr_rom_data, __pyx_t_5, __pyx_callargs+1, 1) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 426, __pyx_L1_error)</span>
    if (<span class='pyx_c_api'>__Pyx_VectorcallBuilder_AddArg</span>(__pyx_mstate_global-&gt;__pyx_n_u_prg_rom_writeable, __pyx_v_prg_rom_writeable, __pyx_t_5, __pyx_callargs+1, 2) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 426, __pyx_L1_error)</span>
    if (<span class='pyx_c_api'>__Pyx_VectorcallBuilder_AddArg</span>(__pyx_mstate_global-&gt;__pyx_n_u_ram_size_kb, __pyx_v_ram_size_kb, __pyx_t_5, __pyx_callargs+1, 3) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 426, __pyx_L1_error)</span>
    if (<span class='pyx_c_api'>__Pyx_VectorcallBuilder_AddArg</span>(__pyx_mstate_global-&gt;__pyx_n_u_nametable_mirror_pattern, __pyx_v_nametable_mirror_pattern, __pyx_t_5, __pyx_callargs+1, 4) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 426, __pyx_L1_error)</span>
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Object_VectorcallMethod_CallFromBuilder</span>(__pyx_mstate_global-&gt;__pyx_n_u_init, __pyx_callargs+__pyx_t_6, (1-__pyx_t_6) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET), __pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 426, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">431</span>:                          )</pre>
<pre class="cython line score-0">&#xA0;<span class="">432</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">433</span>:         self.prg_bank = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;prg_bank = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">434</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">435</span>:         # Write the prg_rom_data to the ROM banks 16kB at a time.  Hopefully the ROM size is divisible by 16kB...</pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">436</span>:         self.num_prg_banks = int(len(prg_rom_data) / M2_PRG_ROM_BANK_SIZE)</pre>
<pre class='cython code score-5 '>  __pyx_t_7 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_prg_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 436, __pyx_L1_error)</span>
  __pyx_v_self-&gt;num_prg_banks = ((unsigned char)(__pyx_t_7 / ((Py_ssize_t)__pyx_e_3nes_6cycore_5carts_M2_PRG_ROM_BANK_SIZE)));
</pre><pre class="cython line score-0">&#xA0;<span class="">437</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">438</span>:         if self.num_prg_banks * M2_PRG_ROM_BANK_SIZE != len(prg_rom_data):</pre>
<pre class='cython code score-5 '>  __pyx_t_7 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_prg_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 438, __pyx_L1_error)</span>
  __pyx_t_8 = ((__pyx_v_self-&gt;num_prg_banks * __pyx_e_3nes_6cycore_5carts_M2_PRG_ROM_BANK_SIZE) != __pyx_t_7);
  if (unlikely(__pyx_t_8)) {
/* … */
  }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">439</span>:             raise ValueError("prg_rom_data size is not an integer multiple of 16kB")</pre>
<pre class='cython code score-8 '>    __pyx_t_3 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_ValueError);
    __pyx_t_5 = __pyx_builtin_ValueError; 
    __pyx_t_6 = 1;
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_mstate_global-&gt;__pyx_kp_u_prg_rom_data_size_is_not_an_inte};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_5, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 439, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    }
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='error_goto'>__PYX_ERR(0, 439, __pyx_L1_error)</span>
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">440</span>:         if not self.num_prg_banks in [2**i for i in range(5)]:</pre>
<pre class='cython code score-19 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyLong_From_unsigned_char</span>(__pyx_v_self-&gt;num_prg_banks);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 440, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  { /* enter inner scope */
    __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 440, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    for (__pyx_t_9 = 0; __pyx_t_9 &lt; 5; __pyx_t_9+=1) {
      __pyx_7genexpr__pyx_v_i = __pyx_t_9;
      __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(pow(2.0, ((double)__pyx_7genexpr__pyx_v_i)));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 440, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      if (unlikely(<span class='pyx_c_api'>__Pyx_ListComp_Append</span>(__pyx_t_5, (PyObject*)__pyx_t_3))) <span class='error_goto'>__PYX_ERR(0, 440, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    }
  } /* exit inner scope */
  __pyx_t_8 = (<span class='pyx_c_api'>__Pyx_PySequence_ContainsTF</span>(__pyx_t_1, __pyx_t_5, Py_NE)); if (unlikely((__pyx_t_8 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 440, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(__pyx_t_8)) {
/* … */
  }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">441</span>:             raise ValueError("Number of banks should be a power of two &lt;=16.")</pre>
<pre class='cython code score-8 '>    __pyx_t_1 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_ValueError);
    __pyx_t_3 = __pyx_builtin_ValueError; 
    __pyx_t_6 = 1;
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_mstate_global-&gt;__pyx_kp_u_Number_of_banks_should_be_a_powe};
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 441, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    }
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_5, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='error_goto'>__PYX_ERR(0, 441, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">442</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">443</span>:         # Copy the data to the banked_prg_rom banks</pre>
<pre class="cython line score-57" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">444</span>:         for bnk in range(self.num_prg_banks):</pre>
<pre class='cython code score-57 '>  __pyx_t_3 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_range);
  __pyx_t_1 = __pyx_builtin_range; 
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyLong_From_unsigned_char</span>(__pyx_v_self-&gt;num_prg_banks);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 444, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_6 = 1;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_2};
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_1, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 444, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  }
  if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_5)) {
    __pyx_t_1 = __pyx_t_5; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
    __pyx_t_7 = 0;
    __pyx_t_10 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_1 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 444, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_10 = (CYTHON_COMPILING_IN_LIMITED_API) ? PyIter_Next : <span class='pyx_c_api'>__Pyx_PyObject_GetIterNextFunc</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 444, __pyx_L1_error)</span>
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  for (;;) {
    if (likely(!__pyx_t_10)) {
      if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1))) {
        {
          Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyList_GET_SIZE</span>(__pyx_t_1);
          #if !CYTHON_ASSUME_SAFE_SIZE
          if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 444, __pyx_L1_error)</span>
          #endif
          if (__pyx_t_7 &gt;= __pyx_temp) break;
        }
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyList_GetItemRef</span>(__pyx_t_1, __pyx_t_7);
        ++__pyx_t_7;
      } else {
        {
          Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyTuple_GET_SIZE</span>(__pyx_t_1);
          #if !CYTHON_ASSUME_SAFE_SIZE
          if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 444, __pyx_L1_error)</span>
          #endif
          if (__pyx_t_7 &gt;= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_NewRef</span>(<span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_7));
        #else
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PySequence_ITEM</span>(__pyx_t_1, __pyx_t_7);
        #endif
        ++__pyx_t_7;
      }
      if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 444, __pyx_L1_error)</span>
    } else {
      __pyx_t_5 = __pyx_t_10(__pyx_t_1);
      if (unlikely(!__pyx_t_5)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (unlikely(!<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='error_goto'>__PYX_ERR(0, 444, __pyx_L1_error)</span>
          <span class='py_c_api'>PyErr_Clear</span>();
        }
        break;
      }
    }
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_bnk, __pyx_t_5);
    __pyx_t_5 = 0;
/* … */
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">445</span>:             for i in range(16 * 1024):</pre>
<pre class='cython code score-6 '>    for (__pyx_t_11 = 0; __pyx_t_11 &lt; 0x4000; __pyx_t_11+=1) {
      __pyx_t_5 = <span class='py_c_api'>PyLong_FromSsize_t</span>(__pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 445, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_i, __pyx_t_5);
      __pyx_t_5 = 0;
</pre><pre class="cython line score-36" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">446</span>:                 self.banked_prg_rom[bnk][i] = prg_rom_data[bnk * 16 * 1024 + i]</pre>
<pre class='cython code score-36 '>      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyLong_MultiplyObjC</span>(__pyx_v_bnk, __pyx_mstate_global-&gt;__pyx_int_16, 16, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 446, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyLong_MultiplyObjC</span>(__pyx_t_5, __pyx_mstate_global-&gt;__pyx_int_1024, 0x400, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 446, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_2, __pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 446, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(__pyx_v_prg_rom_data, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 446, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyLong_As_unsigned_char</span>(__pyx_t_2); if (unlikely((__pyx_t_12 == (unsigned char)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 446, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_bnk); if (unlikely((__pyx_t_13 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 446, __pyx_L1_error)</span>
      __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_i); if (unlikely((__pyx_t_14 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 446, __pyx_L1_error)</span>
      ((__pyx_v_self-&gt;banked_prg_rom[__pyx_t_13])[__pyx_t_14]) = __pyx_t_12;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">447</span>: </pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">448</span>:         self.emulate_bus_conflicts = emulate_bus_conflicts</pre>
<pre class='cython code score-7 '>  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_emulate_bus_conflicts); if (unlikely((__pyx_t_8 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 448, __pyx_L1_error)</span>
  __pyx_v_self-&gt;emulate_bus_conflicts = __pyx_t_8;
</pre><pre class="cython line score-0">&#xA0;<span class="">449</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">450</span>:     cdef unsigned char read(self, int address):</pre>
<pre class='cython code score-4 '>static unsigned char __pyx_f_3nes_6cycore_5carts_8NESCart2_read(struct __pyx_obj_3nes_6cycore_5carts_NESCart2 *__pyx_v_self, int __pyx_v_address) {
  unsigned char __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[48]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("read", __pyx_f[0], 450, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 450, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 450, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart2.read", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">451</span>:         if address &lt; PRG_ROM_START:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_address &lt; __pyx_e_3nes_6cycore_5carts_PRG_ROM_START);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">452</span>:             # RAM access</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">453</span>:             return self.ram[address % self.ram_size]</pre>
<pre class='cython code score-0 '>    __pyx_r = (__pyx_v_self-&gt;__pyx_base.ram[(__pyx_v_address % __pyx_v_self-&gt;__pyx_base.ram_size)]);
    <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_PyLong_From_unsigned_char, 5, 0, <span class='error_goto'>__PYX_ERR(0, 453, __pyx_L1_error)</span>);
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">454</span>:         elif address &lt; M2_FIXED_PRG_ROM_START:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_address &lt; __pyx_e_3nes_6cycore_5carts_M2_FIXED_PRG_ROM_START);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">455</span>:             # 0x8000 - 0xBFFF is access to banked prg_rom</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">456</span>:             return self.banked_prg_rom[self.prg_bank][address % M2_PRG_ROM_BANK_SIZE]</pre>
<pre class='cython code score-0 '>    __pyx_r = ((__pyx_v_self-&gt;banked_prg_rom[__pyx_v_self-&gt;prg_bank])[(__pyx_v_address % __pyx_e_3nes_6cycore_5carts_M2_PRG_ROM_BANK_SIZE)]);
    <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_PyLong_From_unsigned_char, 16, 0, <span class='error_goto'>__PYX_ERR(0, 456, __pyx_L1_error)</span>);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">457</span>:         else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">458</span>:             # 0xC000 - 0xFFFF is access to the last 16kB bank</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">459</span>:             return self.banked_prg_rom[self.num_prg_banks - 1][address % M2_PRG_ROM_BANK_SIZE]</pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_r = ((__pyx_v_self-&gt;banked_prg_rom[(__pyx_v_self-&gt;num_prg_banks - 1)])[(__pyx_v_address % __pyx_e_3nes_6cycore_5carts_M2_PRG_ROM_BANK_SIZE)]);
    <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_PyLong_From_unsigned_char, 26, 0, <span class='error_goto'>__PYX_ERR(0, 459, __pyx_L1_error)</span>);
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">460</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">461</span>:     cdef void write(self, int address, unsigned char value):</pre>
<pre class='cython code score-4 '>static void __pyx_f_3nes_6cycore_5carts_8NESCart2_write(struct __pyx_obj_3nes_6cycore_5carts_NESCart2 *__pyx_v_self, int __pyx_v_address, unsigned char __pyx_v_value) {
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[49]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("write", __pyx_f[0], 461, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 461, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  <span class='trace'>__Pyx_TraceReturnValue</span>(Py_None, 0, 0, <span class='error_goto'>__PYX_ERR(0, 461, __pyx_L1_error)</span>);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 461, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart2.write", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">462</span>:         if address &lt; PRG_ROM_START:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_address &lt; __pyx_e_3nes_6cycore_5carts_PRG_ROM_START);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">463</span>:             # RAM access</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">464</span>:             self.ram[address % self.ram_size] = value</pre>
<pre class='cython code score-0 '>    (__pyx_v_self-&gt;__pyx_base.ram[(__pyx_v_address % __pyx_v_self-&gt;__pyx_base.ram_size)]) = __pyx_v_value;
</pre><pre class="cython line score-0">&#xA0;<span class="">465</span>:         else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">466</span>:             # any write to 0x8000 - 0xFFFF is treated as a write to the bank select register</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">467</span>:             if self.emulate_bus_conflicts:</pre>
<pre class='cython code score-0 '>  /*else*/ {
    if (__pyx_v_self-&gt;emulate_bus_conflicts) {
/* … */
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">468</span>:                 # Bus conflicts occur because in some carts the ROM outputs the value in the ROM at the given address at the</pre>
<pre class="cython line score-0">&#xA0;<span class="">469</span>:                 # same time as the CPU is trying to write a value to this prg_bank register.  If they are not in agreement</pre>
<pre class="cython line score-0">&#xA0;<span class="">470</span>:                 # a bus conflict occurs and undefined behaviour can result.  A lot of programs get around this by writing to</pre>
<pre class="cython line score-0">&#xA0;<span class="">471</span>:                 # a location containing a value that agrees with the value being written (e.g. write 1 to 0x8000 when 0x8000</pre>
<pre class="cython line score-0">&#xA0;<span class="">472</span>:                 # contains 1, etc.).  It seems like in general 0 wins in bus conflicts, so they can be implemented by ANDing</pre>
<pre class="cython line score-0">&#xA0;<span class="">473</span>:                 # the value being written with the contents of the memory at the given address.</pre>
<pre class="cython line score-0">&#xA0;<span class="">474</span>:                 # see: https://wiki.nesdev.com/w/index.php/UxROM</pre>
<pre class="cython line score-0">&#xA0;<span class="">475</span>:                 #      https://wiki.nesdev.com/w/index.php/Bus_conflict</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">476</span>:                 value &amp;= self.read(address)</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = ((struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart2 *)__pyx_v_self-&gt;__pyx_base.__pyx_base.__pyx_vtab)-&gt;__pyx_base.__pyx_base.read(((struct __pyx_obj_3nes_6cycore_5carts_NESCart *)__pyx_v_self), __pyx_v_address);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 476, __pyx_L1_error)</span>
      __pyx_v_value = (__pyx_v_value &amp; __pyx_t_2);
</pre><pre class="cython line score-0">&#xA0;<span class="">477</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">478</span>:             self.prg_bank = value % self.num_prg_banks</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;prg_bank = (__pyx_v_value % __pyx_v_self-&gt;num_prg_banks);
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">479</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">480</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">481</span>: ### Mapper 4 (aka MMC3) ################################################################################################</pre>
<pre class="cython line score-0">&#xA0;<span class="">482</span>: # ref: https://wiki.nesdev.com/w/index.php/MMC3</pre>
<pre class="cython line score-0">&#xA0;<span class="">483</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">484</span>: cdef class NESCart4(NESCart):</pre>
<pre class='cython code score-0 '>struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart4 {
  struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart __pyx_base;
  unsigned int (*_get_ppu_bank)(struct __pyx_obj_3nes_6cycore_5carts_NESCart4 *, int);
};
static struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart4 *__pyx_vtabptr_3nes_6cycore_5carts_NESCart4;

</pre><pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">485</span>:     def __init__(self,</pre>
<pre class='cython code score-39 '>/* Python wrapper */
static int __pyx_pw_3nes_6cycore_5carts_8NESCart4_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_3nes_6cycore_5carts_8NESCart4_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_prg_rom_data = 0;
  PyObject *__pyx_v_chr_rom_data = 0;
  PyObject *__pyx_v_chr_mem_writeable = 0;
  PyObject *__pyx_v_prg_ram_size_kb = 0;
  PyObject *__pyx_v_nametable_mirror_pattern = 0;
  PyObject *__pyx_v_mirror_pattern_fixed = 0;
  PyObject *__pyx_v_interrupt_listener = 0;
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__init__ (wrapper)", 0);
  #if CYTHON_ASSUME_SAFE_SIZE
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return -1;
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_VARARGS</span>(__pyx_args, __pyx_nargs);
  {
    PyObject ** const __pyx_pyargnames[] = {&amp;__pyx_mstate_global-&gt;__pyx_n_u_prg_rom_data,&amp;__pyx_mstate_global-&gt;__pyx_n_u_chr_rom_data,&amp;__pyx_mstate_global-&gt;__pyx_n_u_chr_mem_writeable,&amp;__pyx_mstate_global-&gt;__pyx_n_u_prg_ram_size_kb,&amp;__pyx_mstate_global-&gt;__pyx_n_u_nametable_mirror_pattern,&amp;__pyx_mstate_global-&gt;__pyx_n_u_mirror_pattern_fixed,&amp;__pyx_mstate_global-&gt;__pyx_n_u_interrupt_listener,0};
  PyObject* values[7] = {0,0,0,0,0,0,0};
    const Py_ssize_t __pyx_kwds_len = (__pyx_kwds) ? <span class='pyx_c_api'>__Pyx_NumKwargs_VARARGS</span>(__pyx_kwds) : 0;
    if (unlikely(__pyx_kwds_len) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L3_error)</span>
    if (__pyx_kwds_len &gt; 0) {
      switch (__pyx_nargs) {
        case  7:
        values[6] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 6);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[6])) <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  6:
        values[5] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 5);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[5])) <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  5:
        values[4] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 4);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[4])) <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  4:
        values[3] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 3);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[3])) <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  3:
        values[2] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 2);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[2])) <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  2:
        values[1] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 1);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[1])) <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  1:
        values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 0);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      const Py_ssize_t kwd_pos_args = __pyx_nargs;
      if (<span class='pyx_c_api'>__Pyx_ParseKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values, kwd_pos_args, __pyx_kwds_len, "__init__", 0) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L3_error)</span>
/* … */
  /* function exit code */
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static int __pyx_pf_3nes_6cycore_5carts_8NESCart4___init__(struct __pyx_obj_3nes_6cycore_5carts_NESCart4 *__pyx_v_self, PyObject *__pyx_v_prg_rom_data, PyObject *__pyx_v_chr_rom_data, PyObject *__pyx_v_chr_mem_writeable, PyObject *__pyx_v_prg_ram_size_kb, PyObject *__pyx_v_nametable_mirror_pattern, PyObject *__pyx_v_mirror_pattern_fixed, PyObject *__pyx_v_interrupt_listener) {
  PyObject *__pyx_v_bnk = NULL;
  PyObject *__pyx_v_i = NULL;
  int __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[52]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("__init__", __pyx_f[0], 485, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_r = 0;
  <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_Owned_Py_None, 0, 0, <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L1_error)</span>);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart4.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_bnk);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_i);
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">486</span>:                  prg_rom_data=None,</pre>
<pre class='cython code score-4 '>      if (!values[0]) values[0] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
/* … */
      if (!values[0]) values[0] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">487</span>:                  chr_rom_data=None,</pre>
<pre class='cython code score-4 '>      if (!values[1]) values[1] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
/* … */
      if (!values[1]) values[1] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">488</span>:                  chr_mem_writeable=False, # if True, the CHR memory is actually RAM, not ROM</pre>
<pre class='cython code score-8 '>      if (!values[2]) values[2] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_False));
      if (!values[3]) values[3] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_int_8));
/* … */
      if (!values[2]) values[2] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_False));
      if (!values[3]) values[3] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_int_8));
</pre><pre class="cython line score-0">&#xA0;<span class="">489</span>:                  prg_ram_size_kb=8,       # size of prg RAM; must 8kb or 0</pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">490</span>:                  nametable_mirror_pattern=MIRROR_HORIZONTAL,</pre>
<pre class='cython code score-4 '>      if (!values[4]) values[4] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_tuple[2]));
/* … */
      if (!values[4]) values[4] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_tuple[2]));
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">491</span>:                  mirror_pattern_fixed=False,  # if true, the mirror pattern cannot be changed dynamically</pre>
<pre class='cython code score-4 '>      if (!values[5]) values[5] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_False));
/* … */
      if (!values[5]) values[5] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_False));
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">492</span>:                  interrupt_listener=None,</pre>
<pre class='cython code score-22 '>      if (!values[6]) values[6] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
    } else {
      switch (__pyx_nargs) {
        case  7:
        values[6] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 6);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[6])) <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  6:
        values[5] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 5);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[5])) <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  5:
        values[4] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 4);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[4])) <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  4:
        values[3] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 3);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[3])) <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  3:
        values[2] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 2);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[2])) <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  2:
        values[1] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 1);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[1])) <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  1:
        values[0] = <span class='pyx_c_api'>__Pyx_ArgRef_VARARGS</span>(__pyx_args, 0);
        if (!CYTHON_ASSUME_SAFE_MACROS &amp;&amp; unlikely(!values[0])) <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L3_error)</span>
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
/* … */
      if (!values[6]) values[6] = <span class='pyx_c_api'>__Pyx_NewRef</span>(((PyObject *)Py_None));
    }
    __pyx_v_prg_rom_data = values[0];
    __pyx_v_chr_rom_data = values[1];
    __pyx_v_chr_mem_writeable = values[2];
    __pyx_v_prg_ram_size_kb = values[3];
    __pyx_v_nametable_mirror_pattern = values[4];
    __pyx_v_mirror_pattern_fixed = values[5];
    __pyx_v_interrupt_listener = values[6];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 0, 7, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 485, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  for (Py_ssize_t __pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
    Py_XDECREF(values[__pyx_temp]);
  }
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart4.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3nes_6cycore_5carts_8NESCart4___init__(((struct __pyx_obj_3nes_6cycore_5carts_NESCart4 *)__pyx_v_self), __pyx_v_prg_rom_data, __pyx_v_chr_rom_data, __pyx_v_chr_mem_writeable, __pyx_v_prg_ram_size_kb, __pyx_v_nametable_mirror_pattern, __pyx_v_mirror_pattern_fixed, __pyx_v_interrupt_listener);
</pre><pre class="cython line score-0">&#xA0;<span class="">493</span>:                 ):</pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">494</span>:         super().__init__()</pre>
<pre class='cython code score-11 '>  __pyx_t_4 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_super);
  __pyx_t_5 = __pyx_builtin_super; 
  __pyx_t_6 = 1;
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_4, ((PyObject *)__pyx_mstate_global-&gt;__pyx_ptype_3nes_6cycore_5carts_NESCart4), ((PyObject *)__pyx_v_self)};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_5, __pyx_callargs+__pyx_t_6, (3-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 494, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  }
  __pyx_t_2 = __pyx_t_3;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
  __pyx_t_6 = 0;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, NULL};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCallMethod</span>(__pyx_mstate_global-&gt;__pyx_n_u_init, __pyx_callargs+__pyx_t_6, (1-__pyx_t_6) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 494, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">495</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">496</span>:         if prg_ram_size_kb != 8 and prg_ram_size_kb != 0:</pre>
<pre class='cython code score-4 '>  __pyx_t_8 = (<span class='pyx_c_api'>__Pyx_PyLong_BoolNeObjC</span>(__pyx_v_prg_ram_size_kb, __pyx_mstate_global-&gt;__pyx_int_8, 8, 0)); if (unlikely((__pyx_t_8 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 496, __pyx_L1_error)</span>
  if (__pyx_t_8) {
  } else {
    __pyx_t_7 = __pyx_t_8;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_8 = (<span class='pyx_c_api'>__Pyx_PyLong_BoolNeObjC</span>(__pyx_v_prg_ram_size_kb, __pyx_mstate_global-&gt;__pyx_int_0, 0, 0)); if (unlikely((__pyx_t_8 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 496, __pyx_L1_error)</span>
  __pyx_t_7 = __pyx_t_8;
  __pyx_L4_bool_binop_done:;
  if (unlikely(__pyx_t_7)) {
/* … */
  }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">497</span>:             raise ValueError("PRG RAM size must be 8kb or 0")</pre>
<pre class='cython code score-8 '>    __pyx_t_3 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_ValueError);
    __pyx_t_2 = __pyx_builtin_ValueError; 
    __pyx_t_6 = 1;
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_mstate_global-&gt;__pyx_kp_u_PRG_RAM_size_must_be_8kb_or_0};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_2, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 497, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    }
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='error_goto'>__PYX_ERR(0, 497, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">498</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">499</span>:         # copy the prg rom data to the memory banks</pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">500</span>:         self.num_prg_banks = int(len(prg_rom_data) / M4_PRG_ROM_BANK_SIZE)</pre>
<pre class='cython code score-5 '>  __pyx_t_9 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_prg_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 500, __pyx_L1_error)</span>
  __pyx_v_self-&gt;num_prg_banks = ((int)(__pyx_t_9 / ((Py_ssize_t)__pyx_e_3nes_6cycore_5carts_M4_PRG_ROM_BANK_SIZE)));
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">501</span>:         print("PRG bytes: {}".format(len(prg_rom_data)))</pre>
<pre class='cython code score-22 '>  __pyx_t_2 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_print);
  __pyx_t_3 = __pyx_builtin_print; 
  __pyx_t_4 = __pyx_mstate_global-&gt;__pyx_kp_u_PRG_bytes;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
  __pyx_t_9 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_prg_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 501, __pyx_L1_error)</span>
  __pyx_t_10 = <span class='py_c_api'>PyLong_FromSsize_t</span>(__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 501, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_6 = 0;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_10};
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCallMethod</span>(__pyx_mstate_global-&gt;__pyx_n_u_format, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 501, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  }
  __pyx_t_6 = 1;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_t_5};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 501, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">502</span>:         print("Num PRG banks: {}".format(self.num_prg_banks))</pre>
<pre class='cython code score-14 '>  __pyx_t_3 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_print);
  __pyx_t_5 = __pyx_builtin_print; 
  __pyx_t_10 = __pyx_mstate_global-&gt;__pyx_kp_u_Num_PRG_banks;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>(__pyx_v_self-&gt;num_prg_banks);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 502, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_6 = 0;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_t_4};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_FastCallMethod</span>(__pyx_mstate_global-&gt;__pyx_n_u_format, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 502, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  }
  __pyx_t_6 = 1;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_2};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_5, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 502, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">503</span>:         if self.num_prg_banks * M4_PRG_ROM_BANK_SIZE != len(prg_rom_data):</pre>
<pre class='cython code score-5 '>  __pyx_t_9 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_prg_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 503, __pyx_L1_error)</span>
  __pyx_t_7 = ((__pyx_v_self-&gt;num_prg_banks * __pyx_e_3nes_6cycore_5carts_M4_PRG_ROM_BANK_SIZE) != __pyx_t_9);
  if (unlikely(__pyx_t_7)) {
/* … */
  }
</pre><pre class="cython line score-27" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">504</span>:             raise ValueError("prg_rom_data size ({} bytes) is not an exact multiple of bank size ({} bytes)".format(len(prg_rom_data), M4_PRG_ROM_BANK_SIZE))</pre>
<pre class='cython code score-27 '>    __pyx_t_5 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_ValueError);
    __pyx_t_2 = __pyx_builtin_ValueError; 
    __pyx_t_4 = __pyx_mstate_global-&gt;__pyx_kp_u_prg_rom_data_size_bytes_is_not_a;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
    __pyx_t_9 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_prg_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 504, __pyx_L1_error)</span>
    __pyx_t_10 = <span class='py_c_api'>PyLong_FromSsize_t</span>(__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 504, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyLong_From___pyx_anon_enum</span>(__pyx_e_3nes_6cycore_5carts_M4_PRG_ROM_BANK_SIZE);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 504, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    __pyx_t_6 = 0;
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_4, __pyx_t_10, __pyx_t_11};
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_FastCallMethod</span>(__pyx_mstate_global-&gt;__pyx_n_u_format, __pyx_callargs+__pyx_t_6, (3-__pyx_t_6) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 504, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    }
    __pyx_t_6 = 1;
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_t_3};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_2, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 504, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    }
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='error_goto'>__PYX_ERR(0, 504, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">505</span>:         if self.num_prg_banks &gt; M4_MAX_PRG_BANKS:</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = (__pyx_v_self-&gt;num_prg_banks &gt; __pyx_e_3nes_6cycore_5carts_M4_MAX_PRG_BANKS);
  if (unlikely(__pyx_t_7)) {
/* … */
  }
</pre><pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">506</span>:             raise ValueError("Too much prg rom data ({} bytes) for a MMC3 cartridge (max is 512kb)".format(len(prg_rom_data)))</pre>
<pre class='cython code score-24 '>    __pyx_t_2 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_ValueError);
    __pyx_t_3 = __pyx_builtin_ValueError; 
    __pyx_t_11 = __pyx_mstate_global-&gt;__pyx_kp_u_Too_much_prg_rom_data_bytes_for;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_11);
    __pyx_t_9 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_prg_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 506, __pyx_L1_error)</span>
    __pyx_t_10 = <span class='py_c_api'>PyLong_FromSsize_t</span>(__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 506, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_6 = 0;
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_11, __pyx_t_10};
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCallMethod</span>(__pyx_mstate_global-&gt;__pyx_n_u_format, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 506, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    }
    __pyx_t_6 = 1;
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_t_5};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 506, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    }
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='error_goto'>__PYX_ERR(0, 506, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">507</span>: </pre>
<pre class="cython line score-57" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">508</span>:         for bnk in range(self.num_prg_banks):</pre>
<pre class='cython code score-57 '>  __pyx_t_3 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_range);
  __pyx_t_5 = __pyx_builtin_range; 
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>(__pyx_v_self-&gt;num_prg_banks);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 508, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_6 = 1;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_2};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_5, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 508, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  }
  if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
    __pyx_t_5 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
    __pyx_t_9 = 0;
    __pyx_t_12 = NULL;
  } else {
    __pyx_t_9 = -1; __pyx_t_5 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 508, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_12 = (CYTHON_COMPILING_IN_LIMITED_API) ? PyIter_Next : <span class='pyx_c_api'>__Pyx_PyObject_GetIterNextFunc</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 508, __pyx_L1_error)</span>
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_12)) {
      if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5))) {
        {
          Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyList_GET_SIZE</span>(__pyx_t_5);
          #if !CYTHON_ASSUME_SAFE_SIZE
          if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 508, __pyx_L1_error)</span>
          #endif
          if (__pyx_t_9 &gt;= __pyx_temp) break;
        }
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyList_GetItemRef</span>(__pyx_t_5, __pyx_t_9);
        ++__pyx_t_9;
      } else {
        {
          Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyTuple_GET_SIZE</span>(__pyx_t_5);
          #if !CYTHON_ASSUME_SAFE_SIZE
          if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 508, __pyx_L1_error)</span>
          #endif
          if (__pyx_t_9 &gt;= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_NewRef</span>(<span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_5, __pyx_t_9));
        #else
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PySequence_ITEM</span>(__pyx_t_5, __pyx_t_9);
        #endif
        ++__pyx_t_9;
      }
      if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 508, __pyx_L1_error)</span>
    } else {
      __pyx_t_1 = __pyx_t_12(__pyx_t_5);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (unlikely(!<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='error_goto'>__PYX_ERR(0, 508, __pyx_L1_error)</span>
          <span class='py_c_api'>PyErr_Clear</span>();
        }
        break;
      }
    }
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_bnk, __pyx_t_1);
    __pyx_t_1 = 0;
/* … */
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-57" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">509</span>:             for i in range(M4_PRG_ROM_BANK_SIZE):</pre>
<pre class='cython code score-57 '>    __pyx_t_2 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_range);
    __pyx_t_3 = __pyx_builtin_range; 
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyLong_From___pyx_anon_enum</span>(__pyx_e_3nes_6cycore_5carts_M4_PRG_ROM_BANK_SIZE);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 509, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_6 = 1;
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_t_10};
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 509, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    }
    if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1)) {
      __pyx_t_3 = __pyx_t_1; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      __pyx_t_13 = 0;
      __pyx_t_14 = NULL;
    } else {
      __pyx_t_13 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 509, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_14 = (CYTHON_COMPILING_IN_LIMITED_API) ? PyIter_Next : <span class='pyx_c_api'>__Pyx_PyObject_GetIterNextFunc</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 509, __pyx_L1_error)</span>
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    for (;;) {
      if (likely(!__pyx_t_14)) {
        if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3))) {
          {
            Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyList_GET_SIZE</span>(__pyx_t_3);
            #if !CYTHON_ASSUME_SAFE_SIZE
            if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 509, __pyx_L1_error)</span>
            #endif
            if (__pyx_t_13 &gt;= __pyx_temp) break;
          }
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyList_GetItemRef</span>(__pyx_t_3, __pyx_t_13);
          ++__pyx_t_13;
        } else {
          {
            Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyTuple_GET_SIZE</span>(__pyx_t_3);
            #if !CYTHON_ASSUME_SAFE_SIZE
            if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 509, __pyx_L1_error)</span>
            #endif
            if (__pyx_t_13 &gt;= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_NewRef</span>(<span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_13));
          #else
          __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PySequence_ITEM</span>(__pyx_t_3, __pyx_t_13);
          #endif
          ++__pyx_t_13;
        }
        if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 509, __pyx_L1_error)</span>
      } else {
        __pyx_t_1 = __pyx_t_14(__pyx_t_3);
        if (unlikely(!__pyx_t_1)) {
          PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
          if (exc_type) {
            if (unlikely(!<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='error_goto'>__PYX_ERR(0, 509, __pyx_L1_error)</span>
            <span class='py_c_api'>PyErr_Clear</span>();
          }
          break;
        }
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_i, __pyx_t_1);
      __pyx_t_1 = 0;
/* … */
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">510</span>:                 self.banked_prg_rom[bnk][i] = prg_rom_data[bnk * M4_PRG_ROM_BANK_SIZE + i]</pre>
<pre class='cython code score-39 '>      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyLong_From___pyx_anon_enum</span>(__pyx_e_3nes_6cycore_5carts_M4_PRG_ROM_BANK_SIZE);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 510, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_bnk, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 510, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_10, __pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 510, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(__pyx_v_prg_rom_data, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 510, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyLong_As_unsigned_char</span>(__pyx_t_10); if (unlikely((__pyx_t_15 == (unsigned char)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 510, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_bnk); if (unlikely((__pyx_t_16 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 510, __pyx_L1_error)</span>
      __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_i); if (unlikely((__pyx_t_17 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 510, __pyx_L1_error)</span>
      ((__pyx_v_self-&gt;banked_prg_rom[__pyx_t_16])[__pyx_t_17]) = __pyx_t_15;
</pre><pre class="cython line score-0">&#xA0;<span class="">511</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">512</span>:         # copy the chr rom data to the memory banks</pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">513</span>:         self.num_chr_banks = int(len(chr_rom_data) / M4_CHR_ROM_BANK_SIZE)</pre>
<pre class='cython code score-5 '>  __pyx_t_9 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_chr_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 513, __pyx_L1_error)</span>
  __pyx_v_self-&gt;num_chr_banks = ((int)(__pyx_t_9 / ((Py_ssize_t)__pyx_e_3nes_6cycore_5carts_M4_CHR_ROM_BANK_SIZE)));
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">514</span>:         print("CHR bytes: {}".format(len(chr_rom_data)))</pre>
<pre class='cython code score-22 '>  __pyx_t_3 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_print);
  __pyx_t_10 = __pyx_builtin_print; 
  __pyx_t_2 = __pyx_mstate_global-&gt;__pyx_kp_u_CHR_bytes;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
  __pyx_t_9 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_chr_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 514, __pyx_L1_error)</span>
  __pyx_t_11 = <span class='py_c_api'>PyLong_FromSsize_t</span>(__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 514, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  __pyx_t_6 = 0;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_t_11};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCallMethod</span>(__pyx_mstate_global-&gt;__pyx_n_u_format, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 514, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  }
  __pyx_t_6 = 1;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_1};
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_10, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 514, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">515</span>:         print("Num CHR banks: {}".format(self.num_chr_banks))</pre>
<pre class='cython code score-14 '>  __pyx_t_10 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_print);
  __pyx_t_1 = __pyx_builtin_print; 
  __pyx_t_11 = __pyx_mstate_global-&gt;__pyx_kp_u_Num_CHR_banks;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_11);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>(__pyx_v_self-&gt;num_chr_banks);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 515, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_6 = 0;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_11, __pyx_t_2};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_FastCallMethod</span>(__pyx_mstate_global-&gt;__pyx_n_u_format, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 515, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  }
  __pyx_t_6 = 1;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_t_3};
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_1, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 515, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">516</span>:         if self.num_chr_banks * M4_CHR_ROM_BANK_SIZE != len(chr_rom_data):</pre>
<pre class='cython code score-5 '>  __pyx_t_9 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_chr_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 516, __pyx_L1_error)</span>
  __pyx_t_7 = ((__pyx_v_self-&gt;num_chr_banks * __pyx_e_3nes_6cycore_5carts_M4_CHR_ROM_BANK_SIZE) != __pyx_t_9);
  if (unlikely(__pyx_t_7)) {
/* … */
  }
</pre><pre class="cython line score-27" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">517</span>:             raise ValueError("chr_rom_data size ({} bytes) is not an exact multiple of bank size ({} bytes)".format(len(chr_rom_data), M4_CHR_ROM_BANK_SIZE))</pre>
<pre class='cython code score-27 '>    __pyx_t_1 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_ValueError);
    __pyx_t_3 = __pyx_builtin_ValueError; 
    __pyx_t_2 = __pyx_mstate_global-&gt;__pyx_kp_u_chr_rom_data_size_bytes_is_not_a;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    __pyx_t_9 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_chr_rom_data);<span class='error_goto'> if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 517, __pyx_L1_error)</span>
    __pyx_t_11 = <span class='py_c_api'>PyLong_FromSsize_t</span>(__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 517, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyLong_From___pyx_anon_enum</span>(__pyx_e_3nes_6cycore_5carts_M4_CHR_ROM_BANK_SIZE);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 517, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_6 = 0;
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_2, __pyx_t_11, __pyx_t_4};
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_FastCallMethod</span>(__pyx_mstate_global-&gt;__pyx_n_u_format, __pyx_callargs+__pyx_t_6, (3-__pyx_t_6) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_10)) <span class='error_goto'>__PYX_ERR(0, 517, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    }
    __pyx_t_6 = 1;
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_10};
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 517, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    }
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_5, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='error_goto'>__PYX_ERR(0, 517, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">518</span>: </pre>
<pre class="cython line score-57" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">519</span>:         for bnk in range(self.num_chr_banks):</pre>
<pre class='cython code score-57 '>  __pyx_t_3 = NULL;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_range);
  __pyx_t_10 = __pyx_builtin_range; 
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>(__pyx_v_self-&gt;num_chr_banks);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 519, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_6 = 1;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_1};
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_10, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  }
  if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_5)) {
    __pyx_t_10 = __pyx_t_5; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
    __pyx_t_9 = 0;
    __pyx_t_12 = NULL;
  } else {
    __pyx_t_9 = -1; __pyx_t_10 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 519, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_12 = (CYTHON_COMPILING_IN_LIMITED_API) ? PyIter_Next : <span class='pyx_c_api'>__Pyx_PyObject_GetIterNextFunc</span>(__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 519, __pyx_L1_error)</span>
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  for (;;) {
    if (likely(!__pyx_t_12)) {
      if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_10))) {
        {
          Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyList_GET_SIZE</span>(__pyx_t_10);
          #if !CYTHON_ASSUME_SAFE_SIZE
          if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L1_error)</span>
          #endif
          if (__pyx_t_9 &gt;= __pyx_temp) break;
        }
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyList_GetItemRef</span>(__pyx_t_10, __pyx_t_9);
        ++__pyx_t_9;
      } else {
        {
          Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyTuple_GET_SIZE</span>(__pyx_t_10);
          #if !CYTHON_ASSUME_SAFE_SIZE
          if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L1_error)</span>
          #endif
          if (__pyx_t_9 &gt;= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_NewRef</span>(<span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_10, __pyx_t_9));
        #else
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PySequence_ITEM</span>(__pyx_t_10, __pyx_t_9);
        #endif
        ++__pyx_t_9;
      }
      if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L1_error)</span>
    } else {
      __pyx_t_5 = __pyx_t_12(__pyx_t_10);
      if (unlikely(!__pyx_t_5)) {
        PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
        if (exc_type) {
          if (unlikely(!<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L1_error)</span>
          <span class='py_c_api'>PyErr_Clear</span>();
        }
        break;
      }
    }
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_bnk, __pyx_t_5);
    __pyx_t_5 = 0;
/* … */
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
</pre><pre class="cython line score-57" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">520</span>:             for i in range(M4_CHR_ROM_BANK_SIZE):</pre>
<pre class='cython code score-57 '>    __pyx_t_1 = NULL;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_builtin_range);
    __pyx_t_3 = __pyx_builtin_range; 
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyLong_From___pyx_anon_enum</span>(__pyx_e_3nes_6cycore_5carts_M4_CHR_ROM_BANK_SIZE);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 520, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_6 = 1;
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_4};
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+__pyx_t_6, (2-__pyx_t_6) | (__pyx_t_6*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 520, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    }
    if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_5)) || <span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_5)) {
      __pyx_t_3 = __pyx_t_5; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      __pyx_t_13 = 0;
      __pyx_t_14 = NULL;
    } else {
      __pyx_t_13 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 520, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_14 = (CYTHON_COMPILING_IN_LIMITED_API) ? PyIter_Next : <span class='pyx_c_api'>__Pyx_PyObject_GetIterNextFunc</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 520, __pyx_L1_error)</span>
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    for (;;) {
      if (likely(!__pyx_t_14)) {
        if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3))) {
          {
            Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyList_GET_SIZE</span>(__pyx_t_3);
            #if !CYTHON_ASSUME_SAFE_SIZE
            if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 520, __pyx_L1_error)</span>
            #endif
            if (__pyx_t_13 &gt;= __pyx_temp) break;
          }
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyList_GetItemRef</span>(__pyx_t_3, __pyx_t_13);
          ++__pyx_t_13;
        } else {
          {
            Py_ssize_t __pyx_temp = <span class='pyx_c_api'>__Pyx_PyTuple_GET_SIZE</span>(__pyx_t_3);
            #if !CYTHON_ASSUME_SAFE_SIZE
            if (unlikely((__pyx_temp &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 520, __pyx_L1_error)</span>
            #endif
            if (__pyx_t_13 &gt;= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_NewRef</span>(<span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_13));
          #else
          __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PySequence_ITEM</span>(__pyx_t_3, __pyx_t_13);
          #endif
          ++__pyx_t_13;
        }
        if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 520, __pyx_L1_error)</span>
      } else {
        __pyx_t_5 = __pyx_t_14(__pyx_t_3);
        if (unlikely(!__pyx_t_5)) {
          PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
          if (exc_type) {
            if (unlikely(!<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='error_goto'>__PYX_ERR(0, 520, __pyx_L1_error)</span>
            <span class='py_c_api'>PyErr_Clear</span>();
          }
          break;
        }
      }
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_i, __pyx_t_5);
      __pyx_t_5 = 0;
/* … */
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">521</span>:                 self.banked_chr_rom[bnk][i] = chr_rom_data[bnk * M4_CHR_ROM_BANK_SIZE + i]</pre>
<pre class='cython code score-39 '>      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyLong_From___pyx_anon_enum</span>(__pyx_e_3nes_6cycore_5carts_M4_CHR_ROM_BANK_SIZE);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 521, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_4 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_bnk, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 521, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_4, __pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 521, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(__pyx_v_chr_rom_data, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 521, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyLong_As_unsigned_char</span>(__pyx_t_4); if (unlikely((__pyx_t_15 == (unsigned char)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 521, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_bnk); if (unlikely((__pyx_t_17 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 521, __pyx_L1_error)</span>
      __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_i); if (unlikely((__pyx_t_16 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 521, __pyx_L1_error)</span>
      ((__pyx_v_self-&gt;banked_chr_rom[__pyx_t_17])[__pyx_t_16]) = __pyx_t_15;
</pre><pre class="cython line score-0">&#xA0;<span class="">522</span>: </pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">523</span>:         self.chr_mem_writeable = chr_mem_writeable</pre>
<pre class='cython code score-7 '>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_chr_mem_writeable); if (unlikely((__pyx_t_7 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 523, __pyx_L1_error)</span>
  __pyx_v_self-&gt;chr_mem_writeable = __pyx_t_7;
</pre><pre class="cython line score-0">&#xA0;<span class="">524</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">525</span>:         # todo is this the right thing to do here?</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">526</span>:         if self.num_chr_banks == 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = (__pyx_v_self-&gt;num_chr_banks == 0);
  if (__pyx_t_7) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">527</span>:             # if there is no chr rom, make a full-sized block of chr ram (overwrites user requested chr_mem_writeable)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">528</span>:             self.num_chr_banks = 256</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;num_chr_banks = 0x100;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">529</span>:             self.chr_mem_writeable = True</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;chr_mem_writeable = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">530</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">531</span>:         # set the startup state of the cart</pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">532</span>:         self.interrupt_listener = interrupt_listener</pre>
<pre class='cython code score-4 '>  __pyx_t_10 = __pyx_v_interrupt_listener;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
  if (!(likely(((__pyx_t_10) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_10, __pyx_mstate_global-&gt;__pyx_ptype_3nes_6cycore_6system_InterruptListener))))) <span class='error_goto'>__PYX_ERR(0, 532, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
  <span class='refnanny'>__Pyx_GOTREF</span>((PyObject *)__pyx_v_self-&gt;interrupt_listener);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>((PyObject *)__pyx_v_self-&gt;interrupt_listener);
  __pyx_v_self-&gt;interrupt_listener = ((struct __pyx_obj_3nes_6cycore_6system_InterruptListener *)__pyx_t_10);
  __pyx_t_10 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">533</span>:         self.bank_register[:] = [0, 2, 4, 5, 6, 7, 0, 1]   # copied these from somewhere (didn't help with GunNac)</pre>
<pre class='cython code score-0 '>  __pyx_t_18[0] = 0;
  __pyx_t_18[1] = 2;
  __pyx_t_18[2] = 4;
  __pyx_t_18[3] = 5;
  __pyx_t_18[4] = 6;
  __pyx_t_18[5] = 7;
  __pyx_t_18[6] = 0;
  __pyx_t_18[7] = 1;
  memcpy(&amp;(__pyx_v_self-&gt;bank_register[0]), __pyx_t_18, sizeof(__pyx_v_self-&gt;bank_register[0]) * (8));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">534</span>:         self.chr_a12_inversion = False</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;chr_a12_inversion = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">535</span>:         self.prg_bank_mode = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;prg_bank_mode = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">536</span>:         self.bank_select = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;bank_select = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">537</span>:         self.prg_ram_enable = True</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;prg_ram_enable = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">538</span>:         self.prg_ram_protect = False</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;prg_ram_protect = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">539</span>:         self.irq_reload_value = 0xFF</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;irq_reload_value = 0xFF;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">540</span>:         self.irq_enabled = True</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;irq_enabled = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">541</span>:         self.irq_counter = 0xFF</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;irq_counter = 0xFF;
</pre><pre class="cython line score-0">&#xA0;<span class="">542</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">543</span>:         # set the nametable mirror pattern</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">544</span>:         self.nametable_mirror_pattern[:] = nametable_mirror_pattern</pre>
<pre class='cython code score-0 '>  if (unlikely((__Pyx_carray_from_py_int(__pyx_v_nametable_mirror_pattern, __pyx_t_19, 4) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 544, __pyx_L1_error)</span>
  memcpy(&amp;(__pyx_v_self-&gt;__pyx_base.nametable_mirror_pattern[0]), __pyx_t_19, sizeof(__pyx_v_self-&gt;__pyx_base.nametable_mirror_pattern[0]) * (4));
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">545</span>:         self.mirror_pattern_fixed = mirror_pattern_fixed</pre>
<pre class='cython code score-7 '>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_mirror_pattern_fixed); if (unlikely((__pyx_t_7 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L1_error)</span>
  __pyx_v_self-&gt;mirror_pattern_fixed = __pyx_t_7;
</pre><pre class="cython line score-0">&#xA0;<span class="">546</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">547</span>:     cdef unsigned char read(self, int address):</pre>
<pre class='cython code score-4 '>static unsigned char __pyx_f_3nes_6cycore_5carts_8NESCart4_read(struct __pyx_obj_3nes_6cycore_5carts_NESCart4 *__pyx_v_self, int __pyx_v_address) {
  int __pyx_v_window_slot;
  int __pyx_v_banks[4];
  unsigned char __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[53]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("read", __pyx_f[0], 547, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_r = 0;
  <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_PyLong_From_unsigned_char, 0, 0, <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L1_error)</span>);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart4.read", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">548</span>:         cdef int window_slot</pre>
<pre class="cython line score-0">&#xA0;<span class="">549</span>:         cdef int banks[4]</pre>
<pre class="cython line score-0">&#xA0;<span class="">550</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">551</span>:         if M4_PRG_RAM_START &lt;= address &lt; M4_PRG_ROM_START:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_e_3nes_6cycore_5carts_M4_PRG_RAM_START &lt;= __pyx_v_address);
  if (__pyx_t_1) {
    __pyx_t_1 = (__pyx_v_address &lt; __pyx_e_3nes_6cycore_5carts_M4_PRG_ROM_START);
  }
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">552</span>:             if self.prg_ram_enable:</pre>
<pre class='cython code score-0 '>    if (__pyx_v_self-&gt;prg_ram_enable) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">553</span>:                 return self.ram[address % M4_PRG_RAM_SIZE]</pre>
<pre class='cython code score-0 '>      __pyx_r = (__pyx_v_self-&gt;ram[(__pyx_v_address % __pyx_e_3nes_6cycore_5carts_M4_PRG_RAM_SIZE)]);
      <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_PyLong_From_unsigned_char, 9, 0, <span class='error_goto'>__PYX_ERR(0, 553, __pyx_L1_error)</span>);
      goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">554</span>:             else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">555</span>:                 # todo: open bus behaviour</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">556</span>:                 return 0</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_r = 0;
      <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_PyLong_From_unsigned_char, 16, 0, <span class='error_goto'>__PYX_ERR(0, 556, __pyx_L1_error)</span>);
      goto __pyx_L0;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">557</span>:         elif M4_PRG_ROM_START &lt;= address:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_e_3nes_6cycore_5carts_M4_PRG_ROM_START &lt;= __pyx_v_address);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">558</span>:             if self.prg_bank_mode == 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = (__pyx_v_self-&gt;prg_bank_mode == 0);
    if (__pyx_t_1) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">559</span>:                 # bank map in mode 0</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">560</span>:                 banks[0] = self.bank_register[6] &amp; 0b00111111</pre>
<pre class='cython code score-0 '>      (__pyx_v_banks[0]) = ((__pyx_v_self-&gt;bank_register[6]) &amp; 63);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">561</span>:                 banks[1] = self.bank_register[7] &amp; 0b00111111</pre>
<pre class='cython code score-0 '>      (__pyx_v_banks[1]) = ((__pyx_v_self-&gt;bank_register[7]) &amp; 63);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">562</span>:                 banks[2] = self.num_prg_banks - 2</pre>
<pre class='cython code score-0 '>      (__pyx_v_banks[2]) = (__pyx_v_self-&gt;num_prg_banks - 2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">563</span>:                 banks[3] = self.num_prg_banks - 1</pre>
<pre class='cython code score-0 '>      (__pyx_v_banks[3]) = (__pyx_v_self-&gt;num_prg_banks - 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">564</span>:             else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">565</span>:                 # bank map in mode 1</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">566</span>:                 banks[0] = self.num_prg_banks - 2</pre>
<pre class='cython code score-0 '>    /*else*/ {
      (__pyx_v_banks[0]) = (__pyx_v_self-&gt;num_prg_banks - 2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">567</span>:                 banks[1] = self.bank_register[7] &amp; 0b00111111</pre>
<pre class='cython code score-0 '>      (__pyx_v_banks[1]) = ((__pyx_v_self-&gt;bank_register[7]) &amp; 63);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">568</span>:                 banks[2] = self.bank_register[6] &amp; 0b00111111</pre>
<pre class='cython code score-0 '>      (__pyx_v_banks[2]) = ((__pyx_v_self-&gt;bank_register[6]) &amp; 63);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">569</span>:                 banks[3] = self.num_prg_banks - 1</pre>
<pre class='cython code score-0 '>      (__pyx_v_banks[3]) = (__pyx_v_self-&gt;num_prg_banks - 1);
    }
    __pyx_L5:;
</pre><pre class="cython line score-0">&#xA0;<span class="">570</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">571</span>:             window_slot = (address &gt;&gt; 13) &amp; 0b11     # address lines A13 and A14 determine the prg rom slot of address</pre>
<pre class='cython code score-0 '>    __pyx_v_window_slot = ((__pyx_v_address &gt;&gt; 13) &amp; 3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">572</span>:             return self.banked_prg_rom[banks[window_slot] % self.num_prg_banks][address % M4_PRG_ROM_BANK_SIZE]</pre>
<pre class='cython code score-0 '>    __pyx_r = ((__pyx_v_self-&gt;banked_prg_rom[((__pyx_v_banks[__pyx_v_window_slot]) % __pyx_v_self-&gt;num_prg_banks)])[(__pyx_v_address % __pyx_e_3nes_6cycore_5carts_M4_PRG_ROM_BANK_SIZE)]);
    <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_PyLong_From_unsigned_char, 96, 0, <span class='error_goto'>__PYX_ERR(0, 572, __pyx_L1_error)</span>);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">573</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">574</span>:     cdef void write(self, int address, unsigned char value):</pre>
<pre class='cython code score-4 '>static void __pyx_f_3nes_6cycore_5carts_8NESCart4_write(struct __pyx_obj_3nes_6cycore_5carts_NESCart4 *__pyx_v_self, int __pyx_v_address, unsigned char __pyx_v_value) {
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[54]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("write", __pyx_f[0], 574, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 574, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  <span class='trace'>__Pyx_TraceReturnValue</span>(Py_None, 0, 0, <span class='error_goto'>__PYX_ERR(0, 574, __pyx_L1_error)</span>);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 574, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart4.write", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">575</span>:         if M4_PRG_RAM_START &lt;= address &lt; M4_PRG_ROM_START:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_e_3nes_6cycore_5carts_M4_PRG_RAM_START &lt;= __pyx_v_address);
  if (__pyx_t_1) {
    __pyx_t_1 = (__pyx_v_address &lt; __pyx_e_3nes_6cycore_5carts_M4_PRG_ROM_START);
  }
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">576</span>:             # ram write</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">577</span>:             if self.prg_ram_enable and not self.prg_ram_protect:</pre>
<pre class='cython code score-0 '>    if (__pyx_v_self-&gt;prg_ram_enable) {
    } else {
      __pyx_t_1 = __pyx_v_self-&gt;prg_ram_enable;
      goto __pyx_L5_bool_binop_done;
    }
    __pyx_t_2 = (!__pyx_v_self-&gt;prg_ram_protect);
    __pyx_t_1 = __pyx_t_2;
    __pyx_L5_bool_binop_done:;
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">578</span>:                 self.ram[address % M4_PRG_RAM_SIZE] = value</pre>
<pre class='cython code score-0 '>      (__pyx_v_self-&gt;ram[(__pyx_v_address % __pyx_e_3nes_6cycore_5carts_M4_PRG_RAM_SIZE)]) = __pyx_v_value;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">579</span>:         elif BANK_REG_START &lt;= address &lt; MIRROR_PROTECT_REG_START:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_e_3nes_6cycore_5carts_BANK_REG_START &lt;= __pyx_v_address);
  if (__pyx_t_1) {
    __pyx_t_1 = (__pyx_v_address &lt; __pyx_e_3nes_6cycore_5carts_MIRROR_PROTECT_REG_START);
  }
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">580</span>:             if address &amp; 1 == 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_address &amp; 1) == 0);
    if (__pyx_t_1) {
/* … */
      goto __pyx_L7;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">581</span>:                 # even address =&gt; bank select write</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">582</span>:                 self.chr_a12_inversion = bit_high(value, 7)</pre>
<pre class='cython code score-0 '>      __pyx_t_3 = __pyx_f_3nes_6cycore_7bitwise_bit_high(__pyx_v_value, 7);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 582, __pyx_L1_error)</span>
      __pyx_v_self-&gt;chr_a12_inversion = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">583</span>:                 self.prg_bank_mode = bit_high(value, 6)</pre>
<pre class='cython code score-0 '>      __pyx_t_3 = __pyx_f_3nes_6cycore_7bitwise_bit_high(__pyx_v_value, 6);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 583, __pyx_L1_error)</span>
      __pyx_v_self-&gt;prg_bank_mode = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">584</span>:                 self.bank_select = value &amp; 0b111</pre>
<pre class='cython code score-0 '>      __pyx_v_self-&gt;bank_select = (__pyx_v_value &amp; 7);
</pre><pre class="cython line score-0">&#xA0;<span class="">585</span>:             else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">586</span>:                 # odd address =&gt; bank data write (write one of the bank registers)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">587</span>:                 self.bank_register[self.bank_select] = value</pre>
<pre class='cython code score-0 '>    /*else*/ {
      (__pyx_v_self-&gt;bank_register[__pyx_v_self-&gt;bank_select]) = __pyx_v_value;
    }
    __pyx_L7:;
</pre><pre class="cython line score-0">&#xA0;<span class="">588</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">589</span>:         elif MIRROR_PROTECT_REG_START &lt;= address &lt; IRQ_LATCH_RELOAD_REG_START:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_e_3nes_6cycore_5carts_MIRROR_PROTECT_REG_START &lt;= __pyx_v_address);
  if (__pyx_t_1) {
    __pyx_t_1 = (__pyx_v_address &lt; __pyx_e_3nes_6cycore_5carts_IRQ_LATCH_RELOAD_REG_START);
  }
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">590</span>:             if address &amp; 1 == 0 and not self.mirror_pattern_fixed:</pre>
<pre class='cython code score-0 '>    __pyx_t_2 = ((__pyx_v_address &amp; 1) == 0);
    if (__pyx_t_2) {
    } else {
      __pyx_t_1 = __pyx_t_2;
      goto __pyx_L9_bool_binop_done;
    }
    __pyx_t_2 = (!__pyx_v_self-&gt;mirror_pattern_fixed);
    __pyx_t_1 = __pyx_t_2;
    __pyx_L9_bool_binop_done:;
    if (__pyx_t_1) {
/* … */
      goto __pyx_L8;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">591</span>:                 # sets nametable mirror pattern</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">592</span>:                 if value &amp; 1:</pre>
<pre class='cython code score-0 '>      __pyx_t_1 = ((__pyx_v_value &amp; 1) != 0);
      if (__pyx_t_1) {
/* … */
        goto __pyx_L11;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">593</span>:                     self.nametable_mirror_pattern[:] = MIRROR_HORIZONTAL</pre>
<pre class='cython code score-0 '>        __pyx_t_4 = __pyx_v_self-&gt;__pyx_base.nametable_mirror_pattern;
        __pyx_t_3 = 0;
        __pyx_t_5 = 0;
        __pyx_t_6 = 1;
        __pyx_t_7 = 1;
        (__pyx_t_4[0]) = __pyx_t_3;
        (__pyx_t_4[1]) = __pyx_t_5;
        (__pyx_t_4[2]) = __pyx_t_6;
        (__pyx_t_4[3]) = __pyx_t_7;
</pre><pre class="cython line score-0">&#xA0;<span class="">594</span>:                 else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">595</span>:                     self.nametable_mirror_pattern[:] = MIRROR_VERTICAL</pre>
<pre class='cython code score-0 '>      /*else*/ {
        __pyx_t_4 = __pyx_v_self-&gt;__pyx_base.nametable_mirror_pattern;
        __pyx_t_7 = 0;
        __pyx_t_6 = 1;
        __pyx_t_5 = 0;
        __pyx_t_3 = 1;
        (__pyx_t_4[0]) = __pyx_t_7;
        (__pyx_t_4[1]) = __pyx_t_6;
        (__pyx_t_4[2]) = __pyx_t_5;
        (__pyx_t_4[3]) = __pyx_t_3;
      }
      __pyx_L11:;
</pre><pre class="cython line score-0">&#xA0;<span class="">596</span>:             else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">597</span>:                 # set prg_ram access</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">598</span>:                 self.prg_ram_enable = bit_high(value, 7)</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_t_3 = __pyx_f_3nes_6cycore_7bitwise_bit_high(__pyx_v_value, 7);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 598, __pyx_L1_error)</span>
      __pyx_v_self-&gt;prg_ram_enable = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">599</span>:                 self.prg_ram_protect = bit_high(value, 6)</pre>
<pre class='cython code score-0 '>      __pyx_t_3 = __pyx_f_3nes_6cycore_7bitwise_bit_high(__pyx_v_value, 6);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 599, __pyx_L1_error)</span>
      __pyx_v_self-&gt;prg_ram_protect = __pyx_t_3;
    }
    __pyx_L8:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">600</span>:         elif IRQ_LATCH_RELOAD_REG_START &lt;= address &lt; IRQ_ACTIVATE_START:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_e_3nes_6cycore_5carts_IRQ_LATCH_RELOAD_REG_START &lt;= __pyx_v_address);
  if (__pyx_t_1) {
    __pyx_t_1 = (__pyx_v_address &lt; __pyx_e_3nes_6cycore_5carts_IRQ_ACTIVATE_START);
  }
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">601</span>:             if address &amp; 1 == 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_address &amp; 1) == 0);
    if (__pyx_t_1) {
/* … */
      goto __pyx_L12;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">602</span>:                 self.irq_reload_value = value</pre>
<pre class='cython code score-0 '>      __pyx_v_self-&gt;irq_reload_value = __pyx_v_value;
</pre><pre class="cython line score-0">&#xA0;<span class="">603</span>:             else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">604</span>:                 self.irq_reload = True   # reload irq at next tick</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_self-&gt;irq_reload = 1;
    }
    __pyx_L12:;
</pre><pre class="cython line score-0">&#xA0;<span class="">605</span>:         else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">606</span>:             # irq is disabled by any write to an even address in this range and activated by a write to any odd address</pre>
<pre class="cython line score-0">&#xA0;<span class="">607</span>:             # in this range, so we can just use the bottom bit of the address line to set the irq_enabled flag</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">608</span>:             self.irq_enabled = address &amp; 1</pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_v_self-&gt;irq_enabled = (__pyx_v_address &amp; 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">609</span>:             if not self.irq_enabled:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = (!__pyx_v_self-&gt;irq_enabled);
    if (__pyx_t_1) {
/* … */
    }
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">610</span>:                 # if interrupts are disabled, any pending interrupts are acknowledged;</pre>
<pre class="cython line score-0">&#xA0;<span class="">611</span>:                 # todo: this will also clear pending interrupts from other IRQ producing devices (the APU), but these</pre>
<pre class="cython line score-0">&#xA0;<span class="">612</span>:                 # should not both be in operation at the same time anyway, since then they can be attempting to drive</pre>
<pre class="cython line score-0">&#xA0;<span class="">613</span>:                 # the line in different directions anyway.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">614</span>:                 self.interrupt_listener.reset_irq()</pre>
<pre class='cython code score-0 '>      ((struct __pyx_vtabstruct_3nes_6cycore_6system_InterruptListener *)__pyx_v_self-&gt;interrupt_listener-&gt;__pyx_vtab)-&gt;reset_irq(__pyx_v_self-&gt;interrupt_listener);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 614, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">615</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">616</span>:     cdef unsigned int _get_ppu_bank(self, int address):</pre>
<pre class='cython code score-4 '>static unsigned int __pyx_f_3nes_6cycore_5carts_8NESCart4__get_ppu_bank(struct __pyx_obj_3nes_6cycore_5carts_NESCart4 *__pyx_v_self, int __pyx_v_address) {
  int __pyx_v_window_slot;
  int __pyx_v_banks[8];
  int __pyx_v_double_bank_start;
  int __pyx_v_single_bank_start;
  unsigned int __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[55]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("_get_ppu_bank", __pyx_f[0], 616, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 616, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart4._get_ppu_bank", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">617</span>:         cdef int window_slot  # the 1kb slot in the window that this address belongs to</pre>
<pre class="cython line score-0">&#xA0;<span class="">618</span>:         cdef int banks[8]     # the banks that are mapped to each of the eight slots in the chr address space (each 1kb)</pre>
<pre class="cython line score-0">&#xA0;<span class="">619</span>:         cdef int double_bank_start, single_bank_start  # which slots the 2kb and 1kb banks start in, respectively</pre>
<pre class="cython line score-0">&#xA0;<span class="">620</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">621</span>:         if not self.chr_a12_inversion:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (!__pyx_v_self-&gt;chr_a12_inversion);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">622</span>:             double_bank_start, single_bank_start = 0, 4</pre>
<pre class='cython code score-0 '>    __pyx_t_2 = 0;
    __pyx_t_3 = 4;
    __pyx_v_double_bank_start = __pyx_t_2;
    __pyx_v_single_bank_start = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">623</span>:         else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">624</span>:             double_bank_start, single_bank_start = 4, 0</pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_t_3 = 4;
    __pyx_t_2 = 0;
    __pyx_v_double_bank_start = __pyx_t_3;
    __pyx_v_single_bank_start = __pyx_t_2;
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">625</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">626</span>:         # the chr memory banks corresponding to the 1kb window slots</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">627</span>:         banks[double_bank_start + 0] = self.bank_register[0] &amp; 0b11111110</pre>
<pre class='cython code score-0 '>  (__pyx_v_banks[(__pyx_v_double_bank_start + 0)]) = ((__pyx_v_self-&gt;bank_register[0]) &amp; 254);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">628</span>:         banks[double_bank_start + 1] = (self.bank_register[0] &amp; 0b11111110) + 1</pre>
<pre class='cython code score-0 '>  (__pyx_v_banks[(__pyx_v_double_bank_start + 1)]) = (((__pyx_v_self-&gt;bank_register[0]) &amp; 254) + 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">629</span>:         banks[double_bank_start + 2] = self.bank_register[1] &amp; 0b11111110</pre>
<pre class='cython code score-0 '>  (__pyx_v_banks[(__pyx_v_double_bank_start + 2)]) = ((__pyx_v_self-&gt;bank_register[1]) &amp; 254);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">630</span>:         banks[double_bank_start + 3] = (self.bank_register[1] &amp; 0b11111110) + 1</pre>
<pre class='cython code score-0 '>  (__pyx_v_banks[(__pyx_v_double_bank_start + 3)]) = (((__pyx_v_self-&gt;bank_register[1]) &amp; 254) + 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">631</span>:         banks[single_bank_start + 0] = self.bank_register[2]</pre>
<pre class='cython code score-0 '>  (__pyx_v_banks[(__pyx_v_single_bank_start + 0)]) = (__pyx_v_self-&gt;bank_register[2]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">632</span>:         banks[single_bank_start + 1] = self.bank_register[3]</pre>
<pre class='cython code score-0 '>  (__pyx_v_banks[(__pyx_v_single_bank_start + 1)]) = (__pyx_v_self-&gt;bank_register[3]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">633</span>:         banks[single_bank_start + 2] = self.bank_register[4]</pre>
<pre class='cython code score-0 '>  (__pyx_v_banks[(__pyx_v_single_bank_start + 2)]) = (__pyx_v_self-&gt;bank_register[4]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">634</span>:         banks[single_bank_start + 3] = self.bank_register[5]</pre>
<pre class='cython code score-0 '>  (__pyx_v_banks[(__pyx_v_single_bank_start + 3)]) = (__pyx_v_self-&gt;bank_register[5]);
</pre><pre class="cython line score-0">&#xA0;<span class="">635</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">636</span>:         window_slot = (address &gt;&gt; 10) &amp; 0b111   # address lines A10, A11 and A12 determine the slot</pre>
<pre class='cython code score-0 '>  __pyx_v_window_slot = ((__pyx_v_address &gt;&gt; 10) &amp; 7);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">637</span>:         return banks[window_slot] % self.num_chr_banks</pre>
<pre class='cython code score-0 '>  __pyx_r = ((__pyx_v_banks[__pyx_v_window_slot]) % __pyx_v_self-&gt;num_chr_banks);
  <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_PyLong_From_unsigned_int, 103, 0, <span class='error_goto'>__PYX_ERR(0, 637, __pyx_L1_error)</span>);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">638</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">639</span>:     cdef unsigned char read_ppu(self, int address):</pre>
<pre class='cython code score-4 '>static unsigned char __pyx_f_3nes_6cycore_5carts_8NESCart4_read_ppu(struct __pyx_obj_3nes_6cycore_5carts_NESCart4 *__pyx_v_self, int __pyx_v_address) {
  unsigned int __pyx_v_bank;
  unsigned char __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[56]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("read_ppu", __pyx_f[0], 639, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 639, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 639, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart4.read_ppu", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">640</span>:         cdef unsigned int bank = self._get_ppu_bank(address)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart4 *)__pyx_v_self-&gt;__pyx_base.__pyx_vtab)-&gt;_get_ppu_bank(__pyx_v_self, __pyx_v_address);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 640, __pyx_L1_error)</span>
  __pyx_v_bank = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">641</span>:         return self.banked_chr_rom[bank][address % M4_CHR_ROM_BANK_SIZE]</pre>
<pre class='cython code score-0 '>  __pyx_r = ((__pyx_v_self-&gt;banked_chr_rom[__pyx_v_bank])[(__pyx_v_address % __pyx_e_3nes_6cycore_5carts_M4_CHR_ROM_BANK_SIZE)]);
  <span class='trace'>__Pyx_TraceReturnCValue</span>(__pyx_r, __Pyx_PyLong_From_unsigned_char, 6, 0, <span class='error_goto'>__PYX_ERR(0, 641, __pyx_L1_error)</span>);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">642</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">643</span>:     cdef void write_ppu(self, int address, unsigned char value):</pre>
<pre class='cython code score-4 '>static void __pyx_f_3nes_6cycore_5carts_8NESCart4_write_ppu(struct __pyx_obj_3nes_6cycore_5carts_NESCart4 *__pyx_v_self, int __pyx_v_address, unsigned char __pyx_v_value) {
  unsigned int __pyx_v_bank;
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[57]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("write_ppu", __pyx_f[0], 643, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 643, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  <span class='trace'>__Pyx_TraceReturnValue</span>(Py_None, 0, 0, <span class='error_goto'>__PYX_ERR(0, 643, __pyx_L1_error)</span>);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 643, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart4.write_ppu", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
}
</pre><pre class="cython line score-0">&#xA0;<span class="">644</span>:         cdef unsigned int bank</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">645</span>:         if self.chr_mem_writeable:</pre>
<pre class='cython code score-0 '>  if (__pyx_v_self-&gt;chr_mem_writeable) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">646</span>:             bank = self._get_ppu_bank(address)</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((struct __pyx_vtabstruct_3nes_6cycore_5carts_NESCart4 *)__pyx_v_self-&gt;__pyx_base.__pyx_vtab)-&gt;_get_ppu_bank(__pyx_v_self, __pyx_v_address);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 646, __pyx_L1_error)</span>
    __pyx_v_bank = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">647</span>:             self.banked_chr_rom[bank][address % M4_CHR_ROM_BANK_SIZE] = value</pre>
<pre class='cython code score-0 '>    ((__pyx_v_self-&gt;banked_chr_rom[__pyx_v_bank])[(__pyx_v_address % __pyx_e_3nes_6cycore_5carts_M4_CHR_ROM_BANK_SIZE)]) = __pyx_v_value;
</pre><pre class="cython line score-0">&#xA0;<span class="">648</span>: </pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">649</span>:     cdef void irq_tick(self):</pre>
<pre class='cython code score-11 '>static void __pyx_f_3nes_6cycore_5carts_8NESCart4_irq_tick(struct __pyx_obj_3nes_6cycore_5carts_NESCart4 *__pyx_v_self) {
  <span class='trace'>__Pyx_TraceDeclarationsFunc</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(((PyObject *)__pyx_mstate_global-&gt;__pyx_codeobj_tab[58]))
  <span class='trace'>__Pyx_TraceStartFunc</span>("irq_tick", __pyx_f[0], 649, 0, 0, 0, <span class='error_goto'>__PYX_ERR(0, 649, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  <span class='trace'>__Pyx_TraceReturnValue</span>(Py_None, 0, 0, <span class='error_goto'>__PYX_ERR(0, 649, __pyx_L1_error)</span>);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='trace'>__Pyx_TraceException</span>(__pyx_lineno, 0, 0);
  #if CYTHON_USE_SYS_MONITORING
  <span class='trace'>__Pyx_TraceExceptionUnwind</span>(0, 0);
  #else
  <span class='trace'>__Pyx_TraceReturnValue</span>(NULL, 0, 0, <span class='error_goto'>__PYX_ERR(0, 649, __pyx_L1_error)</span>);
  #endif
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("nes.cycore.carts.NESCart4.irq_tick", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_PyMonitoring_ExitScope</span>(0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">650</span>:         if self.irq_reload:</pre>
<pre class='cython code score-0 '>  if (__pyx_v_self-&gt;irq_reload) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">651</span>:             # if a reload has been triggered, do that and reset the reload flag</pre>
<pre class="cython line score-0">&#xA0;<span class="">652</span>:             # (add 1 to the counter here because this will be immediately decremented below and there should be N + 1</pre>
<pre class="cython line score-0">&#xA0;<span class="">653</span>:             # periods between IRQs)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">654</span>:             self.irq_counter = self.irq_reload_value + 1</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;irq_counter = (__pyx_v_self-&gt;irq_reload_value + 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">655</span>:             self.irq_reload = False</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;irq_reload = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">656</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">657</span>:         if self.irq_counter &gt; 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_self-&gt;irq_counter &gt; 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">658</span>:             self.irq_counter -= 1</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;irq_counter = (__pyx_v_self-&gt;irq_counter - 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">659</span>: </pre>
<pre class="cython line score-47" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">660</span>:         logging.log(logging.INFO, "IRQ counter = {}".format(self.irq_counter), extra={"source": "Cart"})</pre>
<pre class='cython code score-47 '>  __pyx_t_3 = NULL;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_mstate_global-&gt;__pyx_n_u_logging);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 660, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_mstate_global-&gt;__pyx_n_u_log);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 660, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_mstate_global-&gt;__pyx_n_u_logging);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 660, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_mstate_global-&gt;__pyx_n_u_INFO);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 660, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_7 = __pyx_mstate_global-&gt;__pyx_kp_u_IRQ_counter;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyLong_From_int</span>(__pyx_v_self-&gt;irq_counter);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 660, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_9 = 0;
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_7, __pyx_t_8};
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_FastCallMethod</span>(__pyx_mstate_global-&gt;__pyx_n_u_format, __pyx_callargs+__pyx_t_9, (2-__pyx_t_9) | (1*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET));
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 660, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  }
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 660, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_8, __pyx_mstate_global-&gt;__pyx_n_u_source, __pyx_mstate_global-&gt;__pyx_n_u_Cart) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 660, __pyx_L1_error)</span>
  __pyx_t_9 = 1;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    assert(__pyx_t_3);
    PyObject* __pyx__function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx__function);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, __pyx__function);
    __pyx_t_9 = 0;
  }
  #endif
  {
    PyObject *__pyx_callargs[3 + ((CYTHON_VECTORCALL) ? 1 : 0)] = {__pyx_t_3, __pyx_t_6, __pyx_t_4};
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_MakeVectorcallBuilderKwds</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 660, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    if (<span class='pyx_c_api'>__Pyx_VectorcallBuilder_AddArg</span>(__pyx_mstate_global-&gt;__pyx_n_u_extra, __pyx_t_8, __pyx_t_7, __pyx_callargs+3, 0) &lt; (0)) <span class='error_goto'>__PYX_ERR(0, 660, __pyx_L1_error)</span>
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Object_Vectorcall_CallFromBuilder</span>(__pyx_t_5, __pyx_callargs+__pyx_t_9, (3-__pyx_t_9) | (__pyx_t_9*__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET), __pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 660, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">661</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">662</span>:         # currently, this implements "normal" or "new" behaviour (https://wiki.nesdev.com/w/index.php/MMC3), so that if</pre>
<pre class="cython line score-0">&#xA0;<span class="">663</span>:         # the reload value is zero, an irq will be triggered every cycle rather than only once, but this can vary</pre>
<pre class="cython line score-0">&#xA0;<span class="">664</span>:         # between MMC3 cartridges because on some the irq is only triggered as the counter is decremented to zero.</pre>
<pre class="cython line score-0">&#xA0;<span class="">665</span>:         # For those old-style chips, writing to reload with the counter at zero will trigger another single IRQ</pre>
<pre class="cython line score-0">&#xA0;<span class="">666</span>:         # todo: support "old" MMC3A behaviour</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">667</span>:         if self.irq_counter == 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_self-&gt;irq_counter == 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">668</span>:             self.irq_reload = True  # reload counter next time</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;irq_reload = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">669</span>:             if self.irq_enabled:</pre>
<pre class='cython code score-0 '>    if (__pyx_v_self-&gt;irq_enabled) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">670</span>:                 self.interrupt_listener.raise_irq()</pre>
<pre class='cython code score-0 '>      ((struct __pyx_vtabstruct_3nes_6cycore_6system_InterruptListener *)__pyx_v_self-&gt;interrupt_listener-&gt;__pyx_vtab)-&gt;raise_irq(__pyx_v_self-&gt;interrupt_listener);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 670, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">671</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">672</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">673</span>: </pre>
</div></body></html>
